<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>Raved ‚Ä¢ Mobile</title>

  <!-- Tailwind & Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    rel="stylesheet"
  />

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
            accent: '#FF6B6B',
            success: '#10B981',
            warning: '#F59E0B',
            dark: {
              bg: '#0F1115',
              card: '#171923',
              text: '#E5E7EB',
              primary: '#7775E8',
            },
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'ui-sans-serif', 'Segoe UI', 'Arial'],
          },
        },
      },
    };
  </script>

  <style>
    /* Theme System CSS Variables */
    :root {
      --theme-primary: #5D5CDE;
      --theme-primary-dark: #4C4BC7;
      --theme-accent: #FF6B6B;
      --theme-success: #10B981;
      --theme-warning: #F59E0B;
    }

    /* Theme Variants */
    [data-theme="rose"] {
      --theme-primary: #f43f5e;
      --theme-primary-dark: #e11d48;
      --theme-accent: #fb7185;
    }

    [data-theme="emerald"] {
      --theme-primary: #10b981;
      --theme-primary-dark: #059669;
      --theme-accent: #34d399;
    }

    [data-theme="ocean"] {
      --theme-primary: #3b82f6;
      --theme-primary-dark: #2563eb;
      --theme-accent: #60a5fa;
    }

    [data-theme="sunset"] {
      --theme-primary: #f97316;
      --theme-primary-dark: #ea580c;
      --theme-accent: #fb923c;
    }

    [data-theme="galaxy"] {
      --theme-primary: #6366f1;
      --theme-primary-dark: #4f46e5;
      --theme-accent: #8b5cf6;
    }

    /* Apply theme colors to elements */
    .bg-primary { background-color: var(--theme-primary) !important; }
    .text-primary { color: var(--theme-primary) !important; }
    .border-primary { border-color: var(--theme-primary) !important; }
    .from-primary { --tw-gradient-from: var(--theme-primary) !important; }
    .to-primary { --tw-gradient-to: var(--theme-primary) !important; }
    .ring-primary { --tw-ring-color: var(--theme-primary) !important; }
    .focus\:ring-primary:focus { --tw-ring-color: var(--theme-primary) !important; }
    .focus\:border-primary:focus { border-color: var(--theme-primary) !important; }
    .hover\:bg-primary:hover { background-color: var(--theme-primary-dark) !important; }

    /* Dark mode theme adjustments */
    .dark [data-theme="rose"] {
      --theme-primary: #fb7185;
      --theme-primary-dark: #f43f5e;
    }
    .dark [data-theme="emerald"] {
      --theme-primary: #6ee7b7;
      --theme-primary-dark: #34d399;
    }
    .dark [data-theme="ocean"] {
      --theme-primary: #93c5fd;
      --theme-primary-dark: #60a5fa;
    }
    .dark [data-theme="sunset"] {
      --theme-primary: #fdba74;
      --theme-primary-dark: #fb923c;
    }
    .dark [data-theme="galaxy"] {
      --theme-primary: #a5b4fc;
      --theme-primary-dark: #8b5cf6;
    }

    /* Mobile-first layout helpers */
    html, body { height: 100%; }
    body { -webkit-tap-highlight-color: transparent; }
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    .safe-top { padding-top: env(safe-area-inset-top); }

    /* Carousel styles */
    .carousel-container {
      position: relative;
      overflow: hidden;
      border-radius: 0.75rem;
    }

    .carousel-track {
      display: flex;
      transition: transform 0.3s ease;
    }

    .carousel-slide {
      min-width: 100%;
      flex-shrink: 0;
    }

    .carousel-btn {
      opacity: 0.8;
      transition: opacity 0.2s ease;
    }

    .carousel-btn:hover {
      opacity: 1;
    }

    .carousel-dot {
      transition: all 0.2s ease;
    }

    /* Fix cursor and interaction issues */
    button {
      cursor: pointer !important;
      pointer-events: auto !important;
      user-select: none;
    }
    input {
      cursor: text !important;
      pointer-events: auto !important;
    }
    input[type="submit"], input[type="button"] {
      cursor: pointer !important;
      pointer-events: auto !important;
      user-select: none;
    }
    .tap-active {
      cursor: pointer !important;
      pointer-events: auto !important;
    }

    /* Ensure form elements are interactive */
    form { pointer-events: auto !important; }
    #loginForm input, #loginForm button {
      pointer-events: auto !important;
    }

    /* App Shell */
    .app-shell {
      max-width: 520px;
      margin: 0 auto;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      background: #f8fafc;
    }
    .dark .app-shell { background: #0F1115; }

    /* Post media */
    .post-media {
      aspect-ratio: 1 / 1;
      width: 100%;
      object-fit: cover;
    }

    /* Stories */
    .story-ring {
      padding: 2px;
      border-radius: 9999px;
      background: linear-gradient(135deg, #5D5CDE, #FF6B6B);
    }
    .story-inactive {
      padding: 2px;
      border-radius: 9999px;
      background: #E5E7EB;
    }
    .dark .story-inactive { background: #374151; }

    /* Bottom tab bar */
    .tabbar {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      right: 0;
      z-index: 50;
      width: 100%;
      max-width: 520px;
      background: white;
      border-top: 1px solid #E5E7EB;
    }
    .dark .tabbar { background: #171923; border-color: #252a37; }

    /* Bottom Sheets System */
    .sheet {
      position: fixed;
      left: 50%;
      transform: translateX(-50%) translateY(100%);
      bottom: 0;
      width: 100%;
      max-width: 520px;
      height: calc(100vh - 80px); /* Initial height similar to main screen */
      background: #fff;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
      box-shadow: 0 -8px 30px rgba(0,0,0,0.25);
      transition: transform .4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      z-index: 1000;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }
    .dark .sheet {
      background: #171923;
      border-color: #374151;
    }
    .sheet.show {
      transform: translateX(-50%) translateY(0);
    }

    /* Sheet states */
    .sheet.collapsed {
      height: 60vh; /* Collapsed state */
    }
    .sheet.expanded {
      height: 95vh; /* Expanded state */
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      opacity: 0;
      pointer-events: none;
      transition: opacity .4s ease;
      z-index: 999;
    }
    .overlay.show {
      opacity: 1;
      pointer-events: auto;
    }

    /* Sheet handle for dragging */
    .sheet-handle {
      width: 40px;
      height: 4px;
      background: #d1d5db;
      border-radius: 2px;
      margin: 8px auto 0;
      cursor: grab;
      transition: background-color 0.2s;
    }
    .dark .sheet-handle {
      background: #6b7280;
    }
    .sheet-handle:hover {
      background: #9ca3af;
    }
    .dark .sheet-handle:hover {
      background: #9ca3af;
    }

    /* Sheet header */
    .sheet-header {
      flex-shrink: 0;
      padding: 12px 16px 16px;
      border-bottom: 1px solid #f3f4f6;
      background: inherit;
      border-top-left-radius: 20px;
      border-top-right-radius: 20px;
    }
    .dark .sheet-header {
      border-bottom-color: #374151;
    }

    /* Sheet content scrolling */
    .sheet-content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
    }

    /* Sheet footer */
    .sheet-footer {
      flex-shrink: 0;
      padding: 16px;
      border-top: 1px solid #f3f4f6;
      background: inherit;
    }
    .dark .sheet-footer {
      border-top-color: #374151;
    }

    /* Hide scrollbars for cleaner horizontal scrolling */
    .scrollbar-hide {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
      display: none;
    }

    /* Price tag for sale items */
    .price-tag {
      background: linear-gradient(135deg, #10B981, #059669);
      color: white;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
      backdrop-filter: blur(10px);
    }

    /* Sale badge */
    .sale-badge {
      background: linear-gradient(135deg, #10B981, #059669);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    /* Toast */
    .toast {
      position: fixed;
      top: 16px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      background: white;
      color: #111827;
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.18);
      opacity: 0;
      transition: all .25s ease;
      z-index: 60;
      max-width: 90%;
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    .dark .toast { background: #171923; color: #E5E7EB; }

    /* Action button hover */
    .tap-active:active { transform: scale(0.98); }

    /* Scrollbars subtle */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 6px; }
    .dark ::-webkit-scrollbar-thumb { background: #2c3344; }
  </style>
</head>

<body class="font-sans text-gray-900 dark:text-dark-text bg-slate-50 dark:bg-dark-bg">
  <!-- Toast -->
  <div id="toast" class="toast hidden">
    <div class="flex items-center gap-2">
      <i id="toast-icon" class="fa-solid fa-circle-check text-success"></i>
      <span id="toast-text" class="text-sm font-medium">Done</span>
    </div>
  </div>

  <!-- Authentication (mobile-first) -->
  <div id="auth" class="min-h-screen flex flex-col items-center justify-center px-5">
    <div class="w-full max-w-sm">
      <div class="text-center mb-8">
        <div class="inline-flex items-center justify-center w-14 h-14 rounded-2xl bg-primary/10 text-primary dark:bg-dark-primary/20 dark:text-dark-primary">
          <i class="fa-solid fa-bolt"></i>
        </div>
        <h1 class="text-3xl font-extrabold mt-3">Raved</h1>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Student Fashion Social Platform</p>
      </div>

      <div class="bg-white dark:bg-dark-card rounded-2xl p-5 shadow">
        <form id="loginForm" class="space-y-4">
          <div>
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Email, Username, or Phone</label>
            <div class="relative mt-1">
              <input id="loginIdentifier" type="text" class="w-full rounded-xl border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="alex@gmail.com, @alexjohnson, or 0241234567" required />
              <i class="fa-solid fa-user text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
            </div>
            <div class="text-xs text-gray-500 mt-1">You can sign in with your email, username, or phone number</div>
          </div>
          <div>
            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
            <div class="relative mt-1">
              <input id="loginPassword" type="password" class="w-full rounded-xl border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900 pl-10 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Enter your password" required />
              <i class="fa-solid fa-lock text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
              <button type="button" id="toggleLoginPassword" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fa-solid fa-eye"></i>
              </button>
            </div>
            <button id="openReset" type="button" class="mt-2 text-xs text-primary dark:text-dark-primary hover:underline">Forgot password?</button>
          </div>
          <div class="flex items-center justify-between text-sm">
            <label class="flex items-center">
              <input type="checkbox" id="rememberMe" class="rounded border-gray-300 text-primary focus:ring-primary mr-2" />
              <span class="text-gray-600 dark:text-gray-400">Remember me</span>
            </label>
          </div>
          <button type="submit" id="signinBtn" class="w-full bg-primary dark:bg-dark-primary text-white rounded-xl py-3 font-semibold tap-active">Sign In</button>
        </form>

        <div class="text-center mt-4 text-sm">
          <span class="text-gray-500">No account?</span>
          <button id="openRegister" class="text-primary dark:text-dark-primary font-semibold">Register</button>
        </div>
      </div>

      <p class="text-center text-xs text-gray-500 dark:text-gray-500 mt-6">
        By continuing you agree to our
        <a class="underline" href="#">Terms</a> and
        <a class="underline" href="#">Privacy</a>.
      </p>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="app-shell hidden">
    <!-- Top App Bar -->
    <header class="safe-top sticky top-0 z-40 bg-white dark:bg-dark-card border-b border-gray-200 dark:border-slate-800">
      <div class="px-4 py-3 flex items-center gap-3">
        <button id="btnOpenMore" class="p-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-200">
          <i class="fa-solid fa-bars"></i>
        </button>
        <h2 id="appTitle" class="text-lg font-bold flex-1">Home</h2>
        <button id="btnOpenSearch" class="p-2 rounded-full bg-gray-100 dark:bg-slate-800">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
        <button id="btnOpenNotifications" class="relative p-2 rounded-full bg-gray-100 dark:bg-slate-800">
          <i class="fa-solid fa-bell"></i>
          <span id="notifDot" class="absolute -top-1 -right-1 w-2 h-2 rounded-full bg-red-500 hidden"></span>
        </button>
        <button id="btnTheme" class="p-2 rounded-full bg-gray-100 dark:bg-slate-800">
          <i class="fa-solid fa-moon dark:hidden"></i>
          <i class="fa-solid fa-sun hidden dark:inline"></i>
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main id="pages" class="flex-1 pb-24">
      <!-- Home -->
      <section id="page-home" class="p-4 space-y-5">
        <!-- Stories -->
        <div class="overflow-x-auto scrollbar-hide">
          <div id="storiesRow" class="flex gap-4 pb-2" style="width: max-content;">
            <!-- stories injected -->
          </div>
        </div>

        <!-- Featured -->
        <div>
          <div class="flex items-center gap-2 mb-2">
            <i class="fa-solid fa-star text-yellow-400"></i>
            <h3 class="font-bold">Featured</h3>
          </div>
          <div id="featuredPost">
            <!-- featured post injected -->
          </div>
        </div>

        <!-- Store teaser -->
        <div>
          <div class="flex items-center gap-2 mb-2">
            <i class="fa-solid fa-bag-shopping text-accent"></i>
            <h3 class="font-bold">Fashion Store</h3>
          </div>
          <div id="storeTeaser" class="grid grid-cols-2 gap-3">
            <!-- items injected -->
          </div>
          <div class="mt-2">
            <button id="btnViewAllStore" class="w-full bg-primary dark:bg-dark-primary text-white rounded-xl py-2 font-semibold">View All Items</button>
          </div>
        </div>

        <!-- Rankings teaser -->
        <div id="rankingsSection" class="hidden">
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <i class="fa-solid fa-trophy text-yellow-500"></i>
              <h3 class="font-bold">This Week's Top Creators</h3>
            </div>
            <button class="text-xs text-primary dark:text-dark-primary font-medium" onclick="openRankings()">View all ‚Üí</button>
          </div>
          <div id="rankingsTeaser" class="space-y-2">
            <!-- rankings injected -->
          </div>
          <div class="mt-3 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl border border-yellow-200 dark:border-yellow-800/30">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-sm font-semibold text-yellow-900 dark:text-yellow-100">üí∞ Monthly Prize Pool</div>
                <div class="text-xs text-yellow-700 dark:text-yellow-300">‚Çµ150 total rewards this month</div>
              </div>
              <button onclick="openRankings()" class="px-3 py-1.5 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:shadow-lg transition-all">
                <i class="fa-solid fa-trophy mr-1"></i>Compete
              </button>
            </div>
          </div>
        </div>

        <!-- Free User Rankings CTA -->
        <div id="rankingsCTA" class="block">
          <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl p-4 border border-purple-200 dark:border-purple-800/30">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                <i class="fa-solid fa-trophy text-white"></i>
              </div>
              <div class="flex-1">
                <div class="font-bold text-purple-900 dark:text-purple-100">Join the Competition!</div>
                <div class="text-sm text-purple-700 dark:text-purple-300">Compete for ‚Çµ150 monthly prizes</div>
              </div>
              <button onclick="openSubscription()" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-medium hover:shadow-lg transition-all">
                <i class="fa-solid fa-crown mr-1"></i>Upgrade
              </button>
            </div>
          </div>
        </div>

        <!-- Feed -->
        <div>
          <h3 class="font-bold mb-2">Your Feed</h3>
          <div id="feed" class="space-y-4">
            <!-- posts injected -->
          </div>
          <button id="btnLoadMoreFeed" class="mt-2 w-full bg-white dark:bg-dark-card border border-gray-200 dark:border-slate-800 rounded-xl py-3 text-primary dark:text-dark-primary font-semibold">Load More</button>
        </div>
      </section>

      <!-- Faculties -->
      <section id="page-faculties" class="hidden p-4 space-y-4">
        <!-- Faculty Selection -->
        <div class="bg-white dark:bg-dark-card rounded-2xl p-4">
          <h3 class="font-bold mb-4 flex items-center">
            <i class="fa-solid fa-university text-primary mr-2"></i>
            Campus Communities
          </h3>
          <div class="grid grid-cols-2 gap-3">
            <button class="faculty-filter bg-primary text-white px-4 py-3 rounded-xl font-medium transition-all" data-faculty="all">
              <i class="fa-solid fa-globe mb-1 text-lg"></i>
              <div class="text-sm">All Faculties</div>
              <div class="text-xs opacity-80">12.5k members</div>
            </button>
            <button class="faculty-filter bg-gradient-to-br from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 text-purple-800 dark:text-purple-200 px-4 py-3 rounded-xl hover:shadow-lg transition-all" data-faculty="arts">
              <i class="fa-solid fa-palette mb-1 text-lg text-purple-600"></i>
              <div class="text-sm font-medium">Arts & Humanities</div>
              <div class="text-xs opacity-70">2.4k members</div>
            </button>
            <button class="faculty-filter bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30 text-blue-800 dark:text-blue-200 px-4 py-3 rounded-xl hover:shadow-lg transition-all" data-faculty="business">
              <i class="fa-solid fa-briefcase mb-1 text-lg text-blue-600"></i>
              <div class="text-sm font-medium">Business</div>
              <div class="text-xs opacity-70">3.1k members</div>
            </button>
            <button class="faculty-filter bg-gradient-to-br from-orange-100 to-red-100 dark:from-orange-900/30 dark:to-red-900/30 text-orange-800 dark:text-orange-200 px-4 py-3 rounded-xl hover:shadow-lg transition-all" data-faculty="engineering">
              <i class="fa-solid fa-cog mb-1 text-lg text-orange-600"></i>
              <div class="text-sm font-medium">Engineering</div>
              <div class="text-xs opacity-70">2.8k members</div>
            </button>
            <button class="faculty-filter bg-gradient-to-br from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30 text-green-800 dark:text-green-200 px-4 py-3 rounded-xl hover:shadow-lg transition-all" data-faculty="science">
              <i class="fa-solid fa-flask mb-1 text-lg text-green-600"></i>
              <div class="text-sm font-medium">Science</div>
              <div class="text-xs opacity-70">2.2k members</div>
            </button>
            <button class="faculty-filter bg-gradient-to-br from-red-100 to-pink-100 dark:from-red-900/30 dark:to-pink-900/30 text-red-800 dark:text-red-200 px-4 py-3 rounded-xl hover:shadow-lg transition-all" data-faculty="medicine">
              <i class="fa-solid fa-user-md mb-1 text-lg text-red-600"></i>
              <div class="text-sm font-medium">Medicine</div>
              <div class="text-xs opacity-70">2.0k members</div>
            </button>
            <button class="faculty-filter bg-gradient-to-br from-indigo-100 to-purple-100 dark:from-indigo-900/30 dark:to-purple-900/30 text-indigo-800 dark:text-indigo-200 px-4 py-3 rounded-xl hover:shadow-lg transition-all" data-faculty="law">
              <i class="fa-solid fa-scale-balanced mb-1 text-lg text-indigo-600"></i>
              <div class="text-sm font-medium">Law</div>
              <div class="text-xs opacity-70">1.8k members</div>
            </button>
            <button class="faculty-filter bg-gradient-to-br from-yellow-100 to-orange-100 dark:from-yellow-900/30 dark:to-orange-900/30 text-yellow-800 dark:text-yellow-200 px-4 py-3 rounded-xl hover:shadow-lg transition-all" data-faculty="education">
              <i class="fa-solid fa-chalkboard-teacher mb-1 text-lg text-yellow-600"></i>
              <div class="text-sm font-medium">Education</div>
              <div class="text-xs opacity-70">1.5k members</div>
            </button>
          </div>
        </div>

        <!-- Faculty Stats -->
        <div class="bg-white dark:bg-dark-card rounded-2xl p-4">
          <div class="grid grid-cols-3 text-center">
            <div>
              <div id="facultyMembers" class="text-xl font-bold text-primary dark:text-dark-primary">2.4k</div>
              <div class="text-xs text-gray-500">Members</div>
            </div>
            <div>
              <div id="facultyPosts" class="text-xl font-bold text-primary dark:text-dark-primary">1.2k</div>
              <div class="text-xs text-gray-500">Posts</div>
            </div>
            <div>
              <div id="facultyEvents" class="text-xl font-bold text-primary dark:text-dark-primary">24</div>
              <div class="text-xs text-gray-500">Events</div>
            </div>
          </div>
        </div>

        <!-- Faculty Feed -->
        <div>
          <h3 id="facultyFeedTitle" class="font-bold mb-2 flex items-center">
            <i class="fa-solid fa-fire text-accent mr-2"></i>
            Trending in All Faculties
          </h3>
          <div id="facultyFeed" class="space-y-4">
            <!-- faculty posts injected -->
          </div>
          <button id="btnLoadMoreFaculty" class="mt-2 w-full bg-white dark:bg-dark-card border border-gray-200 dark:border-slate-800 rounded-xl py-3 text-primary dark:text-dark-primary font-semibold">Load More</button>
        </div>
      </section>

      <!-- Create Post -->
      <section id="page-create" class="hidden">
        <!-- Header -->
        <div class="sticky top-0 bg-white dark:bg-dark-bg border-b border-gray-100 dark:border-slate-800 px-4 py-3 z-10">
          <div class="flex items-center justify-between">
            <h1 class="text-xl font-bold">New Post</h1>
            <button id="cpDraft" class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">
              <i class="fa-regular fa-bookmark mr-1"></i>Save Draft
            </button>
          </div>
        </div>

        <div class="p-4 space-y-4">
          <!-- User Info & Main Content -->
          <div class="bg-white dark:bg-dark-card rounded-3xl overflow-hidden">
            <!-- User Header -->
            <div class="p-4 pb-0">
              <div class="flex items-center gap-3">
                <img id="cpAvatar" src="https://i.imgur.com/jL1aT9i.jpg" class="w-12 h-12 rounded-full object-cover ring-2 ring-gray-100 dark:ring-slate-700" alt="me">
                <div class="flex-1">
                  <div class="flex items-center gap-2">
                    <div id="cpName" class="font-bold text-base">Alex Johnson</div>
                    <div class="w-1 h-1 bg-gray-400 rounded-full"></div>
                    <div id="cpFaculty" class="text-sm text-gray-500">Business</div>
                  </div>
                  <div class="flex items-center gap-2 mt-1">
                    <select id="cpVisibility" class="text-sm bg-transparent border-none outline-none text-gray-600 dark:text-gray-400 cursor-pointer">
                      <option value="public">üåç Everyone can see</option>
                      <option value="faculty">üè´ Faculty only</option>
                      <option value="connections">üë• Connections only</option>
                      <option value="private">üîí Only me</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            <!-- Content Input -->
            <div class="px-4 py-2">
              <div class="relative">
                <textarea
                  id="cpCaption"
                  rows="6"
                  class="w-full bg-transparent border-none outline-none resize-none text-base placeholder-gray-400 dark:placeholder-gray-500"
                  placeholder="What's your style story today? Share your outfit inspiration, fashion finds, or campus looks..."
                  maxlength="2000"
                ></textarea>
                <div class="absolute bottom-2 right-2 text-xs text-gray-400">
                  <span id="cpCount">0</span>/2000
                </div>
              </div>
            </div>

            <!-- Media Upload Area -->
            <div id="cpMediaContainer" class="px-4 pb-2">
              <div id="cpUpload" class="rounded-2xl border-2 border-dashed border-gray-200 dark:border-slate-700 p-6 text-center transition-all hover:border-primary/50 hover:bg-gray-50/50 dark:hover:bg-slate-800/50">
                <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-primary/10 to-purple-500/10 flex items-center justify-center mb-3">
                  <i class="fa-solid fa-camera text-2xl text-primary"></i>
                </div>
                <h3 class="font-semibold text-gray-900 dark:text-gray-100 mb-1">Add photos or videos</h3>
                <p class="text-sm text-gray-500 mb-3">Share your outfit, style inspiration, or fashion moments</p>
                <input id="cpFile" type="file" accept="image/*,video/*" class="hidden" multiple />
                <button id="cpUploadBtn" class="px-6 py-2.5 bg-gradient-to-r from-primary to-purple-600 text-white rounded-full font-medium hover:shadow-lg transition-all">
                  <i class="fa-solid fa-plus mr-2"></i>Choose Media
                </button>
              </div>

              <!-- Media Preview -->
              <div id="cpPreview" class="mt-4 grid grid-cols-2 gap-3 hidden"></div>
              <div id="cpPreviewBar" class="mt-3 hidden flex items-center justify-between">
                <div id="cpFileInfo" class="text-sm text-gray-600 dark:text-gray-400">0 files selected</div>
                <button id="cpClear" class="text-sm text-red-500 hover:text-red-600 font-medium">Remove all</button>
              </div>
            </div>

            <!-- Enhanced Features -->
            <div class="px-4 pb-4 space-y-4">
              <!-- Location -->
              <div id="cpLocationSection">
                <div class="flex items-center justify-between mb-2">
                  <label class="text-sm font-semibold text-gray-700 dark:text-gray-300">üìç Location</label>
                  <button id="cpLocationToggle" class="text-xs text-primary hover:text-primary/80 transition-colors">
                    <i class="fa-solid fa-location-crosshairs mr-1"></i>Use current location
                  </button>
                </div>
                <div class="relative">
                  <input
                    id="cpLocation"
                    type="text"
                    placeholder="Where are you? (e.g., Campus Library, Downtown Mall...)"
                    class="w-full rounded-2xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 pl-12 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                  />
                  <i class="fa-solid fa-location-dot text-primary absolute left-4 top-1/2 -translate-y-1/2"></i>
                  <button id="cpLocationSearch" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-primary transition-colors">
                    <i class="fa-solid fa-search"></i>
                  </button>
                </div>

                <!-- Location Suggestions -->
                <div id="cpLocationSuggestions" class="mt-2 bg-white dark:bg-slate-800 rounded-2xl border border-gray-200 dark:border-slate-700 shadow-lg hidden max-h-48 overflow-y-auto">
                  <!-- Location suggestions will be populated here -->
                </div>
              </div>

              <!-- Fashion Tags -->
              <div>
                <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 block">üè∑Ô∏è Fashion Tags</label>
                <div class="relative">
                  <input
                    id="cpTags"
                    type="text"
                    placeholder="Add tags like #OOTD #CampusStyle #Vintage..."
                    class="w-full rounded-2xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 pl-12 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                  />
                  <i class="fa-solid fa-hashtag text-primary absolute left-4 top-1/2 -translate-y-1/2"></i>
                </div>

                <!-- Popular Tags -->
                <div class="mt-3">
                  <div class="text-xs text-gray-500 mb-2">Popular tags:</div>
                  <div class="flex flex-wrap gap-2" id="cpPopularTags">
                    <button class="popular-tag px-3 py-1.5 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-full text-xs font-medium hover:bg-primary hover:text-white transition-all" data-tag="OOTD">#OOTD</button>
                    <button class="popular-tag px-3 py-1.5 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-full text-xs font-medium hover:bg-primary hover:text-white transition-all" data-tag="CampusStyle">#CampusStyle</button>
                    <button class="popular-tag px-3 py-1.5 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-full text-xs font-medium hover:bg-primary hover:text-white transition-all" data-tag="Vintage">#Vintage</button>
                    <button class="popular-tag px-3 py-1.5 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-full text-xs font-medium hover:bg-primary hover:text-white transition-all" data-tag="Thrifted">#Thrifted</button>
                    <button class="popular-tag px-3 py-1.5 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-full text-xs font-medium hover:bg-primary hover:text-white transition-all" data-tag="StudyFit">#StudyFit</button>
                  </div>
                </div>

                <!-- Selected Tags -->
                <div id="cpTagList" class="mt-3 flex flex-wrap gap-2"></div>
              </div>

              <!-- Outfit Details (Unique to Fashion App) -->
              <div>
                <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2 block">üëó Outfit Details</label>
                <div class="grid grid-cols-2 gap-3">
                  <div>
                    <input
                      id="cpBrand"
                      type="text"
                      placeholder="Brand/Store"
                      class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
                    />
                  </div>
                  <div>
                    <select id="cpOccasion" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 px-3 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                      <option value="">Occasion</option>
                      <option value="casual">Casual</option>
                      <option value="formal">Formal</option>
                      <option value="party">Party</option>
                      <option value="study">Study Session</option>
                      <option value="date">Date</option>
                      <option value="work">Work/Internship</option>
                      <option value="event">Special Event</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Marketplace Integration -->
              <div id="cpMarketplaceSection">
                <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 block">üõçÔ∏è Marketplace</label>

                <!-- Available for Sale Toggle -->
                <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl p-4 border border-green-200 dark:border-green-800/30">
                  <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-2">
                      <i class="fa-solid fa-store text-green-600"></i>
                      <span class="font-medium text-green-800 dark:text-green-200">Make items available for sale</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" id="cpForSale" class="sr-only peer">
                      <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-green-300 dark:peer-focus:ring-green-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"></div>
                    </label>
                  </div>

                  <!-- Sale Details (Hidden by default) -->
                  <div id="cpSaleDetails" class="hidden space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                      <div>
                        <label class="block text-xs font-medium text-green-700 dark:text-green-300 mb-1">Price ($)</label>
                        <input
                          id="cpPrice"
                          type="number"
                          min="1"
                          step="0.01"
                          placeholder="25.00"
                          class="w-full rounded-xl border border-green-200 dark:border-green-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all"
                        />
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-green-700 dark:text-green-300 mb-1">Condition</label>
                        <select id="cpCondition" class="w-full rounded-xl border border-green-200 dark:border-green-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                          <option value="new">New</option>
                          <option value="like-new">Like New</option>
                          <option value="good">Good</option>
                          <option value="fair">Fair</option>
                        </select>
                      </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                      <div>
                        <label class="block text-xs font-medium text-green-700 dark:text-green-300 mb-1">Size</label>
                        <select id="cpSize" class="w-full rounded-xl border border-green-200 dark:border-green-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                          <option value="">Select Size</option>
                          <option value="XS">XS</option>
                          <option value="S">S</option>
                          <option value="M">M</option>
                          <option value="L">L</option>
                          <option value="XL">XL</option>
                          <option value="XXL">XXL</option>
                          <option value="One Size">One Size</option>
                        </select>
                      </div>
                      <div>
                        <label class="block text-xs font-medium text-green-700 dark:text-green-300 mb-1">Category</label>
                        <select id="cpCategory" class="w-full rounded-xl border border-green-200 dark:border-green-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                          <option value="clothing">Clothing</option>
                          <option value="shoes">Shoes</option>
                          <option value="accessories">Accessories</option>
                          <option value="bags">Bags</option>
                          <option value="jewelry">Jewelry</option>
                        </select>
                      </div>
                    </div>

                    <div>
                      <label class="block text-xs font-medium text-green-700 dark:text-green-300 mb-1">Item Description</label>
                      <textarea
                        id="cpItemDescription"
                        rows="2"
                        placeholder="Describe the item, its features, why you're selling it..."
                        class="w-full rounded-xl border border-green-200 dark:border-green-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all resize-none"
                      ></textarea>
                    </div>

                    <!-- Payment Methods -->
                    <div>
                      <label class="block text-xs font-medium text-green-700 dark:text-green-300 mb-2">üí≥ Payment Methods Accepted</label>
                      <div class="space-y-2">
                        <div class="flex items-center gap-2">
                          <input type="checkbox" id="cpPaymentMomo" class="rounded border-green-300 text-green-600 focus:ring-green-500">
                          <label for="cpPaymentMomo" class="text-xs text-green-700 dark:text-green-300">Mobile Money</label>
                        </div>
                        <div class="flex items-center gap-2">
                          <input type="checkbox" id="cpPaymentCash" class="rounded border-green-300 text-green-600 focus:ring-green-500">
                          <label for="cpPaymentCash" class="text-xs text-green-700 dark:text-green-300">Cash (In Person)</label>
                        </div>
                        <div class="flex items-center gap-2">
                          <input type="checkbox" id="cpPaymentBank" class="rounded border-green-300 text-green-600 focus:ring-green-500">
                          <label for="cpPaymentBank" class="text-xs text-green-700 dark:text-green-300">Bank Transfer</label>
                        </div>
                        <div class="flex items-center gap-2">
                          <input type="checkbox" id="cpPaymentNegotiable" class="rounded border-green-300 text-green-600 focus:ring-green-500">
                          <label for="cpPaymentNegotiable" class="text-xs text-green-700 dark:text-green-300">Price Negotiable</label>
                        </div>
                      </div>
                    </div>

                    <!-- Contact Information -->
                    <div id="cpContactSection" class="hidden">
                      <label class="block text-xs font-medium text-green-700 dark:text-green-300 mb-2">üìû Contact Information</label>
                      <div class="space-y-2">
                        <input
                          id="cpPhoneNumber"
                          type="tel"
                          placeholder="Phone number for payments (e.g., 0241234567)"
                          class="w-full rounded-xl border border-green-200 dark:border-green-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all"
                        />
                        <select id="cpMeetupLocation" class="w-full rounded-xl border border-green-200 dark:border-green-700 bg-white dark:bg-slate-800 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                          <option value="">Preferred meetup location (for cash payments)</option>
                          <option value="campus-library">Campus Library</option>
                          <option value="student-union">Student Union Building</option>
                          <option value="main-gate">Main Gate</option>
                          <option value="cafeteria">Cafeteria</option>
                          <option value="negotiable">Location Negotiable</option>
                        </select>
                      </div>
                    </div>

                    <div class="flex items-center gap-2 text-xs text-green-600 dark:text-green-400">
                      <i class="fa-solid fa-info-circle"></i>
                      <span>Items will appear in the store and show a price tag on your post</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Action Bar -->
            <div class="px-4 py-4 border-t border-gray-100 dark:border-slate-800">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                  <button type="button" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors text-gray-600 dark:text-gray-400" id="cpBtnPhoto" title="Add Photo">
                    <i class="fa-regular fa-image text-lg"></i>
                  </button>
                  <button type="button" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors text-gray-600 dark:text-gray-400" id="cpBtnVideo" title="Add Video">
                    <i class="fa-regular fa-circle-play text-lg"></i>
                  </button>
                  <button type="button" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors text-gray-600 dark:text-gray-400" id="cpBtnLoc" title="Add Location">
                    <i class="fa-solid fa-location-dot text-lg"></i>
                  </button>
                  <button type="button" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors text-gray-600 dark:text-gray-400" id="cpBtnPoll" title="Add Poll">
                    <i class="fa-solid fa-chart-bar text-lg"></i>
                  </button>
                </div>
                <button id="cpPost" class="px-8 py-3 rounded-full bg-gradient-to-r from-primary to-purple-600 text-white font-bold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                  <i class="fa-solid fa-paper-plane mr-2"></i>Share
                </button>
              </div>
            </div>
          </div>

        <div class="bg-white dark:bg-dark-card rounded-2xl p-4">
          <h4 class="font-semibold mb-2">Guidelines</h4>
          <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
            <li><i class="fa-solid fa-check text-success mr-2"></i>Be authentic and respectful</li>
            <li><i class="fa-solid fa-check text-success mr-2"></i>Include helpful outfit details</li>
            <li><i class="fa-solid fa-check text-success mr-2"></i>Use relevant hashtags</li>
            <li><i class="fa-solid fa-xmark text-red-500 mr-2"></i>No offensive or unrelated content</li>
            <li><i class="fa-solid fa-xmark text-red-500 mr-2"></i>Do not post others‚Äô photos without permission</li>
          </ul>
        </div>
        </div>
      </section>

      <!-- Events -->
      <section id="page-events" class="hidden p-4 space-y-4">
        <button id="btnNewEvent" class="w-full bg-primary dark:bg-dark-primary text-white rounded-xl py-3 font-semibold tap-active">
          <i class="fa-solid fa-plus mr-2"></i>Create Event
        </button>
        <!-- Event Type Filters -->
        <div>
          <h4 class="font-semibold text-sm text-gray-600 dark:text-gray-400 mb-2">Event Type</h4>
          <div class="flex gap-2 overflow-x-auto pb-2">
            <button class="event-filter px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap" data-filter="all">All</button>
            <button class="event-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap" data-filter="fashion">Fashion Shows</button>
            <button class="event-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap" data-filter="workshop">Workshops</button>
            <button class="event-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap" data-filter="networking">Networking</button>
            <button class="event-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap" data-filter="my-events">My Events</button>
          </div>
        </div>

        <!-- Audience Filters -->
        <div>
          <h4 class="font-semibold text-sm text-gray-600 dark:text-gray-400 mb-2">Audience</h4>
          <div class="flex gap-2 overflow-x-auto pb-2">
            <button class="audience-filter px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap text-sm" data-audience="all">All Students</button>
            <button class="audience-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-audience="undergraduate">Undergraduate</button>
            <button class="audience-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-audience="graduate">Graduate</button>
            <button class="audience-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-audience="faculty">Faculty</button>
            <button class="audience-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-audience="alumni">Alumni</button>
            <button class="audience-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-audience="public">Public</button>
          </div>
        </div>
        <div id="eventsList" class="space-y-4">
          <!-- events injected -->
        </div>
      </section>



      <!-- Profile -->
      <section id="page-profile" class="hidden">
        <!-- Profile Header -->
        <div class="bg-white dark:bg-dark-card p-4">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="relative">
                <img id="pfAvatar" src="https://i.imgur.com/jL1aT9i.jpg" class="w-20 h-20 rounded-full object-cover cursor-pointer hover:opacity-80 transition-opacity" alt="me" onclick="openChangeAvatar()" />
                <button id="pfChangeAvatar" class="absolute bottom-0 right-0 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors" onclick="openChangeAvatar()">
                  <i class="fa-solid fa-camera text-sm"></i>
                </button>
                <!-- Premium Badge -->
                <div id="premiumBadge" class="absolute -top-1 -right-1 w-7 h-7 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center hidden">
                  <i class="fa-solid fa-crown text-white text-sm"></i>
                </div>
              </div>
              <div class="flex-1">
                <div id="pfName" class="text-xl font-bold">Alex Johnson</div>
                <div id="pfUsername" class="text-sm text-primary font-medium">@alexjohnson</div>
                <div id="pfBio" class="text-sm text-gray-600 dark:text-gray-400 mt-1">Business Student ‚Ä¢ Fashion Enthusiast</div>
                <div class="text-xs text-gray-400 mt-1">üìç University of Ghana ‚Ä¢ Joined May 2023</div>
              </div>
            </div>
            <button onclick="openProfileSettings()" class="p-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors">
              <i class="fa-solid fa-cog text-lg"></i>
            </button>
          </div>

          <!-- Stats -->
          <div class="grid grid-cols-4 text-center mb-4">
            <div>
              <div id="pfCountPosts" class="text-lg font-bold text-primary dark:text-dark-primary">0</div>
              <div class="text-xs text-gray-500">Posts</div>
            </div>
            <div>
              <div id="pfCountFollowers" class="text-lg font-bold text-primary dark:text-dark-primary">0</div>
              <div class="text-xs text-gray-500">Followers</div>
            </div>
            <div>
              <div id="pfCountFollowing" class="text-lg font-bold text-primary dark:text-dark-primary">0</div>
              <div class="text-xs text-gray-500">Following</div>
            </div>
            <div>
              <div id="pfCountLikes" class="text-lg font-bold text-primary dark:text-dark-primary">0</div>
              <div class="text-xs text-gray-500">Likes</div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-2">
            <button id="btnEditProfile" class="flex-1 px-4 py-2 bg-primary dark:bg-dark-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-colors">
              <i class="fa-solid fa-edit mr-2"></i>Edit Profile
            </button>
            <button onclick="shareProfile()" class="px-4 py-2 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors">
              <i class="fa-solid fa-share"></i>
            </button>
          </div>

          <!-- Subscription Status -->
          <div id="subscriptionStatusCard" class="mt-4 p-3 rounded-xl border-2 border-dashed border-yellow-300 bg-yellow-50 dark:bg-yellow-900/20">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold text-yellow-800 dark:text-yellow-200">Free Trial</div>
                <div class="text-xs text-yellow-600 dark:text-yellow-400" id="trialStatus">6 days remaining</div>
              </div>
              <button onclick="openSubscription()" class="px-3 py-1.5 bg-gradient-to-r from-yellow-500 to-orange-500 text-white rounded-lg text-xs font-medium hover:shadow-lg transition-all">
                <i class="fa-solid fa-crown mr-1"></i>Upgrade
              </button>
            </div>
          </div>
        </div>

        <!-- Profile Content Tabs -->
        <div class="bg-white dark:bg-dark-card">
          <!-- Tab Navigation -->
          <div class="flex border-b border-gray-200 dark:border-slate-700">
            <button class="profile-tab flex-1 py-3 px-4 text-sm font-medium text-primary border-b-2 border-primary" data-tab="posts">
              <i class="fa-solid fa-grid-2 mr-2"></i>Posts
            </button>
            <button class="profile-tab flex-1 py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" data-tab="comments">
              <i class="fa-solid fa-comments mr-2"></i>Comments
            </button>
            <button class="profile-tab flex-1 py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" data-tab="liked">
              <i class="fa-solid fa-heart mr-2"></i>Liked
            </button>
            <button class="profile-tab flex-1 py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 dark:hover:text-gray-300" data-tab="saved">
              <i class="fa-solid fa-bookmark mr-2"></i>Saved
            </button>
          </div>

          <!-- Tab Content -->
          <div class="p-4">
            <!-- Posts Tab -->
            <div id="profile-posts" class="profile-tab-content">
              <div id="pfGrid" class="grid grid-cols-3 gap-1">
                <!-- user posts grid -->
              </div>
              <div id="pfEmptyPosts" class="text-center py-12 hidden">
                <i class="fa-solid fa-camera text-4xl text-gray-300 dark:text-slate-600 mb-3"></i>
                <div class="text-gray-500 dark:text-gray-400 mb-3">No posts yet</div>
                <button onclick="switchTab('create')" class="px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors">
                  Create Your First Post
                </button>
              </div>
            </div>

            <!-- Comments Tab -->
            <div id="profile-comments" class="profile-tab-content hidden">
              <div id="pfCommentsList" class="space-y-3">
                <!-- user comments -->
              </div>
              <div id="pfEmptyComments" class="text-center py-12 hidden">
                <i class="fa-solid fa-comment text-4xl text-gray-300 dark:text-slate-600 mb-3"></i>
                <div class="text-gray-500 dark:text-gray-400">No comments yet</div>
              </div>
            </div>

            <!-- Liked Tab -->
            <div id="profile-liked" class="profile-tab-content hidden">
              <div id="pfLikedGrid" class="grid grid-cols-3 gap-1">
                <!-- liked posts grid -->
              </div>
              <div id="pfEmptyLiked" class="text-center py-12 hidden">
                <i class="fa-solid fa-heart text-4xl text-gray-300 dark:text-slate-600 mb-3"></i>
                <div class="text-gray-500 dark:text-gray-400">No liked posts yet</div>
              </div>
            </div>

            <!-- Saved Tab -->
            <div id="profile-saved" class="profile-tab-content hidden">
              <div id="pfSavedGrid" class="grid grid-cols-3 gap-1">
                <!-- saved posts grid -->
              </div>
              <div id="pfEmptySaved" class="text-center py-12 hidden">
                <i class="fa-solid fa-bookmark text-4xl text-gray-300 dark:text-slate-600 mb-3"></i>
                <div class="text-gray-500 dark:text-gray-400">No saved posts yet</div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Bottom Tabbar -->
    <nav class="tabbar safe-bottom">
      <div class="px-4 py-2 grid grid-cols-5 text-xs">
        <button class="tab-link flex flex-col items-center text-primary" data-tab="home">
          <i class="fa-solid fa-house text-lg"></i>
          <span>Home</span>
        </button>
        <button class="tab-link flex flex-col items-center text-gray-500" data-tab="faculties">
          <i class="fa-solid fa-university text-lg"></i>
          <span>Faculties</span>
        </button>
        <button class="tab-link flex flex-col items-center -mt-6" data-tab="create">
          <div class="bg-gradient-to-r from-primary to-accent rounded-full p-3 text-white shadow">
            <i class="fa-solid fa-plus text-lg"></i>
          </div>
          <span class="mt-1 text-primary font-semibold">Post</span>
        </button>
        <button class="tab-link flex flex-col items-center text-gray-500" data-tab="events">
          <i class="fa-solid fa-calendar-days text-lg"></i>
          <span>Events</span>
        </button>
        <button class="tab-link flex flex-col items-center text-gray-500" data-tab="profile">
          <i class="fa-solid fa-user text-lg"></i>
          <span>Profile</span>
        </button>
      </div>
    </nav>

    <!-- Floating Action Buttons -->
    <div class="fixed bottom-20 right-4 z-40 flex flex-col space-y-3">
      <!-- Store FAB -->
      <button id="store-fab" class="w-14 h-14 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-all duration-200" onclick="openStore()">
        <i class="fa-solid fa-bag-shopping text-lg"></i>
        <span id="cartBadge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">0</span>
      </button>

      <!-- Connections FAB -->
      <button id="connections-fab" class="w-14 h-14 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-all duration-200" onclick="openConnections()">
        <i class="fa-solid fa-users text-lg"></i>
        <span id="connectionsBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">5</span>
      </button>

      <!-- Messages FAB -->
      <button id="messages-fab" class="w-14 h-14 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-all duration-200" onclick="openMessages()">
        <i class="fa-solid fa-comment-alt text-lg"></i>
        <span id="messagesBadge" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">3</span>
      </button>
    </div>
  </div>

  <!-- Global Overlay -->
  <div id="overlay" class="overlay"></div>

  <!-- Sheets / Modals -->

  <!-- More actions sheet -->
  <div id="sheetMore" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Quick Actions</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetMore">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Main Actions -->
        <div>
          <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Main Actions</h4>
          <div class="grid grid-cols-3 gap-3">
            <button id="qaMessages" class="p-4 rounded-2xl bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 hover:shadow-lg transition-all text-center">
              <i class="fa-solid fa-message text-2xl mb-2 text-blue-600"></i>
              <div class="text-sm font-semibold text-blue-800 dark:text-blue-300">Messages</div>
            </button>
            <button id="qaCart" class="relative p-4 rounded-2xl bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 hover:shadow-lg transition-all text-center">
              <i class="fa-solid fa-cart-shopping text-2xl mb-2 text-purple-600"></i>
              <div class="text-sm font-semibold text-purple-800 dark:text-purple-300">Cart</div>
              <div id="cartBadgeQA" class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center hidden">0</div>
            </button>
            <button id="qaBookmarks" class="p-4 rounded-2xl bg-gradient-to-br from-yellow-50 to-yellow-100 dark:from-yellow-900/20 dark:to-yellow-800/20 hover:shadow-lg transition-all text-center">
              <i class="fa-solid fa-bookmark text-2xl mb-2 text-yellow-600"></i>
              <div class="text-sm font-semibold text-yellow-800 dark:text-yellow-300">Bookmarks</div>
            </button>
            <button id="qaConnections" class="p-4 rounded-2xl bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 hover:shadow-lg transition-all text-center">
              <i class="fa-solid fa-users text-2xl mb-2 text-green-600"></i>
              <div class="text-sm font-semibold text-green-800 dark:text-green-300">Connections</div>
            </button>
            <button id="qaFaculty" class="p-4 rounded-2xl bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 hover:shadow-lg transition-all text-center">
              <i class="fa-solid fa-university text-2xl mb-2 text-indigo-600"></i>
              <div class="text-sm font-semibold text-indigo-800 dark:text-indigo-300">Faculties</div>
            </button>
          </div>
        </div>

        <!-- Premium Features -->
        <div id="premiumActionsSection">
          <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Premium Features</h4>
          <div class="grid grid-cols-2 gap-3">
            <button id="qaRankings" class="p-4 rounded-2xl bg-gradient-to-br from-yellow-50 to-orange-100 dark:from-yellow-900/20 dark:to-orange-800/20 hover:shadow-lg transition-all text-center border border-yellow-200 dark:border-yellow-800/30">
              <i class="fa-solid fa-trophy text-2xl mb-2 text-orange-600"></i>
              <div class="text-sm font-semibold text-orange-800 dark:text-orange-300">Rankings</div>
              <div class="text-xs text-orange-500">‚Çµ150 Prize Pool</div>
            </button>
            <button id="qaSellerDashboard" class="p-4 rounded-2xl bg-gradient-to-br from-emerald-50 to-teal-100 dark:from-emerald-900/20 dark:to-teal-800/20 hover:shadow-lg transition-all text-center border border-emerald-200 dark:border-emerald-800/30">
              <i class="fa-solid fa-store text-2xl mb-2 text-emerald-600"></i>
              <div class="text-sm font-semibold text-emerald-800 dark:text-emerald-300">My Store</div>
              <div class="text-xs text-emerald-500">Manage Items</div>
            </button>
          </div>
        </div>

        <!-- Free User CTA -->
        <div id="freeUserActionsSection" class="hidden">
          <div class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl p-4 border border-purple-200 dark:border-purple-800/30">
            <div class="text-center">
              <div class="w-12 h-12 mx-auto rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center mb-3">
                <i class="fa-solid fa-crown text-white"></i>
              </div>
              <div class="font-bold text-purple-900 dark:text-purple-100 mb-1">Unlock Premium Features</div>
              <div class="text-sm text-purple-700 dark:text-purple-300 mb-3">Access rankings, seller dashboard, and more!</div>
              <button onclick="openSubscription()" class="px-4 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-xl font-medium hover:shadow-lg transition-all">
                <i class="fa-solid fa-sparkles mr-1"></i>Upgrade Now
              </button>
            </div>
          </div>
        </div>

        <!-- Other Actions -->
        <div>
          <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Other</h4>
          <div class="grid grid-cols-1 gap-3">
            <button id="qaLogout" class="p-4 rounded-2xl bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 hover:shadow-lg transition-all text-center">
              <i class="fa-solid fa-right-from-bracket text-2xl mb-2 text-red-600"></i>
              <div class="text-sm font-semibold text-red-800 dark:text-red-300">Logout</div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search sheet -->
  <div id="sheetSearch" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="mt-2">
        <div class="relative">
          <input id="searchInput" class="w-full rounded-2xl border border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-900 pl-12 pr-12 py-4 text-lg focus:outline-none focus:ring-2 focus:ring-primary focus:bg-white dark:focus:bg-slate-800 transition-colors" placeholder="Search users, tags, posts..." />
          <i class="fa-solid fa-magnifying-glass text-gray-400 absolute left-4 top-1/2 -translate-y-1/2 text-lg"></i>
          <button id="searchClear" class="text-gray-400 hover:text-gray-600 absolute right-4 top-1/2 -translate-y-1/2 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>

        <!-- Quick filters -->
        <div class="flex gap-2 mt-4 overflow-x-auto pb-2">
          <button class="search-filter px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap text-sm font-medium" data-filter="all">All</button>
          <button class="search-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="users">Users</button>
          <button class="search-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="posts">Posts</button>
          <button class="search-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="tags">Tags</button>
        </div>
      </div>
    </div>
    <div class="sheet-content">
      <div id="searchResults" class="p-4 space-y-3"></div>
    </div>
  </div>

  <!-- Notifications sheet -->
  <div id="sheetNotif" class="sheet">
    <div class="sheet-header">
      <div class="mx-auto h-1 w-10 rounded-full bg-gray-300 dark:bg-slate-700 mb-3"></div>
      <div class="flex items-center justify-between">
        <h3 class="font-bold text-lg">Notifications</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetNotif">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div id="notifList" class="p-4 space-y-2"></div>
    </div>
  </div>

  <!-- Comments sheet -->
  <div id="sheetComments" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Comments</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetComments">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content flex flex-col">
      <div id="commentsBody" class="flex-1 p-4 space-y-4 overflow-y-auto"></div>
    </div>
    <div class="sheet-footer">
      <div class="flex items-center gap-3">
        <img src="https://i.imgur.com/jL1aT9i.jpg" class="w-8 h-8 rounded-full object-cover" alt="Your avatar" />
        <input id="commentInput" class="flex-1 rounded-full border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Add a comment..." />
        <button id="commentSend" class="px-4 py-2 rounded-full bg-primary text-white hover:bg-primary/90 transition-colors font-medium">
          Post
        </button>
      </div>
    </div>
  </div>

  <!-- Post detail sheet -->
  <div id="sheetPost" class="sheet p-0">
    <div class="mx-auto h-1 w-10 rounded-full bg-gray-300 dark:bg-slate-700 my-2"></div>
    <div id="postDetail" class="max-h-[75vh] overflow-y-auto">
      <!-- injected -->
    </div>
  </div>

  <!-- Store item sheet -->
  <div id="sheetItem" class="sheet p-0">
    <div class="mx-auto h-1 w-10 rounded-full bg-gray-300 dark:bg-slate-700 my-2"></div>
    <div id="itemDetail" class="max-h-[75vh] overflow-y-auto">
      <!-- injected -->
    </div>
  </div>

  <!-- Store sheet -->
  <div id="sheetStore" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">üõçÔ∏è Raved Store</h3>
        <div class="flex items-center gap-2">
          <button onclick="openCart()" class="relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors">
            <i class="fa-solid fa-shopping-cart text-lg"></i>
            <span id="storeCartBadge" class="hidden absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center">0</span>
          </button>
          <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetStore">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-4">
        <!-- Store Banner -->
        <div class="bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-4 text-white">
          <div class="flex items-center justify-between">
            <div>
              <h2 class="text-lg font-bold mb-1">Campus Fashion Hub</h2>
              <p class="text-purple-100 text-sm mb-3">Discover unique styles from your fellow students</p>
              <div class="flex items-center gap-4 text-xs">
                <div class="flex items-center gap-1">
                  <i class="fa-solid fa-users"></i>
                  <span id="storeSellersCount">150+ sellers</span>
                </div>
                <div class="flex items-center gap-1">
                  <i class="fa-solid fa-shirt"></i>
                  <span id="storeItemsCount">500+ items</span>
                </div>
              </div>
            </div>
            <div class="text-4xl opacity-20">
              <i class="fa-solid fa-bag-shopping"></i>
            </div>
          </div>
        </div>

        <!-- Category Filters -->
        <div class="bg-white dark:bg-slate-900 rounded-2xl p-4 border border-gray-200 dark:border-slate-700">
          <h3 class="font-bold mb-3 text-sm">Shop by Category</h3>
          <div class="grid grid-cols-2 gap-2">
            <button class="store-category-filter bg-primary text-white p-2 rounded-lg font-medium transition-all text-sm" data-category="all">
              <i class="fa-solid fa-grid-2 mb-1"></i>
              <div class="text-xs">All Items</div>
            </button>
            <button class="store-category-filter bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 transition-all text-sm" data-category="clothing">
              <i class="fa-solid fa-shirt mb-1"></i>
              <div class="text-xs">Clothing</div>
            </button>
            <button class="store-category-filter bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 transition-all text-sm" data-category="accessories">
              <i class="fa-solid fa-gem mb-1"></i>
              <div class="text-xs">Accessories</div>
            </button>
            <button class="store-category-filter bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 transition-all text-sm" data-category="shoes">
              <i class="fa-solid fa-shoe-prints mb-1"></i>
              <div class="text-xs">Shoes</div>
            </button>
          </div>
        </div>

        <!-- Sort & Filter -->
        <div class="flex items-center justify-between">
          <h3 class="font-bold text-sm">Browse Items</h3>
          <div class="flex items-center gap-2">
            <select id="storeSortSelect" class="px-3 py-1.5 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-lg text-xs border-none focus:ring-2 focus:ring-primary" onchange="sortStoreItems()">
              <option value="newest">Newest</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
              <option value="popular">Most Popular</option>
            </select>
          </div>
        </div>

        <!-- Items Grid -->
        <div id="storeItemsGrid" class="grid grid-cols-2 gap-3">
          <!-- Store items will be injected here -->
        </div>

        <!-- Load More -->
        <button id="btnLoadMoreStore" class="w-full mt-4 py-3 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors text-sm">
          Load More Items
        </button>

        <!-- Sell Your Items -->
        <div class="bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl p-4 border border-green-200 dark:border-green-800/30">
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-bold text-green-800 dark:text-green-200 text-sm">Start Selling</h3>
              <p class="text-xs text-green-600 dark:text-green-400 mt-1">Turn your closet into cash</p>
            </div>
            <button onclick="openSellItem()" class="px-3 py-2 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition-colors text-sm">
              <i class="fa-solid fa-plus mr-1"></i>Sell Item
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Detail sheet -->
  <div id="sheetProductDetail" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <button onclick="closeProductDetail()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors">
          <i class="fa-solid fa-arrow-left text-lg"></i>
        </button>
        <div class="flex items-center gap-2">
          <button onclick="shareProduct()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors">
            <i class="fa-solid fa-share text-lg"></i>
          </button>
          <button onclick="toggleProductSave()" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors">
            <i id="productSaveIcon" class="fa-regular fa-bookmark text-lg"></i>
          </button>
          <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetProductDetail">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
      </div>
    </div>
    <div class="sheet-content">
      <div id="productDetailContent">
        <!-- Product content will be injected here -->
      </div>
    </div>
  </div>

  <!-- Theme Selector sheet -->
  <div id="sheetThemes" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">üé® Premium Themes</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetThemes">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Premium Badge -->
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-2xl p-4 border border-yellow-200 dark:border-yellow-800/30">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center">
              <i class="fa-solid fa-crown text-white"></i>
            </div>
            <div>
              <div class="font-bold text-yellow-900 dark:text-yellow-100">Premium Feature</div>
              <div class="text-sm text-yellow-700 dark:text-yellow-300">Exclusive themes for premium members</div>
            </div>
          </div>
        </div>

        <!-- Theme Categories -->
        <div>
          <h4 class="font-bold text-lg mb-4">üåà Theme Collections</h4>

          <!-- Classic Themes -->
          <div class="mb-6">
            <h5 class="font-semibold mb-3 text-gray-700 dark:text-gray-300">Classic Collection</h5>
            <div class="grid grid-cols-2 gap-3">
              <!-- Default Theme -->
              <div class="theme-option p-4 rounded-xl border-2 border-primary bg-white dark:bg-slate-900 cursor-pointer hover:shadow-lg transition-all" data-theme="default">
                <div class="theme-preview mb-3">
                  <div class="w-full h-16 rounded-lg bg-gradient-to-br from-primary to-purple-600 mb-2 flex items-center justify-center">
                    <i class="fa-solid fa-sparkles text-white text-xl"></i>
                  </div>
                  <div class="space-y-1">
                    <div class="w-full h-2 rounded bg-primary/20"></div>
                    <div class="w-3/4 h-2 rounded bg-gray-200 dark:bg-slate-700"></div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="font-semibold text-sm">Raved Classic</div>
                  <div class="text-xs text-gray-500">Purple & Blue</div>
                </div>
              </div>

              <!-- Rose Theme -->
              <div class="theme-option p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 cursor-pointer hover:shadow-lg transition-all" data-theme="rose">
                <div class="theme-preview mb-3">
                  <div class="w-full h-16 rounded-lg bg-gradient-to-br from-pink-500 to-rose-600 mb-2 flex items-center justify-center">
                    <i class="fa-solid fa-heart text-white text-xl"></i>
                  </div>
                  <div class="space-y-1">
                    <div class="w-full h-2 rounded bg-pink-200"></div>
                    <div class="w-3/4 h-2 rounded bg-gray-200 dark:bg-slate-700"></div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="font-semibold text-sm">Rose Garden</div>
                  <div class="text-xs text-gray-500">Pink & Rose</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Nature Themes -->
          <div class="mb-6">
            <h5 class="font-semibold mb-3 text-gray-700 dark:text-gray-300">Nature Collection</h5>
            <div class="grid grid-cols-2 gap-3">
              <!-- Emerald Theme -->
              <div class="theme-option p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 cursor-pointer hover:shadow-lg transition-all" data-theme="emerald">
                <div class="theme-preview mb-3">
                  <div class="w-full h-16 rounded-lg bg-gradient-to-br from-emerald-500 to-teal-600 mb-2 flex items-center justify-center">
                    <i class="fa-solid fa-leaf text-white text-xl"></i>
                  </div>
                  <div class="space-y-1">
                    <div class="w-full h-2 rounded bg-emerald-200"></div>
                    <div class="w-3/4 h-2 rounded bg-gray-200 dark:bg-slate-700"></div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="font-semibold text-sm">Emerald Forest</div>
                  <div class="text-xs text-gray-500">Green & Teal</div>
                </div>
              </div>

              <!-- Ocean Theme -->
              <div class="theme-option p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 cursor-pointer hover:shadow-lg transition-all" data-theme="ocean">
                <div class="theme-preview mb-3">
                  <div class="w-full h-16 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-600 mb-2 flex items-center justify-center">
                    <i class="fa-solid fa-water text-white text-xl"></i>
                  </div>
                  <div class="space-y-1">
                    <div class="w-full h-2 rounded bg-blue-200"></div>
                    <div class="w-3/4 h-2 rounded bg-gray-200 dark:bg-slate-700"></div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="font-semibold text-sm">Ocean Breeze</div>
                  <div class="text-xs text-gray-500">Blue & Cyan</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Vibrant Themes -->
          <div class="mb-6">
            <h5 class="font-semibold mb-3 text-gray-700 dark:text-gray-300">Vibrant Collection</h5>
            <div class="grid grid-cols-2 gap-3">
              <!-- Sunset Theme -->
              <div class="theme-option p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 cursor-pointer hover:shadow-lg transition-all" data-theme="sunset">
                <div class="theme-preview mb-3">
                  <div class="w-full h-16 rounded-lg bg-gradient-to-br from-orange-500 to-red-600 mb-2 flex items-center justify-center">
                    <i class="fa-solid fa-sun text-white text-xl"></i>
                  </div>
                  <div class="space-y-1">
                    <div class="w-full h-2 rounded bg-orange-200"></div>
                    <div class="w-3/4 h-2 rounded bg-gray-200 dark:bg-slate-700"></div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="font-semibold text-sm">Sunset Glow</div>
                  <div class="text-xs text-gray-500">Orange & Red</div>
                </div>
              </div>

              <!-- Galaxy Theme -->
              <div class="theme-option p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 cursor-pointer hover:shadow-lg transition-all" data-theme="galaxy">
                <div class="theme-preview mb-3">
                  <div class="w-full h-16 rounded-lg bg-gradient-to-br from-indigo-600 to-purple-700 mb-2 flex items-center justify-center">
                    <i class="fa-solid fa-star text-white text-xl"></i>
                  </div>
                  <div class="space-y-1">
                    <div class="w-full h-2 rounded bg-indigo-200"></div>
                    <div class="w-3/4 h-2 rounded bg-gray-200 dark:bg-slate-700"></div>
                  </div>
                </div>
                <div class="text-center">
                  <div class="font-semibold text-sm">Galaxy Night</div>
                  <div class="text-xs text-gray-500">Indigo & Purple</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Apply Theme Button -->
        <button id="btnApplyTheme" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          <i class="fa-solid fa-palette mr-2"></i>Apply Selected Theme
        </button>

        <!-- Theme Info -->
        <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
          <div class="flex items-start gap-2">
            <i class="fa-solid fa-info-circle text-blue-600 mt-0.5"></i>
            <div class="text-sm text-gray-700 dark:text-gray-300">
              <div class="font-medium mb-1">About Premium Themes</div>
              <div>Premium themes change the app's color scheme and visual style. Your selected theme will be applied across all screens and features.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Seller Dashboard sheet -->
  <div id="sheetSellerDashboard" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">üè™ My Store Dashboard</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetSellerDashboard">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Store Stats -->
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-2xl p-4 border border-blue-200 dark:border-blue-800/30">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-2xl font-bold text-blue-900 dark:text-blue-100" id="totalItems">0</div>
                <div class="text-sm text-blue-700 dark:text-blue-300">Total Items</div>
              </div>
              <i class="fa-solid fa-box text-blue-600 text-2xl"></i>
            </div>
          </div>
          <div class="bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl p-4 border border-green-200 dark:border-green-800/30">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-2xl font-bold text-green-900 dark:text-green-100" id="totalSales">‚Çµ0</div>
                <div class="text-sm text-green-700 dark:text-green-300">Total Sales</div>
              </div>
              <i class="fa-solid fa-chart-line text-green-600 text-2xl"></i>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div>
          <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Quick Actions</h4>
          <div class="grid grid-cols-2 gap-3">
            <button onclick="openCreateStoreItem()" class="p-4 rounded-xl bg-gradient-to-r from-primary to-purple-600 text-white hover:shadow-lg transition-all">
              <i class="fa-solid fa-plus text-xl mb-2"></i>
              <div class="text-sm font-medium">Add New Item</div>
            </button>
            <button onclick="openBulkActions()" class="p-4 rounded-xl bg-gradient-to-r from-orange-500 to-red-500 text-white hover:shadow-lg transition-all">
              <i class="fa-solid fa-tags text-xl mb-2"></i>
              <div class="text-sm font-medium">Bulk Discount</div>
            </button>
          </div>
        </div>

        <!-- My Items -->
        <div>
          <div class="flex items-center justify-between mb-3">
            <h4 class="font-semibold text-gray-700 dark:text-gray-300">My Items</h4>
            <button onclick="refreshSellerItems()" class="text-primary hover:text-primary-dark text-sm">
              <i class="fa-solid fa-refresh mr-1"></i>Refresh
            </button>
          </div>
          <div id="sellerItemsList" class="space-y-3">
            <!-- seller items will be injected here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Rankings sheet -->
  <div id="sheetRankings" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">üèÜ Creator Rankings</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetRankings">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Prize Pool -->
        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-2xl p-4 border border-yellow-200 dark:border-yellow-800/30">
          <div class="text-center">
            <div class="text-2xl font-bold text-yellow-900 dark:text-yellow-100 mb-1">‚Çµ150 Prize Pool</div>
            <div class="text-sm text-yellow-700 dark:text-yellow-300">This month's total rewards</div>
            <div class="mt-2 text-xs text-yellow-600 dark:text-yellow-400">
              ü•á 1st Place: ‚Çµ75 ‚Ä¢ ü•à 2nd Place: ‚Çµ45 ‚Ä¢ ü•â 3rd Place: ‚Çµ30
            </div>
          </div>
        </div>

        <!-- Ranking Filters -->
        <div>
          <div class="flex gap-2 overflow-x-auto pb-2">
            <button class="ranking-filter px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap text-sm font-medium" data-period="week">This Week</button>
            <button class="ranking-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-period="month">This Month</button>
            <button class="ranking-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-period="all">All Time</button>
          </div>
        </div>

        <!-- Top 3 Podium -->
        <div id="podiumSection">
          <h4 class="font-bold mb-4">üèÜ Top 3 This Week</h4>
          <div class="flex items-end justify-center gap-4 mb-6">
            <!-- 2nd Place -->
            <div class="text-center">
              <div class="w-16 h-20 bg-gradient-to-t from-gray-300 to-gray-400 rounded-t-lg flex items-end justify-center pb-2">
                <span class="text-white font-bold">2</span>
              </div>
              <img id="rank2Avatar" src="" class="w-12 h-12 rounded-full object-cover mx-auto mt-2 border-2 border-gray-400" />
              <div id="rank2Name" class="text-sm font-semibold mt-1">Sarah M.</div>
              <div id="rank2Score" class="text-xs text-gray-500">2,340 pts</div>
            </div>

            <!-- 1st Place -->
            <div class="text-center">
              <div class="w-16 h-24 bg-gradient-to-t from-yellow-400 to-yellow-500 rounded-t-lg flex items-end justify-center pb-2">
                <span class="text-white font-bold">1</span>
              </div>
              <img id="rank1Avatar" src="" class="w-14 h-14 rounded-full object-cover mx-auto mt-2 border-2 border-yellow-500" />
              <div id="rank1Name" class="text-sm font-semibold mt-1">Alex J.</div>
              <div id="rank1Score" class="text-xs text-gray-500">3,120 pts</div>
              <div class="text-xs text-yellow-600 font-medium">üëë Champion</div>
            </div>

            <!-- 3rd Place -->
            <div class="text-center">
              <div class="w-16 h-16 bg-gradient-to-t from-orange-400 to-orange-500 rounded-t-lg flex items-end justify-center pb-2">
                <span class="text-white font-bold">3</span>
              </div>
              <img id="rank3Avatar" src="" class="w-12 h-12 rounded-full object-cover mx-auto mt-2 border-2 border-orange-500" />
              <div id="rank3Name" class="text-sm font-semibold mt-1">Mike R.</div>
              <div id="rank3Score" class="text-xs text-gray-500">1,890 pts</div>
            </div>
          </div>
        </div>

        <!-- Full Rankings List -->
        <div>
          <h4 class="font-bold mb-4">üìä Complete Rankings</h4>
          <div id="rankingsList" class="space-y-3">
            <!-- rankings injected -->
          </div>
        </div>

        <!-- Scoring System -->
        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-2xl p-4">
          <h5 class="font-semibold mb-3 text-blue-900 dark:text-blue-100">üìà How Scoring Works</h5>
          <div class="space-y-2 text-sm text-blue-800 dark:text-blue-200">
            <div class="flex justify-between">
              <span>Post Like</span>
              <span class="font-medium">+10 points</span>
            </div>
            <div class="flex justify-between">
              <span>Post Comment</span>
              <span class="font-medium">+15 points</span>
            </div>
            <div class="flex justify-between">
              <span>Post Share</span>
              <span class="font-medium">+20 points</span>
            </div>
            <div class="flex justify-between">
              <span>Store Item Sale</span>
              <span class="font-medium">+50 points</span>
            </div>
            <div class="flex justify-between">
              <span>Weekly Feature</span>
              <span class="font-medium">+100 points</span>
            </div>
          </div>
        </div>

        <!-- Subscription CTA for Free Users -->
        <div id="rankingSubscriptionCTA" class="bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-2xl p-4 border border-purple-200 dark:border-purple-800/30">
          <div class="text-center">
            <div class="text-lg font-bold text-purple-900 dark:text-purple-100 mb-2">Join the Competition!</div>
            <div class="text-sm text-purple-700 dark:text-purple-300 mb-3">Subscribe to Premium to participate in rankings and win cash prizes</div>
            <button onclick="openSubscription()" class="px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full font-medium hover:shadow-lg transition-all">
              <i class="fa-solid fa-crown mr-2"></i>Subscribe Now
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Subscription sheet -->
  <div id="sheetSubscription" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Raved Premium</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetSubscription">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Current Status -->
        <div id="subscriptionStatus" class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-2xl p-4 border border-yellow-200 dark:border-yellow-800/30">
          <div class="flex items-center gap-3 mb-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center">
              <i class="fa-solid fa-crown text-white"></i>
            </div>
            <div>
              <h4 class="font-bold text-yellow-900 dark:text-yellow-100">Free Trial</h4>
              <p class="text-sm text-yellow-700 dark:text-yellow-300" id="trialDaysLeft">6 days remaining</p>
            </div>
          </div>
          <p class="text-sm text-yellow-800 dark:text-yellow-200">Upgrade to Premium to unlock all features and join the rankings!</p>
        </div>

        <!-- Premium Features -->
        <div>
          <h4 class="font-bold text-lg mb-4">‚ú® Premium Features</h4>
          <div class="space-y-3">
            <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                <i class="fa-solid fa-trophy text-white text-sm"></i>
              </div>
              <div>
                <div class="font-semibold text-purple-900 dark:text-purple-100">Monthly Rankings</div>
                <div class="text-sm text-purple-700 dark:text-purple-300">Compete for top spots and win cash prizes</div>
              </div>
            </div>

            <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center">
                <i class="fa-solid fa-star text-white text-sm"></i>
              </div>
              <div>
                <div class="font-semibold text-blue-900 dark:text-blue-100">Weekly Features</div>
                <div class="text-sm text-blue-700 dark:text-blue-300">Get featured on the main page</div>
              </div>
            </div>

            <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                <i class="fa-solid fa-chart-line text-white text-sm"></i>
              </div>
              <div>
                <div class="font-semibold text-green-900 dark:text-green-100">Advanced Analytics</div>
                <div class="text-sm text-green-700 dark:text-green-300">Detailed insights on your posts and engagement</div>
              </div>
            </div>

            <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 rounded-xl">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center">
                <i class="fa-solid fa-palette text-white text-sm"></i>
              </div>
              <div>
                <div class="font-semibold text-indigo-900 dark:text-indigo-100">Premium Themes</div>
                <div class="text-sm text-indigo-700 dark:text-indigo-300">Exclusive app themes and customization</div>
              </div>
            </div>

            <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-rose-50 to-pink-50 dark:from-rose-900/20 dark:to-pink-900/20 rounded-xl">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-rose-500 to-pink-500 flex items-center justify-center">
                <i class="fa-solid fa-bolt text-white text-sm"></i>
              </div>
              <div>
                <div class="font-semibold text-rose-900 dark:text-rose-100">Priority Support</div>
                <div class="text-sm text-rose-700 dark:text-rose-300">Get help faster with premium support</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pricing -->
        <div>
          <h4 class="font-bold text-lg mb-4">üí∞ Pricing</h4>
          <div class="bg-gradient-to-r from-primary to-purple-600 rounded-2xl p-6 text-white">
            <div class="text-center">
              <div class="text-3xl font-bold mb-2">‚Çµ5.00</div>
              <div class="text-lg mb-1">per week</div>
              <div class="text-sm opacity-80">Unlock all premium features</div>
            </div>
          </div>
        </div>

        <!-- Payment Methods -->
        <div>
          <h4 class="font-bold text-lg mb-4">üí≥ Payment Methods</h4>
          <div class="grid grid-cols-1 gap-3">
            <button class="payment-method p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 hover:border-primary transition-colors flex items-center gap-3" onclick="selectPaymentMethod('momo')">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center">
                <i class="fa-solid fa-mobile-alt text-white"></i>
              </div>
              <div class="text-left">
                <div class="font-semibold">Mobile Money</div>
                <div class="text-sm text-gray-500">MTN, Vodafone, AirtelTigo</div>
              </div>
            </button>

            <button class="payment-method p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 hover:border-primary transition-colors flex items-center gap-3" onclick="selectPaymentMethod('card')">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center">
                <i class="fa-solid fa-credit-card text-white"></i>
              </div>
              <div class="text-left">
                <div class="font-semibold">Debit/Credit Card</div>
                <div class="text-sm text-gray-500">Visa, Mastercard</div>
              </div>
            </button>
          </div>
        </div>

        <!-- Subscribe Button -->
        <button id="btnSubscribe" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all">
          <i class="fa-solid fa-crown mr-2"></i>Subscribe to Premium
        </button>

        <!-- Free Features Info -->
        <div class="bg-gray-50 dark:bg-slate-800 rounded-2xl p-4">
          <h5 class="font-semibold mb-2">Free Account Limitations:</h5>
          <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
            <li>‚Ä¢ Basic posting and following</li>
            <li>‚Ä¢ Limited to 5 store items</li>
            <li>‚Ä¢ No ranking participation</li>
            <li>‚Ä¢ No weekly features</li>
            <li>‚Ä¢ Basic analytics only</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Add to Store sheet -->
  <div id="sheetAddToStore" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Add Item to Store</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetAddToStore">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Item Photos -->
        <div>
          <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 block">üì∏ Item Photos</label>
          <div id="storeUpload" class="rounded-2xl border-2 border-dashed border-gray-200 dark:border-slate-700 p-6 text-center transition-all hover:border-green-500/50 hover:bg-green-50/50 dark:hover:bg-green-900/10">
            <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-br from-green-500/10 to-emerald-500/10 flex items-center justify-center mb-3">
              <i class="fa-solid fa-camera text-2xl text-green-600"></i>
            </div>
            <h3 class="font-semibold text-gray-900 dark:text-gray-100 mb-1">Add item photos</h3>
            <p class="text-sm text-gray-500 mb-3">Show your item from multiple angles</p>
            <input id="storeFile" type="file" accept="image/*" class="hidden" multiple />
            <button id="storeUploadBtn" class="px-6 py-2.5 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-full font-medium hover:shadow-lg transition-all">
              <i class="fa-solid fa-plus mr-2"></i>Choose Photos
            </button>
          </div>
          <div id="storePreview" class="mt-4 grid grid-cols-3 gap-3 hidden"></div>
        </div>

        <!-- Item Details -->
        <div>
          <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 block">üìù Item Information</label>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Item Name</label>
              <input
                id="storeItemName"
                type="text"
                placeholder="e.g., Vintage Denim Jacket, Designer Handbag..."
                class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all"
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
              <textarea
                id="storeItemDescription"
                rows="3"
                placeholder="Describe the item, its condition, why you're selling it, styling tips..."
                class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all resize-none"
              ></textarea>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Brand</label>
                <input
                  id="storeItemBrand"
                  type="text"
                  placeholder="e.g., Zara, H&M, Vintage..."
                  class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category</label>
                <select id="storeItemCategory" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                  <option value="clothing">Clothing</option>
                  <option value="shoes">Shoes</option>
                  <option value="accessories">Accessories</option>
                  <option value="bags">Bags</option>
                  <option value="jewelry">Jewelry</option>
                </select>
              </div>
            </div>

            <div class="grid grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Size</label>
                  <label for="storeItemSize"></label><select id="storeItemSize" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                  <option value="">Select Size</option>
                  <option value="XS">XS</option>
                  <option value="S">S</option>
                  <option value="M">M</option>
                  <option value="L">L</option>
                  <option value="XL">XL</option>
                  <option value="XXL">XXL</option>
                  <option value="One Size">One Size</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Condition</label>
                <select id="storeItemCondition" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                  <option value="new">New</option>
                  <option value="like-new">Like New</option>
                  <option value="good">Good</option>
                  <option value="fair">Fair</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Price ($)</label>
                <input
                  id="storeItemPrice"
                  type="number"
                  min="1"
                  step="0.01"
                  placeholder="25.00"
                  class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- Payment & Contact Information -->
        <div>
          <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 block">üí≥ Payment & Contact</label>
          <div class="space-y-4">
            <!-- Payment Methods -->
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Payment Methods Accepted</label>
              <div class="grid grid-cols-2 gap-2">
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="storePaymentMomo" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                  <label for="storePaymentMomo" class="text-sm">Mobile Money</label>
                </div>
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="storePaymentCash" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                  <label for="storePaymentCash" class="text-sm">Cash (In Person)</label>
                </div>
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="storePaymentBank" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                  <label for="storePaymentBank" class="text-sm">Bank Transfer</label>
                </div>
                <div class="flex items-center gap-2">
                  <input type="checkbox" id="storePaymentNegotiable" class="rounded border-gray-300 text-green-600 focus:ring-green-500">
                  <label for="storePaymentNegotiable" class="text-sm">Price Negotiable</label>
                </div>
              </div>
            </div>

            <!-- Contact Information -->
            <div class="grid grid-cols-1 gap-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Phone Number</label>
                <input
                  id="storePhoneNumber"
                  type="tel"
                  placeholder="0241234567"
                  class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Preferred Meetup Location</label>
                <select id="storeMeetupLocation" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500/50 focus:border-green-500 transition-all">
                  <option value="">Select location for cash payments</option>
                  <option value="campus-library">Campus Library</option>
                  <option value="student-union">Student Union Building</option>
                  <option value="main-gate">Main Gate</option>
                  <option value="cafeteria">Cafeteria</option>
                  <option value="negotiable">Location Negotiable</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Seller Information -->
        <div>
          <label class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 block">üë§ Seller Information</label>
          <div class="bg-gray-50 dark:bg-slate-800 rounded-2xl p-4">
            <div class="flex items-center gap-3">
              <img id="storeSellerAvatar" src="" class="w-12 h-12 rounded-full object-cover" />
              <div>
                <div id="storeSellerName" class="font-semibold"></div>
                <div id="storeSellerFaculty" class="text-sm text-gray-500"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Add to Store Button -->
        <button id="btnSaveStoreItem" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          <i class="fa-solid fa-store mr-2"></i>Add to Store
        </button>
      </div>
    </div>
  </div>

  <!-- Change Avatar sheet -->
  <div id="sheetChangeAvatar" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Change Avatar</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetChangeAvatar">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Current Avatar Preview -->
        <div class="text-center">
          <div class="relative inline-block">
            <img id="currentAvatarPreview" src="" class="w-32 h-32 rounded-full object-cover border-4 border-gray-200 dark:border-slate-700 shadow-lg" />
            <div class="absolute bottom-2 right-2 w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white shadow-lg">
              <i class="fa-solid fa-camera text-sm"></i>
            </div>
          </div>
          <h4 class="font-bold text-lg mt-3">Current Avatar</h4>
          <p class="text-sm text-gray-500">Choose a new profile picture</p>
        </div>

        <!-- Avatar Options -->
        <div>
          <h4 class="font-bold mb-3">Upload Options</h4>
          <div class="grid grid-cols-2 gap-3">
            <button class="avatar-option p-4 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 text-center hover:shadow-lg transition-all" onclick="selectAvatarSource('camera')">
              <i class="fa-solid fa-camera text-2xl text-blue-600 mb-2"></i>
              <div class="text-sm font-medium text-blue-800 dark:text-blue-300">Take Photo</div>
            </button>
            <button class="avatar-option p-4 rounded-xl bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 text-center hover:shadow-lg transition-all" onclick="selectAvatarSource('gallery')">
              <i class="fa-solid fa-images text-2xl text-green-600 mb-2"></i>
              <div class="text-sm font-medium text-green-800 dark:text-green-300">Photo Library</div>
            </button>
          </div>
        </div>

        <!-- Preset Avatars -->
        <div>
          <h4 class="font-bold mb-3">Choose from Presets</h4>
          <div class="grid grid-cols-4 gap-3" id="presetAvatars">
            <!-- preset avatars will be injected -->
          </div>
        </div>

        <!-- Avatar Customization -->
        <div>
          <h4 class="font-bold mb-3">Customize</h4>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Avatar Style</label>
              <div class="flex gap-2 overflow-x-auto pb-2">
                <button class="avatar-style px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap text-sm font-medium" data-style="original">Original</button>
                <button class="avatar-style px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-style="circle">Circle Crop</button>
                <button class="avatar-style px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-style="square">Square</button>
                <button class="avatar-style px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-style="rounded">Rounded</button>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Border Style</label>
              <div class="flex gap-2 overflow-x-auto pb-2">
                <button class="border-style px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap text-sm font-medium" data-border="none">No Border</button>
                <button class="border-style px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-border="simple">Simple</button>
                <button class="border-style px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-border="gradient">Gradient</button>
                <button class="border-style px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-border="glow">Glow Effect</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Avatar Preview -->
        <div>
          <h4 class="font-bold mb-3">Preview</h4>
          <div class="bg-gray-50 dark:bg-slate-800 rounded-2xl p-6 text-center">
            <div class="relative inline-block">
              <img id="newAvatarPreview" src="" class="w-24 h-24 rounded-full object-cover transition-all duration-300" />
              <div id="avatarBorderPreview" class="absolute inset-0 rounded-full pointer-events-none"></div>
            </div>
            <p class="text-sm text-gray-500 mt-2">How your new avatar will look</p>
          </div>
        </div>

        <!-- Save Button -->
        <button id="btnSaveAvatar" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          <i class="fa-solid fa-save mr-2"></i>Save Avatar
        </button>
      </div>
    </div>
  </div>

  <!-- Create Story sheet -->
  <div id="sheetCreateStory" class="sheet expanded">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetCreateStory">
            <i class="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h3 class="font-bold text-xl">Create Story</h3>
        </div>
        <button id="btnPublishStory" class="px-4 py-2 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          Publish
        </button>
      </div>
    </div>
    <div class="sheet-content flex flex-col">
      <!-- Story preview -->
      <div class="flex-shrink-0 p-4">
        <div id="storyPreview" class="relative w-full h-96 bg-gradient-to-br from-purple-400 to-pink-400 rounded-2xl overflow-hidden">
          <div class="absolute inset-0 flex items-center justify-center">
            <div id="storyPlaceholder" class="text-center text-white">
              <i class="fa-solid fa-camera text-4xl mb-4 opacity-50"></i>
              <p class="text-lg font-medium">Tap to add photo or video</p>
              <p class="text-sm opacity-75">Or choose from templates below</p>
            </div>
            <img id="storyImage" class="hidden w-full h-full object-cover" />
            <video id="storyVideo" class="hidden w-full h-full object-cover" controls></video>
          </div>

          <!-- Story text overlay -->
          <div id="storyTextOverlay" class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div id="storyText" class="text-center text-white font-bold text-2xl drop-shadow-lg max-w-xs"></div>
          </div>

          <!-- Story controls overlay -->
          <div class="absolute top-4 left-4 right-4 flex justify-between items-center">
            <div class="flex gap-2">
              <button id="btnStoryText" class="w-10 h-10 bg-black/30 backdrop-blur rounded-full flex items-center justify-center text-white hover:bg-black/50 transition-colors">
                <i class="fa-solid fa-font"></i>
              </button>
              <button id="btnStoryStickers" class="w-10 h-10 bg-black/30 backdrop-blur rounded-full flex items-center justify-center text-white hover:bg-black/50 transition-colors">
                <i class="fa-solid fa-face-smile"></i>
              </button>
              <button id="btnStoryDraw" class="w-10 h-10 bg-black/30 backdrop-blur rounded-full flex items-center justify-center text-white hover:bg-black/50 transition-colors">
                <i class="fa-solid fa-pen"></i>
              </button>
            </div>
            <button id="btnStoryCamera" class="w-10 h-10 bg-black/30 backdrop-blur rounded-full flex items-center justify-center text-white hover:bg-black/50 transition-colors">
              <i class="fa-solid fa-camera"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Story options -->
      <div class="flex-1 p-4 space-y-6">
        <!-- Media selection -->
        <div>
          <h4 class="font-bold mb-3">Add Media</h4>
          <div class="grid grid-cols-4 gap-3">
            <button class="media-option p-4 rounded-xl bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 text-center hover:shadow-lg transition-all" onclick="selectStoryMedia('camera')">
              <i class="fa-solid fa-camera text-2xl text-blue-600 mb-2"></i>
              <div class="text-xs font-medium text-blue-800 dark:text-blue-300">Camera</div>
            </button>
            <button class="media-option p-4 rounded-xl bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 text-center hover:shadow-lg transition-all" onclick="selectStoryMedia('gallery')">
              <i class="fa-solid fa-images text-2xl text-green-600 mb-2"></i>
              <div class="text-xs font-medium text-green-800 dark:text-green-300">Gallery</div>
            </button>
            <button class="media-option p-4 rounded-xl bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 text-center hover:shadow-lg transition-all" onclick="selectStoryMedia('video')">
              <i class="fa-solid fa-video text-2xl text-purple-600 mb-2"></i>
              <div class="text-xs font-medium text-purple-800 dark:text-purple-300">Video</div>
            </button>
            <button class="media-option p-4 rounded-xl bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 text-center hover:shadow-lg transition-all" onclick="selectStoryMedia('text')">
              <i class="fa-solid fa-font text-2xl text-orange-600 mb-2"></i>
              <div class="text-xs font-medium text-orange-800 dark:text-orange-300">Text Only</div>
            </button>
          </div>
        </div>

        <!-- Story templates -->
        <div>
          <h4 class="font-bold mb-3">Quick Templates</h4>
          <div class="grid grid-cols-2 gap-3">
            <button class="story-template p-3 rounded-xl bg-gradient-to-br from-pink-400 to-purple-500 text-white text-center hover:shadow-lg transition-all" onclick="useStoryTemplate('ootd')">
              <i class="fa-solid fa-tshirt text-xl mb-2"></i>
              <div class="text-sm font-medium">OOTD</div>
            </button>
            <button class="story-template p-3 rounded-xl bg-gradient-to-br from-blue-400 to-cyan-500 text-white text-center hover:shadow-lg transition-all" onclick="useStoryTemplate('mood')">
              <i class="fa-solid fa-heart text-xl mb-2"></i>
              <div class="text-sm font-medium">Mood</div>
            </button>
            <button class="story-template p-3 rounded-xl bg-gradient-to-br from-green-400 to-emerald-500 text-white text-center hover:shadow-lg transition-all" onclick="useStoryTemplate('study')">
              <i class="fa-solid fa-book text-xl mb-2"></i>
              <div class="text-sm font-medium">Study Vibes</div>
            </button>
            <button class="story-template p-3 rounded-xl bg-gradient-to-br from-yellow-400 to-orange-500 text-white text-center hover:shadow-lg transition-all" onclick="useStoryTemplate('event')">
              <i class="fa-solid fa-calendar text-xl mb-2"></i>
              <div class="text-sm font-medium">Event</div>
            </button>
          </div>
        </div>

        <!-- Story settings -->
        <div>
          <h4 class="font-bold mb-3">Story Settings</h4>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span class="text-sm font-medium">Allow replies</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="storyAllowReplies" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 dark:peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
              </label>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm font-medium">Add to highlights</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="storyAddHighlights" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 dark:peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Similar Items sheet -->
  <div id="sheetSimilarItems" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <button class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" onclick="goBackFromSimilar()">
            <i class="fa-solid fa-arrow-left text-gray-600"></i>
          </button>
          <h3 class="font-bold text-xl">Similar Items</h3>
        </div>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetSimilarItems">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <!-- Current item preview -->
      <div id="currentItemPreview" class="mt-4 p-4 bg-gray-50 dark:bg-slate-800 rounded-2xl">
        <!-- Current item details will be injected here -->
      </div>

      <!-- Filter options -->
      <div class="flex gap-2 mt-4 overflow-x-auto pb-2">
        <button class="similar-filter px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap text-sm font-medium" data-filter="all">All Similar</button>
        <button class="similar-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="category">Same Category</button>
        <button class="similar-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="price">Similar Price</button>
        <button class="similar-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="seller">Same Seller</button>
        <button class="similar-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="trending">Trending</button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4">
        <div id="similarItemsGrid" class="grid grid-cols-2 gap-4">
          <!-- similar items -->
        </div>

        <!-- Recently viewed section -->
        <div class="mt-8">
          <h4 class="font-bold text-lg mb-4 flex items-center">
            <i class="fa-solid fa-clock-rotate-left text-gray-500 mr-2"></i>
            Recently Viewed
          </h4>
          <div id="recentlyViewedGrid" class="grid grid-cols-2 gap-4">
            <!-- recently viewed items -->
          </div>
        </div>

        <!-- Recommended section -->
        <div class="mt-8">
          <h4 class="font-bold text-lg mb-4 flex items-center">
            <i class="fa-solid fa-sparkles text-yellow-500 mr-2"></i>
            Recommended for You
          </h4>
          <div id="recommendedGrid" class="grid grid-cols-2 gap-4">
            <!-- recommended items -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart sheet -->
  <div id="sheetCart" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <h3 class="font-bold text-xl">Shopping Cart</h3>
          <span id="cartItemCount" class="bg-primary text-white text-xs px-2 py-1 rounded-full">0</span>
        </div>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetCart">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content flex flex-col">
      <div id="cartList" class="flex-1 p-4 space-y-4 overflow-y-auto"></div>
    </div>
    <div class="sheet-footer">
      <div class="flex items-center justify-between mb-4">
        <span class="font-bold text-lg">Total</span>
        <span id="cartTotal" class="text-2xl font-extrabold text-primary dark:text-dark-primary">$0.00</span>
      </div>
      <button id="btnCheckout" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all">
        <i class="fa-solid fa-credit-card mr-2"></i>Proceed to Checkout
      </button>
    </div>
  </div>

  <!-- Checkout sheet -->
  <div id="sheetCheckout" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Checkout</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetCheckout">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-6">
        <!-- Order Summary -->
        <div>
          <h4 class="font-bold text-lg mb-4">üì¶ Order Summary</h4>
          <div id="checkoutItems" class="space-y-3 mb-4">
            <!-- checkout items injected -->
          </div>
          <div class="border-t border-gray-200 dark:border-slate-700 pt-4">
            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-600 dark:text-gray-400">Subtotal</span>
              <span id="checkoutSubtotal" class="font-medium">$0.00</span>
            </div>
            <div class="flex justify-between items-center mb-2">
              <span class="text-gray-600 dark:text-gray-400">Delivery Fee</span>
              <span class="font-medium text-green-600">Free</span>
            </div>
            <div class="flex justify-between items-center text-lg font-bold">
              <span>Total</span>
              <span id="checkoutTotal" class="text-primary">$0.00</span>
            </div>
          </div>
        </div>

        <!-- Delivery Information -->
        <div>
          <h4 class="font-bold text-lg mb-4">üìç Delivery Information</h4>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Delivery Method</label>
              <div class="grid grid-cols-1 gap-3">
                <label class="delivery-method flex items-center p-3 rounded-xl border-2 border-gray-200 dark:border-slate-700 cursor-pointer hover:border-primary transition-colors">
                  <input type="radio" name="deliveryMethod" value="campus" class="mr-3" checked>
                  <div class="flex-1">
                    <div class="font-semibold">Campus Pickup</div>
                    <div class="text-sm text-gray-500">Meet at agreed campus location</div>
                  </div>
                  <div class="text-green-600 font-medium">Free</div>
                </label>
                <label class="delivery-method flex items-center p-3 rounded-xl border-2 border-gray-200 dark:border-slate-700 cursor-pointer hover:border-primary transition-colors">
                  <input type="radio" name="deliveryMethod" value="hostel" class="mr-3">
                  <div class="flex-1">
                    <div class="font-semibold">Hostel Delivery</div>
                    <div class="text-sm text-gray-500">Delivery to your hostel</div>
                  </div>
                  <div class="text-gray-600">‚Çµ5.00</div>
                </label>
              </div>
            </div>

            <div id="deliveryAddress" class="hidden">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Delivery Address</label>
              <textarea
                id="addressInput"
                rows="2"
                placeholder="Enter your hostel name and room number..."
                class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all resize-none"
              ></textarea>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Phone Number</label>
              <input
                id="buyerPhone"
                type="tel"
                placeholder="0241234567"
                class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all"
              />
            </div>
          </div>
        </div>

        <!-- Payment Method Selection -->
        <div>
          <h4 class="font-bold text-lg mb-4">üí≥ Payment Method</h4>
          <div class="space-y-3">
            <!-- Mobile Money -->
            <label class="payment-method-option flex items-center p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 cursor-pointer hover:border-primary transition-colors">
              <input type="radio" name="paymentMethod" value="momo" class="mr-4">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center mr-4">
                <i class="fa-solid fa-mobile-alt text-white"></i>
              </div>
              <div class="flex-1">
                <div class="font-semibold">Mobile Money</div>
                <div class="text-sm text-gray-500">MTN, Vodafone, AirtelTigo</div>
              </div>
              <div class="text-green-600 font-medium">Instant</div>
            </label>

            <!-- Cash on Delivery -->
            <label class="payment-method-option flex items-center p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 cursor-pointer hover:border-primary transition-colors">
              <input type="radio" name="paymentMethod" value="cash" class="mr-4">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-green-400 to-emerald-500 flex items-center justify-center mr-4">
                <i class="fa-solid fa-money-bills text-white"></i>
              </div>
              <div class="flex-1">
                <div class="font-semibold">Cash on Delivery</div>
                <div class="text-sm text-gray-500">Pay when you receive items</div>
              </div>
              <div class="text-blue-600 font-medium">Secure</div>
            </label>

            <!-- Bank Transfer -->
            <label class="payment-method-option flex items-center p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 cursor-pointer hover:border-primary transition-colors">
              <input type="radio" name="paymentMethod" value="bank" class="mr-4">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-blue-400 to-purple-500 flex items-center justify-center mr-4">
                <i class="fa-solid fa-university text-white"></i>
              </div>
              <div class="flex-1">
                <div class="font-semibold">Bank Transfer</div>
                <div class="text-sm text-gray-500">Direct bank account transfer</div>
              </div>
              <div class="text-purple-600 font-medium">1-2 days</div>
            </label>

            <!-- Credit/Debit Card -->
            <label class="payment-method-option flex items-center p-4 rounded-xl border-2 border-gray-200 dark:border-slate-700 cursor-pointer hover:border-primary transition-colors">
              <input type="radio" name="paymentMethod" value="card" class="mr-4">
              <div class="w-12 h-12 rounded-full bg-gradient-to-r from-indigo-400 to-cyan-500 flex items-center justify-center mr-4">
                <i class="fa-solid fa-credit-card text-white"></i>
              </div>
              <div class="flex-1">
                <div class="font-semibold">Credit/Debit Card</div>
                <div class="text-sm text-gray-500">Visa, Mastercard</div>
              </div>
              <div class="text-indigo-600 font-medium">Instant</div>
            </label>
          </div>
        </div>

        <!-- Payment Details (Dynamic based on selection) -->
        <div id="paymentDetails" class="hidden">
          <!-- Mobile Money Details -->
          <div id="momoDetails" class="hidden space-y-3">
            <h5 class="font-semibold">Mobile Money Details</h5>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Network</label>
                <select id="momoNetwork" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50">
                  <option value="mtn">MTN</option>
                  <option value="vodafone">Vodafone</option>
                  <option value="airteltigo">AirtelTigo</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Phone Number</label>
                <input
                  id="momoPhone"
                  type="tel"
                  placeholder="0241234567"
                  class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50"
                />
              </div>
            </div>
          </div>

          <!-- Card Details -->
          <div id="cardDetails" class="hidden space-y-3">
            <h5 class="font-semibold">Card Information</h5>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Cardholder Name</label>
              <input
                id="cardName"
                type="text"
                placeholder="Alex Johnson"
                class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Card Number</label>
              <input
                id="cardNumber"
                type="text"
                placeholder="1234 5678 9012 3456"
                class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50"
              />
            </div>
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Expiry Date</label>
                <input
                  id="cardExpiry"
                  type="text"
                  placeholder="MM/YY"
                  class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50"
                />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">CVV</label>
                <input
                  id="cardCvv"
                  type="text"
                  placeholder="123"
                  class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary/50"
                />
              </div>
            </div>
          </div>

          <!-- Bank Transfer Details -->
          <div id="bankDetails" class="hidden">
            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
              <h5 class="font-semibold mb-2 text-blue-900 dark:text-blue-100">Bank Transfer Instructions</h5>
              <div class="text-sm text-blue-800 dark:text-blue-200 space-y-1">
                <div><strong>Bank:</strong> Raved Fashion Bank</div>
                <div><strong>Account Name:</strong> Raved Marketplace</div>
                <div><strong>Account Number:</strong> 1234567890</div>
                <div><strong>Reference:</strong> <span id="transferReference">ORDER-12345</span></div>
              </div>
              <div class="mt-3 text-xs text-blue-600 dark:text-blue-400">
                Please use the reference number when making the transfer
              </div>
            </div>
          </div>

          <!-- Cash on Delivery Info -->
          <div id="cashDetails" class="hidden">
            <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4">
              <h5 class="font-semibold mb-2 text-green-900 dark:text-green-100">Cash on Delivery</h5>
              <div class="text-sm text-green-800 dark:text-green-200">
                You will pay in cash when you receive your items. Please have the exact amount ready.
              </div>
            </div>
          </div>
        </div>

        <!-- Place Order Button -->
        <button id="btnPlaceOrder" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          <i class="fa-solid fa-shopping-bag mr-2"></i>Place Order
        </button>

        <!-- Security Notice -->
        <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-3">
          <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
            <i class="fa-solid fa-shield-halved text-green-600"></i>
            <span>Your payment information is secure and encrypted</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Event sheet -->
  <div id="sheetCreateEvent" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Create Event</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetCreateEvent">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4 space-y-4">
        <!-- Basic Event Info -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Event Title</label>
          <input id="evTitle" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Enter event title..." />
        </div>

        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date</label>
            <input id="evDate" type="date" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Time</label>
            <input id="evTime" type="time" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Location</label>
          <input id="evLoc" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Event location..." />
        </div>

        <!-- Event Category -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Event Type</label>
          <select id="evCat" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary">
            <option value="fashion">Fashion Show</option>
            <option value="workshop">Workshop</option>
            <option value="networking">Networking</option>
          </select>
        </div>

        <!-- Target Audience -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Target Audience</label>
          <select id="evAudience" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary">
            <option value="all">All Students</option>
            <option value="undergraduate">Undergraduate Students</option>
            <option value="graduate">Graduate Students</option>
            <option value="faculty">Faculty & Staff</option>
            <option value="alumni">Alumni</option>
            <option value="public">Open to Public</option>
          </select>
        </div>

        <!-- Capacity -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Max Attendees</label>
            <input id="evCapacity" type="number" min="1" max="1000" value="50" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Registration Fee</label>
            <input id="evFee" type="number" min="0" step="0.01" value="0" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="0.00" />
          </div>
        </div>

        <!-- Description -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description</label>
          <textarea id="evDesc" rows="4" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary resize-none" placeholder="Describe your event..."></textarea>
        </div>

        <!-- Event Settings -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">Event Settings</label>
          <div class="space-y-3">
            <div class="flex items-center justify-between">
              <span class="text-sm">Require registration</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="evRequireReg" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
              </label>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Allow waitlist</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="evAllowWaitlist" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
              </label>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Send reminders</span>
              <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="evSendReminders" class="sr-only peer" checked>
                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
              </label>
            </div>
          </div>
        </div>

        <!-- Create Button -->
        <button id="btnSaveEvent" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all">
          <i class="fa-solid fa-calendar-plus mr-2"></i>Create Event
        </button>
      </div>
    </div>
  </div>

  <!-- Event details sheet -->
  <div id="sheetEvent" class="sheet p-0">
    <div class="mx-auto h-1 w-10 rounded-full bg-gray-300 dark:bg-slate-700 my-2"></div>
    <div id="eventDetail" class="max-h-[75vh] overflow-y-auto">
      <!-- injected -->
    </div>
  </div>

  <!-- Chat sheet -->
  <div id="sheetChat" class="sheet expanded">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <img id="chatAvatar" class="w-12 h-12 rounded-full object-cover border-2 border-gray-200 dark:border-slate-700" alt="" />
          <div>
            <div id="chatName" class="font-bold text-lg"></div>
            <div class="flex items-center gap-2">
              <div class="w-2 h-2 rounded-full bg-green-500"></div>
              <div id="chatStatus" class="text-sm text-gray-500">Online</div>
            </div>
          </div>
        </div>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetChat">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content flex flex-col">
      <div id="chatMsgs" class="flex-1 p-4 space-y-4 overflow-y-auto"></div>
    </div>
    <div class="sheet-footer">
      <div class="flex items-center gap-3">
        <button class="p-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors">
          <i class="fa-solid fa-plus"></i>
        </button>
        <input id="chatInput" class="flex-1 rounded-full border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Type a message..." />
        <button id="chatSend" class="p-3 rounded-full bg-primary text-white hover:bg-primary/90 transition-colors">
          <i class="fa-solid fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Connections sheet -->
  <div id="sheetConnections" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <h3 class="font-bold text-xl">Connections</h3>
          <span id="totalConnections" class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">127</span>
        </div>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetConnections">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <!-- Connection tabs -->
      <div class="flex gap-2 mt-4 overflow-x-auto pb-2">
        <button class="connection-filter px-4 py-2 rounded-full bg-primary text-white whitespace-nowrap text-sm font-medium" data-filter="all">All</button>
        <button class="connection-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="following">Following</button>
        <button class="connection-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="followers">Followers</button>
        <button class="connection-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="requests">Requests</button>
        <button class="connection-filter px-4 py-2 rounded-full bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 whitespace-nowrap text-sm" data-filter="suggested">Suggested</button>
      </div>
    </div>
    <div class="sheet-content">
      <div id="connectionsList" class="divide-y divide-gray-100 dark:divide-slate-800">
        <!-- connections -->
      </div>
    </div>
  </div>

  <!-- Conversations sheet -->
  <div id="sheetInbox" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <h3 class="font-bold text-xl">Messages</h3>
          <span id="totalMessages" class="bg-primary text-white text-xs px-2 py-1 rounded-full">3</span>
        </div>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetInbox">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content">
      <div id="chatList" class="divide-y divide-gray-100 dark:divide-slate-800">
        <!-- chats -->
      </div>
    </div>
  </div>

  <!-- Edit Profile Sheet -->
  <div id="sheetEditProfile" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Edit Profile</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetEditProfile">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <!-- Profile Photo -->
      <div class="text-center">
        <div class="relative inline-block">
          <img id="editProfileAvatar" src="https://i.imgur.com/jL1aT9i.jpg" class="w-24 h-24 rounded-full object-cover mx-auto" />
          <button onclick="openChangeAvatar()" class="absolute bottom-0 right-0 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors">
            <i class="fa-solid fa-camera text-sm"></i>
          </button>
        </div>
        <div class="text-sm text-gray-500 mt-2">Tap to change photo</div>
      </div>

      <!-- Profile Form -->
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Full Name</label>
          <input type="text" id="editProfileName" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Enter your full name" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Username</label>
          <div class="relative">
            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500">@</span>
            <input type="text" id="editProfileUsername" class="w-full pl-8 pr-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="username" />
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Bio</label>
          <textarea id="editProfileBio" rows="3" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent resize-none" placeholder="Tell us about yourself..."></textarea>
          <div class="text-xs text-gray-500 mt-1">
            <span id="bioCharCount">0</span>/150 characters
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Faculty</label>
          <select id="editProfileFaculty" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent">
            <option value="">Select Faculty</option>
            <option value="Arts & Humanities">Arts & Humanities</option>
            <option value="Business">Business</option>
            <option value="Engineering">Engineering</option>
            <option value="Science">Science</option>
            <option value="Medicine">Medicine</option>
            <option value="Law">Law</option>
            <option value="Education">Education</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Location</label>
          <input type="text" id="editProfileLocation" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="University of Ghana, Legon" />
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Website</label>
          <input type="url" id="editProfileWebsite" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="https://yourwebsite.com" />
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-3 pt-4">
        <button onclick="UI.closeSheet('sheetEditProfile')" class="flex-1 px-4 py-3 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
          Cancel
        </button>
        <button onclick="saveProfileChanges()" class="flex-1 px-4 py-3 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-colors">
          Save Changes
        </button>
      </div>
    </div>
  </div>

  <!-- Profile Settings Sheet -->
  <div id="sheetProfileSettings" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Settings</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetProfileSettings">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <!-- Account Settings -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center">
          <i class="fa-solid fa-user-cog text-primary mr-2"></i>Account
        </h4>
        <div class="space-y-3">
          <button onclick="openEditProfile()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-edit text-gray-500"></i>
              <span>Edit Profile</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="openChangeAvatar()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-camera text-gray-500"></i>
              <span>Change Avatar</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="openPrivacySettings()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-shield-halved text-gray-500"></i>
              <span>Privacy Settings</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>

      <!-- Appearance Settings -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center">
          <i class="fa-solid fa-palette text-primary mr-2"></i>Appearance
        </h4>
        <div class="space-y-3">
          <!-- Dark Mode Toggle -->
          <div class="flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-moon text-gray-500"></i>
              <span>Dark Mode</span>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="darkModeToggle" class="sr-only peer" onchange="toggleDarkMode()">
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 dark:peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>

          <button onclick="openThemeSelector()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-brush text-gray-500"></i>
              <span>Theme Colors</span>
              <span id="currentThemeName" class="text-xs bg-primary/10 text-primary px-2 py-1 rounded-full">Raved Classic</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="openLanguageSettings()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-language text-gray-500"></i>
              <span>Language</span>
              <span class="text-xs bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-gray-400 px-2 py-1 rounded-full">English</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>
      
      <!-- Developer Settings -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center">
          <i class="fa-solid fa-code text-primary mr-2"></i>Developer
        </h4>
        <div class="space-y-3">
          <button onclick="openDatabaseSettings()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-database text-gray-500"></i>
              <span>Database Configuration</span>
              <span class="text-xs bg-blue-100 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400 px-2 py-1 rounded-full">Hybrid</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
          
          <button onclick="openAPISettings()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-cloud text-gray-500"></i>
              <span>API Settings</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>

      <!-- Premium Settings -->
      <div class="bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl p-4 border border-yellow-200 dark:border-yellow-800/30">
        <h4 class="font-semibold text-yellow-800 dark:text-yellow-200 mb-3 flex items-center">
          <i class="fa-solid fa-crown text-yellow-600 mr-2"></i>Premium
        </h4>
        <div class="space-y-3">
          <button onclick="openSubscription()" class="w-full flex items-center justify-between p-3 bg-white/80 dark:bg-slate-900/80 rounded-lg hover:bg-white dark:hover:bg-slate-900 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-star text-yellow-600"></i>
              <span>Manage Subscription</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="openSellerDashboard()" class="w-full flex items-center justify-between p-3 bg-white/80 dark:bg-slate-900/80 rounded-lg hover:bg-white dark:hover:bg-slate-900 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-store text-yellow-600"></i>
              <span>Seller Dashboard</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>

      <!-- Support & Info -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center">
          <i class="fa-solid fa-question-circle text-primary mr-2"></i>Support & Info
        </h4>
        <div class="space-y-3">
          <button onclick="openHelp()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-life-ring text-gray-500"></i>
              <span>Help & Support</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="openAbout()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-info-circle text-gray-500"></i>
              <span>About Raved</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="openTerms()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-file-contract text-gray-500"></i>
              <span>Terms & Privacy</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>

      <!-- Danger Zone -->
      <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-4 border border-red-200 dark:border-red-800/30">
        <h4 class="font-semibold text-red-700 dark:text-red-300 mb-3 flex items-center">
          <i class="fa-solid fa-exclamation-triangle text-red-600 mr-2"></i>Account Actions
        </h4>
        <div class="space-y-3">
          <button onclick="signOut()" class="w-full flex items-center justify-between p-3 bg-white/80 dark:bg-slate-900/80 rounded-lg hover:bg-white dark:hover:bg-slate-900 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-sign-out-alt text-orange-600"></i>
              <span>Sign Out</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="confirmDeleteAccount()" class="w-full flex items-center justify-between p-3 bg-white/80 dark:bg-slate-900/80 rounded-lg hover:bg-white dark:hover:bg-slate-900 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-trash text-red-600"></i>
              <span>Delete Account</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Database Settings Sheet -->
  <div id="sheetDatabaseSettings" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Database Configuration</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetDatabaseSettings">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl">
        <h4 class="font-semibold text-blue-800 dark:text-blue-300 mb-2">Hybrid Database Architecture</h4>
        <p class="text-sm text-blue-700 dark:text-blue-400">Raved uses a hybrid database approach with PostgreSQL and MongoDB for optimal performance and flexibility.</p>
      </div>
      
      <!-- PostgreSQL Configuration -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center">
          <i class="fa-solid fa-database text-blue-600 mr-2"></i>PostgreSQL
        </h4>
        <div class="space-y-3">
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg">
            <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Connection Status</p>
            <div class="flex items-center">
              <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
              <span class="text-sm text-green-600 dark:text-green-400">Connected</span>
            </div>
          </div>
          
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg">
            <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Database</p>
            <p class="text-sm text-gray-600 dark:text-gray-400">raved_app</p>
          </div>
          
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg">
            <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Entities</p>
            <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
              <div class="flex items-center justify-between">
                <span>Users</span>
                <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-0.5 rounded-full">Core Data</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Communities</span>
                <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-0.5 rounded-full">Core Data</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Marketplace</span>
                <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-0.5 rounded-full">Core Data</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Events</span>
                <span class="bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 px-2 py-0.5 rounded-full">Core Data</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- MongoDB Configuration -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center">
          <i class="fa-solid fa-leaf text-green-600 mr-2"></i>MongoDB
        </h4>
        <div class="space-y-3">
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg">
            <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Connection Status</p>
            <div class="flex items-center">
              <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
              <span class="text-sm text-green-600 dark:text-green-400">Connected</span>
            </div>
          </div>
          
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg">
            <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Database</p>
            <p class="text-sm text-gray-600 dark:text-gray-400">raved_app</p>
          </div>
          
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg">
            <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Collections</p>
            <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
              <div class="flex items-center justify-between">
                <span>Posts</span>
                <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-0.5 rounded-full">Content</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Stories</span>
                <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-0.5 rounded-full">Content</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Messages</span>
                <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-0.5 rounded-full">Content</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Notifications</span>
                <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-0.5 rounded-full">Content</span>
              </div>
              <div class="flex items-center justify-between">
                <span>Analytics</span>
                <span class="bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 px-2 py-0.5 rounded-full">Content</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- API Settings Sheet -->
  <div id="sheetAPISettings" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">API Settings</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetAPISettings">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">API Gateway</h4>
        <div class="p-3 bg-white dark:bg-slate-900 rounded-lg">
          <p class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Endpoint</p>
          <p class="text-sm text-gray-600 dark:text-gray-400">https://api.raved.app/v1</p>
        </div>
      </div>
      
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Database Services</h4>
        <div class="space-y-2">
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-700 dark:text-gray-300">PostgreSQL Service</p>
              <p class="text-xs text-gray-500">Core data operations</p>
            </div>
            <span class="inline-block w-3 h-3 bg-green-500 rounded-full"></span>
          </div>
          
          <div class="p-3 bg-white dark:bg-slate-900 rounded-lg flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-700 dark:text-gray-300">MongoDB Service</p>
              <p class="text-xs text-gray-500">Content and analytics</p>
            </div>
            <span class="inline-block w-3 h-3 bg-green-500 rounded-full"></span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Privacy Settings Sheet -->
  <div id="sheetPrivacySettings" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Privacy Settings</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetPrivacySettings">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <!-- Account Privacy -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Account Privacy</h4>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium">Private Account</div>
              <div class="text-sm text-gray-500">Only approved followers can see your posts</div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="privateAccountToggle" class="sr-only peer" onchange="togglePrivateAccount()">
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>
        </div>
      </div>

      <!-- Activity Privacy -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Activity Privacy</h4>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium">Show Activity Status</div>
              <div class="text-sm text-gray-500">Let others see when you're active</div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="activityStatusToggle" class="sr-only peer" onchange="toggleActivityStatus()" checked>
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>

          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium">Read Receipts</div>
              <div class="text-sm text-gray-500">Show when you've read messages</div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="readReceiptsToggle" class="sr-only peer" onchange="toggleReadReceipts()" checked>
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>
        </div>
      </div>

      <!-- Content Privacy -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Content Privacy</h4>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium">Allow Downloads</div>
              <div class="text-sm text-gray-500">Let others download your photos</div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="allowDownloadsToggle" class="sr-only peer" onchange="toggleAllowDownloads()">
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>

          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium">Story Sharing</div>
              <div class="text-sm text-gray-500">Allow others to share your stories</div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="storySharingToggle" class="sr-only peer" onchange="toggleStorySharing()" checked>
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>
        </div>
      </div>

      <!-- Data & Analytics -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Data & Analytics</h4>
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium">Analytics Tracking</div>
              <div class="text-sm text-gray-500">Help improve Raved with usage data</div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="analyticsToggle" class="sr-only peer" onchange="toggleAnalytics()" checked>
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>

          <div class="flex items-center justify-between">
            <div>
              <div class="font-medium">Personalized Ads</div>
              <div class="text-sm text-gray-500">Show ads based on your interests</div>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <input type="checkbox" id="personalizedAdsToggle" class="sr-only peer" onchange="togglePersonalizedAds()" checked>
              <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary/25 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-primary"></div>
            </label>
          </div>
        </div>
      </div>

      <!-- Blocked Users -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Blocked Accounts</h4>
        <button onclick="openBlockedUsers()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
          <div class="flex items-center gap-3">
            <i class="fa-solid fa-user-slash text-gray-500"></i>
            <span>Manage Blocked Users</span>
            <span id="blockedUsersCount" class="text-xs bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 px-2 py-1 rounded-full">0</span>
          </div>
          <i class="fa-solid fa-chevron-right text-gray-400"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Language Settings Sheet -->
  <div id="sheetLanguageSettings" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Language Settings</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetLanguageSettings">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <!-- App Language -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">App Language</h4>
        <div class="space-y-2">
          <label class="flex items-center p-3 bg-white dark:bg-slate-900 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <input type="radio" name="appLanguage" value="en" class="text-primary focus:ring-primary" checked onchange="changeAppLanguage('en')">
            <div class="ml-3 flex items-center gap-3">
              <span class="text-2xl">üá∫üá∏</span>
              <div>
                <div class="font-medium">English</div>
                <div class="text-sm text-gray-500">Default</div>
              </div>
            </div>
          </label>

          <label class="flex items-center p-3 bg-white dark:bg-slate-900 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <input type="radio" name="appLanguage" value="tw" class="text-primary focus:ring-primary" onchange="changeAppLanguage('tw')">
            <div class="ml-3 flex items-center gap-3">
              <span class="text-2xl">üá¨üá≠</span>
              <div>
                <div class="font-medium">Twi</div>
                <div class="text-sm text-gray-500">Akan</div>
              </div>
            </div>
          </label>

          <label class="flex items-center p-3 bg-white dark:bg-slate-900 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <input type="radio" name="appLanguage" value="ha" class="text-primary focus:ring-primary" onchange="changeAppLanguage('ha')">
            <div class="ml-3 flex items-center gap-3">
              <span class="text-2xl">üá¨üá≠</span>
              <div>
                <div class="font-medium">Hausa</div>
                <div class="text-sm text-gray-500">Northern Ghana</div>
              </div>
            </div>
          </label>

          <label class="flex items-center p-3 bg-white dark:bg-slate-900 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <input type="radio" name="appLanguage" value="fr" class="text-primary focus:ring-primary" onchange="changeAppLanguage('fr')">
            <div class="ml-3 flex items-center gap-3">
              <span class="text-2xl">üá´üá∑</span>
              <div>
                <div class="font-medium">Fran√ßais</div>
                <div class="text-sm text-gray-500">French</div>
              </div>
            </div>
          </label>
        </div>
      </div>

      <!-- Regional Settings -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Regional Settings</h4>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Format</label>
            <select id="dateFormatSelect" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" onchange="changeDateFormat()">
              <option value="DD/MM/YYYY">DD/MM/YYYY (31/12/2024)</option>
              <option value="MM/DD/YYYY">MM/DD/YYYY (12/31/2024)</option>
              <option value="YYYY-MM-DD">YYYY-MM-DD (2024-12-31)</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Currency</label>
            <select id="currencySelect" class="w-full px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-gray-100 focus:ring-2 focus:ring-primary focus:border-transparent" onchange="changeCurrency()">
              <option value="GHS">Ghana Cedi (‚Çµ)</option>
              <option value="USD">US Dollar ($)</option>
              <option value="EUR">Euro (‚Ç¨)</option>
              <option value="GBP">British Pound (¬£)</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help & Support Sheet -->
  <div id="sheetHelp" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">Help & Support</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetHelp">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <!-- Quick Help -->
      <div class="bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl p-4 border border-blue-200 dark:border-blue-800/30">
        <h4 class="font-semibold text-blue-800 dark:text-blue-200 mb-3 flex items-center">
          <i class="fa-solid fa-question-circle text-blue-600 mr-2"></i>Quick Help
        </h4>
        <div class="space-y-3">
          <button onclick="openFAQ()" class="w-full flex items-center justify-between p-3 bg-white/80 dark:bg-slate-900/80 rounded-lg hover:bg-white dark:hover:bg-slate-900 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-circle-question text-blue-600"></i>
              <span>Frequently Asked Questions</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>

          <button onclick="openUserGuide()" class="w-full flex items-center justify-between p-3 bg-white/80 dark:bg-slate-900/80 rounded-lg hover:bg-white dark:hover:bg-slate-900 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-book text-blue-600"></i>
              <span>User Guide</span>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>

      <!-- Contact Support -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Contact Support</h4>
        <div class="space-y-3">
          <button onclick="openLiveChat()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-comments text-green-600"></i>
              <div>
                <div class="font-medium">Live Chat</div>
                <div class="text-sm text-gray-500">Get instant help</div>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <span class="w-2 h-2 bg-green-500 rounded-full"></span>
              <span class="text-xs text-green-600">Online</span>
            </div>
          </button>

          <button onclick="sendEmail()" class="w-full flex items-center justify-between p-3 bg-white dark:bg-slate-900 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
            <div class="flex items-center gap-3">
              <i class="fa-solid fa-envelope text-blue-600"></i>
              <div>
                <div class="font-medium">Email Support</div>
                <div class="text-sm text-gray-500">support@raved.app</div>
              </div>
            </div>
            <i class="fa-solid fa-chevron-right text-gray-400"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- About Raved Sheet -->
  <div id="sheetAbout" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <h3 class="font-bold text-xl">About Raved</h3>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetAbout">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </div>
    <div class="sheet-content space-y-4">
      <!-- App Info -->
      <div class="text-center py-4">
        <div class="w-20 h-20 bg-gradient-to-r from-primary to-accent rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="fa-solid fa-shirt text-white text-3xl"></i>
        </div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Raved</h2>
        <p class="text-gray-600 dark:text-gray-400 mt-1">Campus Fashion Social Network</p>
        <p class="text-sm text-gray-500 mt-2">Version 1.0.0 (Beta)</p>
      </div>

      <!-- About -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">About</h4>
        <p class="text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
          Raved is the premier social platform for university students to showcase their fashion sense, connect with peers, and discover the latest campus trends. Built specifically for the Ghanaian university community.
        </p>
      </div>

      <!-- Features -->
      <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
        <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Key Features</h4>
        <div class="space-y-2">
          <div class="flex items-center gap-3">
            <i class="fa-solid fa-camera text-primary"></i>
            <span class="text-sm">Share your daily fashion looks</span>
          </div>
          <div class="flex items-center gap-3">
            <i class="fa-solid fa-store text-primary"></i>
            <span class="text-sm">Buy and sell fashion items</span>
          </div>
          <div class="flex items-center gap-3">
            <i class="fa-solid fa-users text-primary"></i>
            <span class="text-sm">Connect with campus communities</span>
          </div>
          <div class="flex items-center gap-3">
            <i class="fa-solid fa-trophy text-primary"></i>
            <span class="text-sm">Compete in fashion rankings</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Story viewer sheet -->
  <div id="sheetStory" class="sheet p-0">
    <div id="storyBody" class="relative">
      <!-- injected -->
    </div>
  </div>

  <!-- Register sheet -->
  <div id="sheetRegister" class="sheet collapsed">
    <div class="sheet-header">
      <div class="sheet-handle"></div>
      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center gap-3">
          <button id="btnRegisterBack" class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors hidden">
            <i class="fa-solid fa-arrow-left"></i>
          </button>
          <div>
            <h3 class="font-bold text-xl" id="registerTitle">Create Account</h3>
            <div class="text-sm text-gray-500" id="registerSubtitle">Join the Raved community</div>
          </div>
        </div>
        <button class="text-gray-400 hover:text-gray-600 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors" data-close="sheetRegister">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>

      <!-- Progress Indicator -->
      <div class="px-4 pb-2">
        <div class="flex items-center justify-between mb-2">
          <span class="text-xs font-medium text-gray-600 dark:text-gray-400">Step <span id="currentStep">1</span> of <span id="totalSteps">5</span></span>
          <span class="text-xs font-medium text-primary" id="progressPercent">20%</span>
        </div>
        <div class="w-full bg-gray-200 dark:bg-slate-700 rounded-full h-2">
          <div id="progressBar" class="bg-gradient-to-r from-primary to-purple-600 h-2 rounded-full transition-all duration-500" style="width: 20%"></div>
        </div>
      </div>
    </div>
    <div class="sheet-content">
      <div class="p-4">
        <!-- Step 1: Welcome -->
        <div id="registerStep1" class="registration-step">
          <div class="text-center mb-8">
            <div class="w-20 h-20 mx-auto rounded-full bg-gradient-to-r from-primary to-purple-600 flex items-center justify-center mb-4">
              <i class="fa-solid fa-sparkles text-white text-3xl"></i>
            </div>
            <h4 class="font-bold text-2xl mb-2">Welcome to Raved!</h4>
            <p class="text-gray-500 mb-6">Join Ghana's premier campus fashion community</p>

            <div class="space-y-4 text-left">
              <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 flex items-center justify-center">
                  <i class="fa-solid fa-users text-white"></i>
                </div>
                <div>
                  <div class="font-semibold text-purple-900 dark:text-purple-100">Connect with Fashion Lovers</div>
                  <div class="text-sm text-purple-700 dark:text-purple-300">Share your style and discover trends</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center">
                  <i class="fa-solid fa-store text-white"></i>
                </div>
                <div>
                  <div class="font-semibold text-green-900 dark:text-green-100">Buy & Sell Fashion Items</div>
                  <div class="text-sm text-green-700 dark:text-green-300">Campus marketplace for students</div>
                </div>
              </div>

              <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 rounded-xl">
                <div class="w-10 h-10 rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center">
                  <i class="fa-solid fa-trophy text-white"></i>
                </div>
                <div>
                  <div class="font-semibold text-yellow-900 dark:text-yellow-100">Compete for Prizes</div>
                  <div class="text-sm text-yellow-700 dark:text-yellow-300">Win cash rewards monthly</div>
                </div>
              </div>
            </div>
          </div>

          <button id="btnStartRegistration" class="w-full bg-gradient-to-r from-primary to-purple-600 text-white rounded-2xl py-4 font-bold text-lg hover:shadow-lg transition-all">
            <i class="fa-solid fa-rocket mr-2"></i>Get Started
          </button>

          <div class="text-center mt-4">
            <span class="text-sm text-gray-500">Already have an account? </span>
            <button type="button" class="text-sm text-primary hover:underline font-medium" onclick="UI.closeSheet('sheetRegister')">Sign In</button>
          </div>
        </div>

        <!-- Step 2: Personal Information -->
        <div id="registerStep2" class="registration-step hidden">
          <div class="text-center mb-6">
            <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-r from-blue-500 to-cyan-500 flex items-center justify-center mb-3">
              <i class="fa-solid fa-user text-white text-2xl"></i>
            </div>
            <h4 class="font-bold text-xl">Personal Information</h4>
            <p class="text-sm text-gray-500">Tell us about yourself</p>
          </div>

          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">First Name *</label>
                <input id="rgFirst" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="Alex" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Last Name *</label>
                <input id="rgLast" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="Johnson" />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Username *</label>
              <div class="relative">
                <input id="rgUsername" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 pl-10 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="alexjohnson" />
                <i class="fa-solid fa-at text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                <div id="usernameStatus" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                  <!-- Status icon will be injected -->
                </div>
              </div>
              <div id="usernameHelp" class="text-xs text-gray-500 mt-1">Choose a unique username (3-20 characters, letters, numbers, underscore)</div>
            </div>

            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4">
              <div class="flex items-start gap-2">
                <i class="fa-solid fa-lightbulb text-blue-600 mt-0.5"></i>
                <div class="text-sm text-blue-800 dark:text-blue-200">
                  <div class="font-medium mb-1">Your username is your unique identity</div>
                  <div>This is how other users will find and mention you on Raved. Choose something memorable!</div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex gap-3 mt-8">
            <button id="btnPersonalBack" class="flex-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-xl py-3 font-semibold hover:bg-gray-200 dark:hover:bg-slate-700 transition-all">
              <i class="fa-solid fa-arrow-left mr-2"></i>Back
            </button>
            <button id="btnPersonalNext" class="flex-1 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl py-3 font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              Next<i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>

        <!-- Step 3: Contact Information -->
        <div id="registerStep3" class="registration-step hidden">
          <div class="text-center mb-6">
            <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-r from-green-500 to-emerald-500 flex items-center justify-center mb-3">
              <i class="fa-solid fa-envelope text-white text-2xl"></i>
            </div>
            <h4 class="font-bold text-xl">Contact Information</h4>
            <p class="text-sm text-gray-500">How can we reach you?</p>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Address *</label>
              <div class="relative">
                <input id="rgEmail" type="email" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 pl-10 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="alex.johnson@gmail.com" />
                <i class="fa-solid fa-envelope text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                <div id="emailStatus" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                  <!-- Status icon will be injected -->
                </div>
              </div>
              <div id="emailHelp" class="text-xs text-gray-500 mt-1">We'll send a verification code to this email</div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Phone Number *</label>
              <div class="relative">
                <input id="rgPhone" type="tel" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 pl-10 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="0241234567" />
                <i class="fa-solid fa-phone text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                <div id="phoneStatus" class="absolute right-3 top-1/2 -translate-y-1/2 hidden">
                  <!-- Status icon will be injected -->
                </div>
              </div>
              <div id="phoneHelp" class="text-xs text-gray-500 mt-1">We'll send a verification SMS to this number</div>
            </div>

            <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-4">
              <div class="flex items-start gap-2">
                <i class="fa-solid fa-shield-check text-green-600 mt-0.5"></i>
                <div class="text-sm text-green-800 dark:text-green-200">
                  <div class="font-medium mb-1">Secure & Private</div>
                  <div>Your contact information is encrypted and will only be used for account security and important notifications.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex gap-3 mt-8">
            <button id="btnContactBack" class="flex-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-xl py-3 font-semibold hover:bg-gray-200 dark:hover:bg-slate-700 transition-all">
              <i class="fa-solid fa-arrow-left mr-2"></i>Back
            </button>
            <button id="btnContactNext" class="flex-1 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl py-3 font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              Next<i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>

        <!-- Step 4: Verification -->
        <div id="registerStep4" class="registration-step hidden">
          <div class="text-center mb-6">
            <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-r from-yellow-500 to-orange-500 flex items-center justify-center mb-3">
              <i class="fa-solid fa-shield-check text-white text-2xl"></i>
            </div>
            <h4 class="font-bold text-xl">Verify Your Account</h4>
            <p class="text-sm text-gray-500">Confirm your email and phone number</p>
          </div>

          <div class="space-y-6">
            <!-- Email Verification -->
            <div>
              <div class="flex items-center gap-2 mb-3">
                <i class="fa-solid fa-envelope text-primary"></i>
                <span class="font-medium">Email Verification</span>
                <div id="emailVerifiedBadge" class="hidden">
                  <i class="fa-solid fa-check-circle text-green-500"></i>
                </div>
              </div>
              <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-3 mb-3">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                  We'll send a verification code to: <span id="emailDisplay" class="font-medium text-gray-900 dark:text-gray-100"></span>
                </div>
              </div>
              <div class="flex gap-2">
                <input id="rgEmailCode" type="text" maxlength="6" class="flex-1 rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all text-center font-mono text-lg" placeholder="123456" />
                <button type="button" id="btnSendEmailCode" class="px-4 py-3 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors text-sm font-medium whitespace-nowrap">Send Code</button>
              </div>
              <div id="emailCodeHelp" class="text-xs text-gray-500 mt-1">Enter the 6-digit code sent to your email</div>
            </div>

            <!-- Phone Verification -->
            <div>
              <div class="flex items-center gap-2 mb-3">
                <i class="fa-solid fa-phone text-primary"></i>
                <span class="font-medium">Phone Verification</span>
                <div id="phoneVerifiedBadge" class="hidden">
                  <i class="fa-solid fa-check-circle text-green-500"></i>
                </div>
              </div>
              <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-3 mb-3">
                <div class="text-sm text-gray-600 dark:text-gray-400">
                  We'll send an SMS code to: <span id="phoneDisplay" class="font-medium text-gray-900 dark:text-gray-100"></span>
                </div>
              </div>
              <div class="flex gap-2">
                <input id="rgPhoneCode" type="text" maxlength="6" class="flex-1 rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all text-center font-mono text-lg" placeholder="123456" />
                <button type="button" id="btnSendPhoneCode" class="px-4 py-3 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors text-sm font-medium whitespace-nowrap">Send SMS</button>
              </div>
              <div id="phoneCodeHelp" class="text-xs text-gray-500 mt-1">Enter the 6-digit code sent to your phone</div>
            </div>

            <div class="bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-4">
              <div class="flex items-start gap-2">
                <i class="fa-solid fa-info-circle text-yellow-600 mt-0.5"></i>
                <div class="text-sm text-yellow-800 dark:text-yellow-200">
                  <div class="font-medium mb-1">Demo Mode</div>
                  <div>For demonstration, verification codes will be displayed in the console and UI. In production, real SMS and email services would be used.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex gap-3 mt-8">
            <button id="btnVerificationBack" class="flex-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-xl py-3 font-semibold hover:bg-gray-200 dark:hover:bg-slate-700 transition-all">
              <i class="fa-solid fa-arrow-left mr-2"></i>Back
            </button>
            <button id="btnVerificationNext" class="flex-1 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl py-3 font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              Next<i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>

        <!-- Step 5: Academic Information -->
        <div id="registerStep5" class="registration-step hidden">
          <div class="text-center mb-6">
            <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 flex items-center justify-center mb-3">
              <i class="fa-solid fa-graduation-cap text-white text-2xl"></i>
            </div>
            <h4 class="font-bold text-xl">Academic Information</h4>
            <p class="text-sm text-gray-500">Optional - Help us connect you with your campus community</p>
          </div>

          <div class="space-y-4">
            <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 mb-4">
              <div class="flex items-start gap-2">
                <i class="fa-solid fa-info-circle text-blue-600 mt-0.5"></i>
                <div class="text-sm text-blue-800 dark:text-blue-200">
                  <div class="font-medium mb-1">University Integration Coming Soon!</div>
                  <div>These fields are optional for now. Full university integration will be available once we partner with your institution.</div>
                </div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">University</label>
              <input id="rgUniversity" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="University of Ghana" />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Student ID</label>
              <input id="rgStudent" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="20230001" />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Faculty/Department</label>
              <select id="rgFaculty" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all">
                <option value="">Select your faculty (optional)</option>
                <option value="Business">Business Administration</option>
                <option value="Engineering">Engineering & Technology</option>
                <option value="Arts">Arts & Humanities</option>
                <option value="Science">Natural Sciences</option>
                <option value="Medicine">Medicine & Health Sciences</option>
                <option value="Law">Law & Legal Studies</option>
                <option value="Education">Education</option>
                <option value="Social Sciences">Social Sciences</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div class="bg-indigo-50 dark:bg-indigo-900/20 rounded-xl p-4">
              <div class="flex items-start gap-2">
                <i class="fa-solid fa-users text-indigo-600 mt-0.5"></i>
                <div class="text-sm text-indigo-800 dark:text-indigo-200">
                  <div class="font-medium mb-1">Connect with Your Campus</div>
                  <div>Adding your university info helps us connect you with students from your campus and show relevant content.</div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex gap-3 mt-8">
            <button id="btnAcademicBack" class="flex-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-xl py-3 font-semibold hover:bg-gray-200 dark:hover:bg-slate-700 transition-all">
              <i class="fa-solid fa-arrow-left mr-2"></i>Back
            </button>
            <button id="btnAcademicNext" class="flex-1 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl py-3 font-semibold hover:shadow-lg transition-all">
              Next<i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
          </div>
        </div>

        <!-- Step 6: Security & Terms -->
        <div id="registerStep6" class="registration-step hidden">
          <div class="text-center mb-6">
            <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-r from-red-500 to-pink-500 flex items-center justify-center mb-3">
              <i class="fa-solid fa-lock text-white text-2xl"></i>
            </div>
            <h4 class="font-bold text-xl">Secure Your Account</h4>
            <p class="text-sm text-gray-500">Create a strong password and agree to our terms</p>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password *</label>
              <div class="relative">
                <input id="rgPass" type="password" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="Create a strong password" />
                <button type="button" id="togglePassword1" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
              <div id="passwordStrength" class="mt-2">
                <div class="flex gap-1 mb-1">
                  <div class="strength-bar h-1 bg-gray-200 dark:bg-slate-700 rounded flex-1"></div>
                  <div class="strength-bar h-1 bg-gray-200 dark:bg-slate-700 rounded flex-1"></div>
                  <div class="strength-bar h-1 bg-gray-200 dark:bg-slate-700 rounded flex-1"></div>
                  <div class="strength-bar h-1 bg-gray-200 dark:bg-slate-700 rounded flex-1"></div>
                </div>
                <div id="passwordStrengthText" class="text-xs text-gray-500">Password strength</div>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Confirm Password *</label>
              <div class="relative">
                <input id="rgPass2" type="password" class="w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-4 pr-12 py-3 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="Confirm your password" />
                <button type="button" id="togglePassword2" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
                  <i class="fa-solid fa-eye"></i>
                </button>
              </div>
              <div id="passwordMatch" class="mt-1 text-xs hidden">
                <!-- Password match status -->
              </div>
            </div>

            <div class="bg-red-50 dark:bg-red-900/20 rounded-xl p-4">
              <div class="flex items-start gap-2">
                <i class="fa-solid fa-shield-halved text-red-600 mt-0.5"></i>
                <div class="text-sm text-red-800 dark:text-red-200">
                  <div class="font-medium mb-1">Password Requirements</div>
                  <ul class="text-xs space-y-1">
                    <li>‚Ä¢ At least 8 characters long</li>
                    <li>‚Ä¢ Include uppercase and lowercase letters</li>
                    <li>‚Ä¢ Include at least one number</li>
                    <li>‚Ä¢ Include at least one special character</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
              <div class="flex items-start gap-3">
                <input type="checkbox" id="rgTerms" class="mt-1 rounded border-gray-300 text-primary focus:ring-primary">
                <div class="text-sm">
                  <label for="rgTerms" class="text-gray-700 dark:text-gray-300">
                    I agree to the <button type="button" class="text-primary hover:underline font-medium">Terms of Service</button> and <button type="button" class="text-primary hover:underline font-medium">Privacy Policy</button>
                  </label>
                  <div class="text-xs text-gray-500 mt-1">
                    By creating an account, you agree to our terms and confirm you're 13 or older.
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="flex gap-3 mt-8">
            <button id="btnSecurityBack" class="flex-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-xl py-3 font-semibold hover:bg-gray-200 dark:hover:bg-slate-700 transition-all">
              <i class="fa-solid fa-arrow-left mr-2"></i>Back
            </button>
            <button id="btnRegister" class="flex-1 bg-gradient-to-r from-primary to-purple-600 text-white rounded-xl py-3 font-semibold hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <i class="fa-solid fa-user-plus mr-2"></i>Create Account
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reset password sheet -->
  <div id="sheetReset" class="sheet p-4">
    <div class="mx-auto h-1 w-10 rounded-full bg-gray-300 dark:bg-slate-700 mb-3"></div>
    <h3 class="font-bold mb-3">Reset Password</h3>
    <p class="text-sm text-gray-500">Enter your student email and we‚Äôll send a reset link.</p>
    <input id="resetEmail" type="email" class="mt-3 w-full rounded-xl border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" placeholder="you@university.edu" />
    <button id="btnReset" class="mt-3 w-full bg-primary dark:bg-dark-primary text-white rounded-xl py-3 font-semibold">Send reset link</button>
  </div>

  <script>
    // Utilities
    const $ = (s, el = document) => el.querySelector(s);
    const $$ = (s, el = document) => [...el.querySelectorAll(s)];

    const Storage = {
      get: (k, d) => {
        try { const v = localStorage.getItem('raved_' + k); return v ? JSON.parse(v) : d; } catch { return d; }
      },
      set: (k, v) => { try { localStorage.setItem('raved_' + k, JSON.stringify(v)); } catch {} },
      del: (k) => { try { localStorage.removeItem('raved_' + k); } catch {} },
    };

    const UI = {
      overlay: $('#overlay'),
      openSheet(id) {
        UI.overlay.classList.add('show');
        const el = $('#' + id);
        el.classList.add('show');

        // Initialize sheet interactions
        UI.initSheetInteractions(el);
      },
      closeSheet(id) {
        const el = $('#' + id);
        el.classList.remove('show');
        // if no other sheet open, hide overlay
        const anyOpen = $$('.sheet').some(s => s.classList.contains('show'));
        if (!anyOpen) UI.overlay.classList.remove('show');
      },
      closeAllSheets() {
        $$('.sheet').forEach(s => s.classList.remove('show'));
        UI.overlay.classList.remove('show');
      },
      expandSheet(sheet) {
        sheet.classList.remove('collapsed');
        sheet.classList.add('expanded');
      },
      collapseSheet(sheet) {
        sheet.classList.remove('expanded');
        sheet.classList.add('collapsed');
      },
      initSheetInteractions(sheet) {
        const handle = sheet.querySelector('.sheet-handle');
        if (!handle) return;

        let startY = 0;
        let currentY = 0;
        let isDragging = false;

        handle.addEventListener('mousedown', startDrag);
        handle.addEventListener('touchstart', startDrag);

        function startDrag(e) {
          isDragging = true;
          startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY;
          handle.style.cursor = 'grabbing';

          document.addEventListener('mousemove', drag);
          document.addEventListener('touchmove', drag);
          document.addEventListener('mouseup', endDrag);
          document.addEventListener('touchend', endDrag);
        }

        function drag(e) {
          if (!isDragging) return;
          e.preventDefault();
          currentY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY;
          const deltaY = currentY - startY;

          // Visual feedback during drag
          if (deltaY > 50) {
            handle.style.background = '#ef4444';
          } else if (deltaY < -50) {
            handle.style.background = '#10b981';
          } else {
            handle.style.background = '';
          }
        }

        function endDrag() {
          if (!isDragging) return;
          isDragging = false;
          handle.style.cursor = 'grab';
          handle.style.background = '';

          const deltaY = currentY - startY;

          if (deltaY > 100) {
            // Swipe down - collapse or close
            if (sheet.classList.contains('expanded')) {
              UI.collapseSheet(sheet);
            } else {
              UI.closeSheet(sheet.id.replace('sheet', 'sheet'));
            }
          } else if (deltaY < -100) {
            // Swipe up - expand
            UI.expandSheet(sheet);
          }

          document.removeEventListener('mousemove', drag);
          document.removeEventListener('touchmove', drag);
          document.removeEventListener('mouseup', endDrag);
          document.removeEventListener('touchend', endDrag);
        }

        // Double tap to toggle
        let lastTap = 0;
        handle.addEventListener('click', () => {
          const now = Date.now();
          if (now - lastTap < 300) {
            if (sheet.classList.contains('collapsed')) {
              UI.expandSheet(sheet);
            } else {
              UI.collapseSheet(sheet);
            }
          }
          lastTap = now;
        });
      },
      toastTimer: null,
      toast(msg, type = 'success') {
        const t = $('#toast');
        const ti = $('#toast-icon');
        const tt = $('#toast-text');
        tt.textContent = msg;
        ti.className = 'fa-solid mr-2 ' + (type === 'success'
          ? 'fa-circle-check text-success'
          : type === 'error' ? 'fa-circle-exclamation text-red-500' : 'fa-circle-info text-blue-500');
        t.classList.remove('hidden');
        setTimeout(() => t.classList.add('show'), 10);
        clearTimeout(UI.toastTimer);
        UI.toastTimer = setTimeout(() => {
          t.classList.remove('show');
          setTimeout(() => t.classList.add('hidden'), 250);
        }, 2500);
      },
      setTitle(tab) {
        const map = { home: 'Home', faculties: 'Faculties', create: 'Create', events: 'Events', profile: 'Profile' };
        $('#appTitle').textContent = map[tab] || 'Raved';
      },
    };

    // Seed Data
    const Users = [
      { id: 'u1', name: 'Sophie Parker', avatar: 'https://i.imgur.com/bxfE9TV.jpg', faculty: 'Science' },
      { id: 'u2', name: 'Emily White', avatar: 'https://i.imgur.com/nV6fsQh.jpg', faculty: 'Arts' },
      { id: 'u3', name: 'Marcus Stevens', avatar: 'https://i.imgur.com/IigY4Hm.jpg', faculty: 'Business' },
      { id: 'u4', name: 'Anna Reynolds', avatar: 'https://i.imgur.com/KnZQY6W.jpg', faculty: 'Medicine' },
      { id: 'u5', name: 'David Chen', avatar: 'https://i.imgur.com/kMB0Upu.jpg', faculty: 'Engineering' },
      { id: 'u6', name: 'Jason Miller', avatar: 'https://i.imgur.com/8Km9tLL.jpg', faculty: 'Law' },
    ];

    const Images = [
      'https://i.imgur.com/Ynh9LMX.jpg',
      'https://i.imgur.com/D3CYJcL.jpg',
      'https://i.imgur.com/JObkVPV.jpg',
      'https://i.imgur.com/KnZQY6W.jpg',
      'https://i.imgur.com/IigY4Hm.jpg',
      'https://i.imgur.com/nV6fsQh.jpg',
    ];

    // Sample video URLs for posts
    const Videos = [
      'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4',
      'https://www.learningcontainer.com/wp-content/uploads/2020/05/sample-mp4-file.mp4',
      'https://file-examples.com/storage/fe86c86b8b66f8e0b2b9b3b/2017/10/file_example_MP4_480_1_5MG.mp4',
    ];

    // Sample carousel image sets
    const CarouselSets = [
      [
        'https://i.imgur.com/Ynh9LMX.jpg',
        'https://i.imgur.com/D3CYJcL.jpg',
        'https://i.imgur.com/JObkVPV.jpg'
      ],
      [
        'https://i.imgur.com/KnZQY6W.jpg',
        'https://i.imgur.com/IigY4Hm.jpg',
        'https://i.imgur.com/nV6fsQh.jpg',
        'https://i.imgur.com/Ynh9LMX.jpg'
      ],
      [
        'https://i.imgur.com/D3CYJcL.jpg',
        'https://i.imgur.com/JObkVPV.jpg'
      ]
    ];

    const captions = [
      "Perfect outfit for today's presentation! üíº #CampusStyle",
      'Sustainable fashion vibes üåø #EcoFriendly',
      'Weekend casuals ‚ú® #Relaxed',
      'Library chic üìö #AcademicFashion',
      'Date night look üíï #Elegant',
      'Comfort meets style üòä #CampusLife',
      'Bold colors today üé® #Creative',
      'Vintage vibes üé≠ #VintageStyle',
    ];

    const StoreBase = [
      { id: 'item_1', name: 'Eco-Friendly Dress', price: 45, originalPrice: 60, image: Images[0], category: 'clothing', seller: Users[0], tags: ['sale'] },
      { id: 'item_2', name: 'Business Jacket', price: 89, originalPrice: null, image: Images[1], category: 'clothing', seller: Users[2], tags: [] },
      { id: 'item_3', name: 'Artistic Blouse', price: 32, originalPrice: null, image: Images[2], category: 'clothing', seller: Users[1], tags: [] },
      { id: 'item_4', name: 'Medical Scrubs', price: 28, originalPrice: null, image: Images[3], category: 'clothing', seller: Users[3], tags: ['hot'] },
    ];

    // App State
    const State = {
      theme: Storage.get('theme', 'light'),
      currentTab: 'home',
      currentUser: Storage.get('user', {
        id: 'me',
        name: 'Alex Johnson',
        username: 'alexjohnson',
        avatar: 'https://i.imgur.com/jL1aT9i.jpg',
        bio: 'Fashion enthusiast & Business student',
        faculty: 'Business',
        location: 'University of Ghana, Legon',
        website: '',
        followers: 1234,
        following: 567,
        theme: 'default', // User's selected color theme

        // Privacy settings
        isPrivate: false,
        showActivity: true,
        readReceipts: true,
        allowDownloads: false,
        allowStorySharing: true,
        analytics: true,
        personalizedAds: true,

        // Language & Regional settings
        language: 'en',
        dateFormat: 'DD/MM/YYYY',
        currency: 'GHS'
      }),
      loggedIn: Storage.get('loggedIn', true),
      likes: new Set(Storage.get('likes', [])),
      bookmarks: new Set(Storage.get('bookmarks', [])),
      follows: new Set(Storage.get('follows', [])),
      notifications: Storage.get('notifications', [
        { id: 'n1', text: 'Sophie liked your post', time: '2m' },
        { id: 'n2', text: 'Marcus started following you', time: '1h' },
      ]),
      stories: Storage.get('stories', []),
      posts: Storage.get('posts', []),
      comments: Storage.get('comments', {}), // postId: [{user, text, time}]
      storeItems: Storage.get('store', []),
      cart: Storage.get('cart', []),
      events: Storage.get('events', []),
      chats: Storage.get('chats', []),
      connections: Storage.get('connections', []),
      recentlyViewed: Storage.get('recentlyViewed', []),
      subscription: Storage.get('subscription', {
        isPremium: false,
        trialStartDate: Date.now(),
        trialDaysLeft: 7,
        subscriptionEndDate: null,
        paymentMethod: null
      }),
      rankings: Storage.get('rankings', []),
      userStats: Storage.get('userStats', {
        totalLikes: 0,
        totalComments: 0,
        totalShares: 0,
        totalSales: 0,
        weeklyScore: 0,
        monthlyScore: 0,
        allTimeScore: 0
      }),
      featuredId: Storage.get('featuredId', null),
      rankingMonthIdx: Storage.get('rankMonth', 0),
      searchIndex: [], // built after render
      temp: {
        activePostId: null,
        activeItemId: null,
        activeChatId: null,
        storyTimer: null,
      },
    };

    // Force reset posts to see new media types (for development)
    function resetPosts() {
      State.posts = [];
      State.comments = {};
      Storage.remove('posts');
      Storage.remove('comments');
      seedIfNeeded();
    }

    // Init demo content if empty
    function seedIfNeeded() {
      if (State.posts.length === 0) {
        // Create diverse posts with different media types
        const postTypes = ['image', 'video', 'carousel'];

        for (let i = 0; i < 9; i++) {
          const u = Users[Math.floor(Math.random() * Users.length)];
          const id = 'post_' + Date.now() + '_' + Math.random().toString(36).slice(2, 8);
          const postType = postTypes[i % 3]; // Cycle through post types

          let mediaData = {};

          if (postType === 'image') {
            mediaData = {
              type: 'image',
              image: Images[Math.floor(Math.random() * Images.length)]
            };
          } else if (postType === 'video') {
            mediaData = {
              type: 'video',
              video: Videos[Math.floor(Math.random() * Videos.length)],
              thumbnail: Images[Math.floor(Math.random() * Images.length)]
            };
          } else if (postType === 'carousel') {
            mediaData = {
              type: 'carousel',
              images: CarouselSets[Math.floor(Math.random() * CarouselSets.length)]
            };
          }

          State.posts.push({
            id,
            user: u,
            ...mediaData,
            caption: captions[Math.floor(Math.random() * captions.length)],
            tags: ['#CampusStyle', '#OOTD', '#StudentLife'].slice(0, Math.floor(Math.random()*3)+1),
            time: ['2m', '15m', '1h', '3h', '1d'][Math.floor(Math.random() * 5)],
            likes: Math.floor(Math.random() * 300) + 20,
            comments: Math.floor(Math.random() * 40) + 1,
            isForSale: Math.random() < 0.3, // 30% chance of being for sale
          });

          State.comments[id] = [
            { user: Users[1], text: 'Love this! üî•', time: '1h' },
            { user: Users[0], text: 'So cool üòç', time: '50m' },
          ];
        }
        State.featuredId = State.posts[0].id;
      }
      if (State.storeItems.length === 0) {
        const items = [...StoreBase];
        for (let i = 0; i < 8; i++) {
          const b = StoreBase[Math.floor(Math.random() * StoreBase.length)];
          items.push({
            ...b,
            id: 'item_' + Date.now() + '_' + Math.random().toString(36).slice(2, 6),
            name: b.name + ' ' + (i + 5),
            price: Math.floor(Math.random() * 90) + 20,
            originalPrice: Math.random() < 0.35 ? Math.floor(Math.random() * 120) + 60 : null,
          });
        }
        State.storeItems = items;
      }
      if (State.events.length === 0) {
        State.events = [
          {
            id: 'ev1',
            title: 'Spring Fashion Show 2024',
            organizer: 'Fashion Society',
            orgAvatar: Users[0].avatar,
            date: '2025-08-15',
            time: '19:00',
            location: 'Main Auditorium',
            category: 'fashion',
            audience: 'all',
            description: 'The biggest fashion show of the year featuring student designers.',
            image: Images[0],
            attendees: 156,
            max: 200,
            attending: false,
            tags: ['Fashion', 'Student Work', 'Networking'],
            ownerId: 'u1',
          },
          {
            id: 'ev2',
            title: 'Sustainable Fashion Workshop',
            organizer: 'Environmental Club',
            orgAvatar: Users[1].avatar,
            date: '2025-08-10',
            time: '14:00',
            location: 'Science Building Room 201',
            category: 'workshop',
            audience: 'undergraduate',
            description: 'Learn eco-friendly outfit practices and tips.',
            image: Images[2],
            attendees: 45,
            max: 50,
            attending: true,
            tags: ['Sustainability', 'Workshop'],
            ownerId: 'u2',
          },
          {
            id: 'ev3',
            title: 'Graduate Fashion Research Symposium',
            organizer: 'Graduate School',
            orgAvatar: Users[2].avatar,
            date: '2025-08-20',
            time: '10:00',
            location: 'Research Center',
            category: 'networking',
            audience: 'graduate',
            description: 'Present and discuss latest fashion research findings.',
            image: Images[1],
            attendees: 28,
            max: 40,
            attending: false,
            tags: ['Research', 'Graduate', 'Academic'],
            ownerId: 'u3',
          },
          {
            id: 'ev4',
            title: 'Faculty Fashion Lecture Series',
            organizer: 'Design Department',
            orgAvatar: Users[3].avatar,
            date: '2025-08-25',
            time: '16:00',
            location: 'Design Studio',
            category: 'workshop',
            audience: 'faculty',
            description: 'Professional development for fashion educators.',
            image: Images[3],
            attendees: 15,
            max: 25,
            attending: false,
            tags: ['Professional', 'Education', 'Faculty'],
            ownerId: 'u4',
          },
          {
            id: 'ev5',
            title: 'Alumni Fashion Network Mixer',
            organizer: 'Alumni Association',
            orgAvatar: Users[4].avatar,
            date: '2025-08-30',
            time: '18:00',
            location: 'Alumni Center',
            category: 'networking',
            audience: 'alumni',
            description: 'Connect with fashion industry professionals.',
            image: Images[4],
            attendees: 67,
            max: 80,
            attending: false,
            tags: ['Alumni', 'Networking', 'Industry'],
            ownerId: 'u5',
          },
          {
            id: 'ev6',
            title: 'Public Fashion Exhibition',
            organizer: 'Art Gallery',
            orgAvatar: Users[5].avatar,
            date: '2025-09-05',
            time: '12:00',
            location: 'City Art Gallery',
            category: 'fashion',
            audience: 'public',
            description: 'Open to the public - showcasing student fashion art.',
            image: Images[5],
            attendees: 234,
            max: 300,
            attending: true,
            tags: ['Public', 'Exhibition', 'Art'],
            ownerId: 'u6',
          },
        ];
      }
      if (State.chats.length === 0) {
        State.chats = [
          {
            id: 'c1',
            user: Users[0],
            status: 'online',
            unread: 2,
            messages: [
              { me: false, text: 'Hey! Love your latest post! üòç', time: '2m' },
              { me: true, text: 'Thank you so much! üíï', time: '1m' },
            ],
          },
          {
            id: 'c2',
            user: Users[2],
            status: 'online',
            unread: 0,
            messages: [
              { me: false, text: 'Are you going to the fashion show?', time: '15m' },
              { me: true, text: "Yes! Can't wait to see everyone there", time: '10m' },
            ],
          },
        ];
      }
      if (State.connections.length === 0) {
        // Create connections using only available users (Users array has 6 users: indices 0-5)
        State.connections = [
          // Following
          { id: 'conn1', user: Users[0], type: 'following', mutualFriends: 12, since: '2023-09-15' },
          { id: 'conn2', user: Users[1], type: 'following', mutualFriends: 8, since: '2023-10-22' },

          // Followers
          { id: 'conn3', user: Users[2], type: 'follower', mutualFriends: 5, since: '2023-11-05' },
          { id: 'conn4', user: Users[3], type: 'follower', mutualFriends: 3, since: '2023-12-01' },

          // Mutual (both following each other)
          { id: 'conn5', user: Users[4], type: 'mutual', mutualFriends: 20, since: '2023-07-20' },
          { id: 'conn6', user: Users[5], type: 'mutual', mutualFriends: 18, since: '2023-06-15' },

          // Pending requests (reuse some users with different connection types)
          { id: 'conn7', user: Users[0], type: 'pending', mutualFriends: 7, since: '2024-01-10' },
          { id: 'conn8', user: Users[1], type: 'pending', mutualFriends: 4, since: '2024-01-15' },

          // Suggested connections
          { id: 'conn9', user: Users[2], type: 'suggested', mutualFriends: 25, reason: 'Same faculty' },
          { id: 'conn10', user: Users[3], type: 'suggested', mutualFriends: 12, reason: 'Similar interests' },
          { id: 'conn11', user: Users[4], type: 'suggested', mutualFriends: 9, reason: 'Mutual friends' },
          { id: 'conn12', user: Users[5], type: 'suggested', mutualFriends: 15, reason: 'Common courses' },
        ];
      }

      // Seed some demo stories for horizontal scrolling
      if (State.stories.length === 0) {
        State.stories = [
          {
            id: 'story_demo_1',
            user: Users[0],
            type: 'template',
            content: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
            text: "Today's OOTD ‚ú®",
            timestamp: Date.now() - 3600000, // 1 hour ago
            views: 12,
            allowReplies: true
          },
          {
            id: 'story_demo_2',
            user: Users[1],
            type: 'template',
            content: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)',
            text: "Current mood üí´",
            timestamp: Date.now() - 7200000, // 2 hours ago
            views: 8,
            allowReplies: true
          },
          {
            id: 'story_demo_3',
            user: Users[2],
            type: 'template',
            content: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)',
            text: "Study vibes üìö",
            timestamp: Date.now() - 10800000, // 3 hours ago
            views: 15,
            allowReplies: true
          }
        ];
      }

      // Posts are now created by the enhanced seedIfNeeded function above
    }

    // Save state slices
    function persist() {
      Storage.set('theme', State.theme);
      Storage.set('user', State.currentUser);
      Storage.set('loggedIn', State.loggedIn);
      Storage.set('likes', [...State.likes]);
      Storage.set('bookmarks', [...State.bookmarks]);
      Storage.set('follows', [...State.follows]);
      Storage.set('notifications', State.notifications);
      Storage.set('posts', State.posts);
      Storage.set('comments', State.comments);
      Storage.set('store', State.storeItems);
      Storage.set('cart', State.cart);
      Storage.set('events', State.events);
      Storage.set('chats', State.chats);
      Storage.set('featuredId', State.featuredId);
      Storage.set('rankMonth', State.rankingMonthIdx);
    }

    // THEME
    function applyTheme() {
      if (State.theme === 'dark') document.documentElement.classList.add('dark');
      else document.documentElement.classList.remove('dark');
    }

    // AUTH
    function showApp() {
      $('#auth').classList.add('hidden');
      $('#app').classList.remove('hidden');
      UI.setTitle(State.currentTab);
      renderAll();
    }
    function signOut() {
      State.loggedIn = false;
      persist();
      UI.closeAllSheets();
      $('#app').classList.add('hidden');
      $('#auth').classList.remove('hidden');
      UI.toast('Signed out', 'success');
    }

    // RENDERERS
    function renderStories() {
      const me = State.currentUser;
      const row = $('#storiesRow');

      // Create story button (always first)
      const createStoryBtn = `
        <button id="btnCreateStory" class="flex flex-col items-center w-16 flex-shrink-0 tap-active" onclick="openCreateStory()">
          <div class="w-16 h-16 rounded-full bg-gradient-to-br from-primary to-purple-500 flex items-center justify-center text-white shadow-lg">
            <i class="fa-solid fa-plus text-xl"></i>
          </div>
          <div class="text-[10px] mt-1 truncate w-full text-center font-medium">Create</div>
        </button>`;

      // Your story (if you have stories)
      const yourStoryBtn = State.stories.some(s => s.user.id === me.id) ? `
        <button class="flex flex-col items-center w-16 flex-shrink-0 tap-active" onclick="openStory('${me.id}')">
          <div class="story-ring">
            <div class="bg-white dark:bg-dark-card rounded-full p-0.5">
              <img src="${me.avatar}" class="w-14 h-14 rounded-full object-cover" />
            </div>
          </div>
          <div class="text-[10px] mt-1 truncate w-full text-center">You</div>
        </button>` : '';

      // Show all users as having stories for demo purposes (to enable horizontal scroll)
      const allUserStories = Users.map(u => {
        return `
          <button class="flex flex-col items-center w-16 flex-shrink-0 tap-active" onclick="openStory('${u.id}')">
            <div class="story-ring">
              <div class="bg-white dark:bg-dark-card rounded-full p-0.5">
                <img src="${u.avatar}" class="w-14 h-14 rounded-full object-cover" />
              </div>
            </div>
            <div class="text-[10px] mt-1 truncate w-full text-center">${u.name.split(' ')[0]}</div>
          </button>`;
      }).join('');

      // Add some additional demo users for better horizontal scrolling
      const additionalStories = [
        { name: 'Alex', avatar: 'https://i.imgur.com/8qhbqxM.jpg' },
        { name: 'Maya', avatar: 'https://i.imgur.com/9L2OxQK.jpg' },
        { name: 'Ryan', avatar: 'https://i.imgur.com/jL1aT9i.jpg' },
        { name: 'Zoe', avatar: 'https://i.imgur.com/8qhbqxM.jpg' },
        { name: 'Jake', avatar: 'https://i.imgur.com/9L2OxQK.jpg' },
        { name: 'Luna', avatar: 'https://i.imgur.com/jL1aT9i.jpg' },
        { name: 'Sam', avatar: 'https://i.imgur.com/8qhbqxM.jpg' },
        { name: 'Aria', avatar: 'https://i.imgur.com/9L2OxQK.jpg' }
      ].map(user => `
        <button class="flex flex-col items-center w-16 flex-shrink-0 tap-active" onclick="openStory('demo_${user.name}')">
          <div class="story-ring">
            <div class="bg-white dark:bg-dark-card rounded-full p-0.5">
              <img src="${user.avatar}" class="w-14 h-14 rounded-full object-cover" />
            </div>
          </div>
          <div class="text-[10px] mt-1 truncate w-full text-center">${user.name}</div>
        </button>`).join('');

      row.innerHTML = createStoryBtn + yourStoryBtn + allUserStories + additionalStories;
    }

    function postActionsHTML(p) {
      const liked = State.likes.has(p.id);
      const saved = State.bookmarks.has(p.id);
      return `
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <button class="tap-active text-${liked ? 'red-500' : 'gray-600'}" data-like="${p.id}">
              <i class="${liked ? 'fa-solid' : 'fa-regular'} fa-heart"></i> <span class="ml-1 text-sm">${p.likes}</span>
            </button>
            <button class="tap-active text-gray-600" data-comment="${p.id}">
              <i class="fa-regular fa-comment"></i> <span class="ml-1 text-sm">${p.comments}</span>
            </button>
            <button class="tap-active text-gray-600" data-share="${p.id}">
              <i class="fa-solid fa-share"></i> <span class="ml-1 text-sm">Share</span>
            </button>
          </div>
          <div class="flex items-center gap-3">
            ${p.isForSale ? `
              <button class="tap-active text-green-600 hover:text-green-700 transition-colors" data-add-to-cart="${p.id}" title="Add to Cart">
                <i class="fa-solid fa-cart-plus"></i>
              </button>
            ` : ''}
            <button class="tap-active text-${saved ? 'yellow-500' : 'gray-600'}" data-save="${p.id}">
              <i class="${saved ? 'fa-solid' : 'fa-regular'} fa-bookmark"></i>
            </button>
            <button class="tap-active text-gray-400" data-more="${p.id}">
              <i class="fa-solid fa-ellipsis"></i>
            </button>
          </div>
        </div>`;
    }

    function renderPostMedia(p, clickableImage = true) {
      if (p.type === 'video') {
        return `
          <div class="relative">
            <video class="post-media" controls poster="${p.thumbnail}" ${clickableImage ? `data-open-post="${p.id}"` : ''}>
              <source src="${p.video}" type="video/mp4">
              Your browser does not support the video tag.
            </video>
            <div class="absolute top-3 left-3">
              <span class="px-2 py-1 bg-black/50 text-white text-xs rounded-full">
                <i class="fa-solid fa-play mr-1"></i>Video
              </span>
            </div>
          </div>
        `;
      } else if (p.type === 'carousel') {
        return `
          <div class="relative">
            <div class="carousel-container" data-post-id="${p.id}">
              <div class="carousel-track" style="transform: translateX(0%)">
                ${p.images.map((img, index) => `
                  <img src="${img}" class="post-media carousel-slide" ${clickableImage ? `data-open-post="${p.id}"` : ''} data-slide="${index}" />
                `).join('')}
              </div>
              ${p.images.length > 1 ? `
                <button class="carousel-btn carousel-prev absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center" data-carousel-prev="${p.id}">
                  <i class="fa-solid fa-chevron-left text-sm"></i>
                </button>
                <button class="carousel-btn carousel-next absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 text-white rounded-full w-8 h-8 flex items-center justify-center" data-carousel-next="${p.id}">
                  <i class="fa-solid fa-chevron-right text-sm"></i>
                </button>
                <div class="absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1">
                  ${p.images.map((_, index) => `
                    <div class="carousel-dot w-2 h-2 rounded-full bg-white/50 ${index === 0 ? 'bg-white' : ''}" data-dot="${index}"></div>
                  `).join('')}
                </div>
              ` : ''}
            </div>
            <div class="absolute top-3 right-3">
              <span class="px-2 py-1 bg-black/50 text-white text-xs rounded-full">
                <i class="fa-solid fa-images mr-1"></i>${p.images.length}
              </span>
            </div>
          </div>
        `;
      } else {
        // Default image post
        return `<img src="${p.image}" class="post-media" ${clickableImage ? `data-open-post="${p.id}"` : ''} />`;
      }
    }

    function postCardHTML(p, clickableImage = true) {
      return `
        <div class="bg-white dark:bg-dark-card rounded-2xl overflow-hidden shadow-sm">
          <div class="p-3 flex items-center gap-3">
            <img src="${p.user.avatar}" class="w-9 h-9 rounded-full object-cover" />
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <div class="font-semibold text-sm">${p.user.name}</div>
                <span class="text-[10px] px-2 py-0.5 rounded-full bg-primary/10 dark:bg-dark-primary/20 text-primary dark:text-dark-primary">${p.user.faculty}</span>
              </div>
              <div class="text-[11px] text-gray-500">${p.time} ago</div>
            </div>
          </div>
          <div class="relative">
            ${renderPostMedia(p, clickableImage)}
            ${p.isForSale ? `
              <div class="absolute top-3 right-3">
                <span class="price-tag">
                  <i class="fa-solid fa-tag mr-1"></i>$${p.price}
                </span>
              </div>
              <button class="absolute right-3 bottom-3 bg-white dark:bg-slate-900/80 backdrop-blur text-primary dark:text-dark-primary rounded-full p-2 tap-active" data-shop-from-post="${p.id}">
                <i class="fa-solid fa-cart-shopping"></i>
              </button>
            ` : ''}
          </div>
          <div class="p-3">
            ${postActionsHTML(p)}
            <p class="mt-2 text-sm"><span class="font-semibold">${p.user.name}</span> ${p.caption}</p>
            ${p.isForSale ? `
              <div class="mt-2 flex flex-wrap gap-2">
                <span class="sale-badge">
                  <i class="fa-solid fa-store"></i>Available for Sale
                </span>
                ${p.brand ? `<span class="text-xs px-2 py-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-full">${p.brand}</span>` : ''}
                ${p.condition ? `<span class="text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-full">${p.condition}</span>` : ''}
              </div>
            ` : ''}
            <div class="mt-2 flex flex-wrap gap-2">
              ${p.tags.map(t => `<button class="text-xs text-primary dark:text-dark-primary" data-tag="${t}">${t}</button>`).join('')}
            </div>
            <button class="mt-2 text-xs text-gray-500" data-comment="${p.id}">View all ${p.comments} comments</button>
          </div>
        </div>`;
    }

    function renderFeatured() {
      const fp = State.posts.find(x => x.id === State.featuredId) || State.posts[0];
      $('#featuredPost').innerHTML = postCardHTML(fp);
    }

    function renderFeed(append = false) {
      const feed = $('#feed');
      const html = State.posts.map(p => postCardHTML(p)).join('');
      if (append) feed.insertAdjacentHTML('beforeend', html);
      else feed.innerHTML = html;

      bindPostInteractions(feed);
    }

    function bindPostInteractions(root = document) {
      $$('[data-like]', root).forEach(b => b.onclick = () => toggleLike(b.getAttribute('data-like'), b));
      $$('[data-save]', root).forEach(b => b.onclick = () => toggleSave(b.getAttribute('data-save'), b));
      $$('[data-comment]', root).forEach(b => b.onclick = () => openComments(b.getAttribute('data-comment')));
      $$('[data-share]', root).forEach(b => b.onclick = () => sharePost(b.getAttribute('data-share')));
      $$('[data-more]', root).forEach(b => b.onclick = () => morePostActions(b.getAttribute('data-more')));
      $$('[data-open-post]', root).forEach(b => b.onclick = () => openPostDetail(b.getAttribute('data-open-post')));
      $$('[data-shop-from-post]', root).forEach(b => b.onclick = () => { UI.toast('Showing similar items üõçÔ∏è'); switchTab('store'); });
      $$('[data-add-to-cart]', root).forEach(b => b.onclick = () => addToCartFromPost(b.getAttribute('data-add-to-cart')));
      $$('[data-tag]', root).forEach(b => b.onclick = () => { UI.toast('Filtering by ' + b.textContent, 'info'); filterByTag(b.textContent); });

      // Carousel controls
      $$('[data-carousel-prev]', root).forEach(b => b.onclick = (e) => {
        e.stopPropagation();
        navigateCarousel(b.getAttribute('data-carousel-prev'), 'prev');
      });
      $$('[data-carousel-next]', root).forEach(b => b.onclick = (e) => {
        e.stopPropagation();
        navigateCarousel(b.getAttribute('data-carousel-next'), 'next');
      });
    }

    // Carousel navigation
    function navigateCarousel(postId, direction) {
      const container = $(`[data-post-id="${postId}"]`);
      if (!container) return;

      const track = container.querySelector('.carousel-track');
      const slides = container.querySelectorAll('.carousel-slide');
      const dots = container.querySelectorAll('.carousel-dot');

      if (!track || slides.length <= 1) return;

      let currentIndex = parseInt(container.dataset.currentSlide || '0');

      if (direction === 'next') {
        currentIndex = (currentIndex + 1) % slides.length;
      } else {
        currentIndex = currentIndex === 0 ? slides.length - 1 : currentIndex - 1;
      }

      container.dataset.currentSlide = currentIndex;
      track.style.transform = `translateX(-${currentIndex * 100}%)`;

      // Update dots
      dots.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.remove('bg-white/50');
          dot.classList.add('bg-white');
        } else {
          dot.classList.remove('bg-white');
          dot.classList.add('bg-white/50');
        }
      });
    }

    function renderStoreTeaser() {
      const grid = $('#storeTeaser');
      const items = State.storeItems.slice(0, 4);
      grid.innerHTML = items.map(i => storeItemCard(i)).join('');
      bindStoreCards(grid);
    }

    function renderStore(filter = 'all') {
      const grid = $('#storeGrid');
      const items = State.storeItems.filter(i => {
        if (filter === 'all') return true;
        if (filter === 'sale') return i.originalPrice && i.originalPrice > i.price;
        return i.category === filter || (filter === 'accessories' && i.category === 'accessories') || (filter === 'shoes' && i.category === 'shoes');
      });
      grid.innerHTML = items.map(i => storeItemCard(i, true)).join('');
      bindStoreCards(grid);
    }

    function storeItemCard(i, big = false) {
      const discount = i.originalPrice && i.originalPrice > i.price;
      const badge = discount ? '<span class="absolute top-2 right-2 text-[10px] bg-red-500 text-white px-2 py-0.5 rounded-full">Sale</span>' : '';
      return `
        <div class="bg-white dark:bg-dark-card rounded-2xl overflow-hidden shadow-sm cursor-pointer hover:shadow-lg transition-all" data-open-item="${i.id}">
          <div class="relative">
            <img src="${i.image}" class="${big ? 'h-44' : 'h-28'} w-full object-cover" />
            ${badge}
            <div class="absolute top-2 left-2 px-2 py-1 bg-black/70 text-white text-xs rounded-full">
              ${i.condition || 'Good'}
            </div>
          </div>
          <div class="p-2">
            <div class="text-sm font-semibold line-clamp-1">${i.name}</div>
            <div class="text-[11px] text-gray-500 flex items-center gap-1">
              <img src="${i.seller.avatar}" class="w-4 h-4 rounded-full" /> ${i.seller.name}
            </div>
            <div class="mt-1 flex items-center justify-between">
              <div class="flex items-end gap-1">
                <div class="text-primary dark:text-dark-primary font-extrabold">‚Çµ${i.price}</div>
                ${discount ? `<div class="text-[11px] text-gray-400 line-through">‚Çµ${i.originalPrice}</div>` : ''}
              </div>
              <button class="bg-primary text-white rounded-full p-2 text-xs tap-active" data-add-cart="${i.id}" onclick="event.stopPropagation()">
                <i class="fa-solid fa-cart-plus"></i>
              </button>
            </div>
          </div>
        </div>`;
    }

    function bindStoreCards(root = document) {
      $$('[data-open-item]', root).forEach(b => b.onclick = () => openProductDetail(b.getAttribute('data-open-item')));
      $$('[data-add-cart]', root).forEach(b => b.onclick = (e) => {
        e.stopPropagation();
        addToCartFromStore(b.getAttribute('data-add-cart'));
      });
    }

    function renderTopPosts() {
      const wrap = $('#topPosts');
      if (!wrap) return; // Skip if element doesn't exist

      const tops = State.posts.slice(0, 3);
      wrap.innerHTML = tops.map((p, idx) => {
        const thumbnailSrc = p.type === 'video' ? p.thumbnail :
                           p.type === 'carousel' ? p.images[0] :
                           p.image;

        return `
          <button class="relative rounded-xl overflow-hidden tap-active" data-open-post="${p.id}">
            <img src="${thumbnailSrc}" class="w-full h-28 object-cover" />
            <div class="absolute top-2 left-2 text-[10px] bg-yellow-500 text-white px-1.5 py-0.5 rounded-full"><i class="fa-solid fa-crown mr-1"></i>#${idx+1}</div>
            ${p.type === 'video' ? '<div class="absolute top-2 right-2 text-[10px] bg-black/50 text-white px-1.5 py-0.5 rounded-full"><i class="fa-solid fa-play mr-1"></i></div>' : ''}
            ${p.type === 'carousel' ? `<div class="absolute top-2 right-2 text-[10px] bg-black/50 text-white px-1.5 py-0.5 rounded-full"><i class="fa-solid fa-images mr-1"></i>${p.images.length}</div>` : ''}
            <div class="absolute bottom-0 inset-x-0 p-2 bg-gradient-to-t from-black/80 to-transparent">
              <div class="flex items-center gap-1 text-white">
                <img src="${p.user.avatar}" class="w-4 h-4 rounded-full" />
                <div class="text-[11px]">${p.user.name}</div>
              </div>
            </div>
          </button>
        `;
      }).join('');
      bindPostInteractions(wrap);
    }

    function renderEvents(filter = 'all', audience = 'all') {
      const list = $('#eventsList');
      const meId = State.currentUser.id;
      let items = State.events.filter(e => {
        // Filter by event type
        let typeMatch = true;
        if (filter !== 'all') {
          if (filter === 'my-events') {
            typeMatch = e.ownerId === meId || e.attending;
          } else {
            typeMatch = e.category === filter;
          }
        }

        // Filter by audience
        let audienceMatch = true;
        if (audience !== 'all') {
          audienceMatch = e.audience === audience;
        }

        return typeMatch && audienceMatch;
      });

      list.innerHTML = items.map(e => {
        const date = new Date(e.date);
        const booked = e.attendees >= e.max;
        return `
          <div class="bg-white dark:bg-dark-card rounded-2xl overflow-hidden shadow-sm">
            <div class="relative">
              <img src="${e.image}" class="w-full h-40 object-cover" data-open-event="${e.id}" />
              <div class="absolute top-2 left-2 bg-white dark:bg-slate-900 rounded-lg px-2 py-1 text-center">
                <div class="text-[10px] text-gray-500">${date.toLocaleString('en', { month: 'short' }).toUpperCase()}</div>
                <div class="text-sm font-extrabold text-primary dark:text-dark-primary">${date.getDate()}</div>
              </div>
              <div class="absolute top-2 right-2 bg-primary text-white text-[10px] px-2 py-1 rounded-full">${e.category}</div>
            </div>
            <div class="p-3">
              <div class="flex items-center justify-between">
                <div class="font-bold">${e.title}</div>
                <div class="text-xs text-gray-500">${e.time}</div>
              </div>
              <div class="flex items-center gap-2 mt-1 text-xs text-gray-600">
                <img src="${e.orgAvatar}" class="w-5 h-5 rounded-full" />
                <span>by ${e.organizer}</span>
              </div>
              <div class="flex items-center gap-2 mt-1 text-xs text-gray-600">
                <i class="fa-solid fa-location-dot text-gray-400"></i> <span>${e.location}</span>
              </div>
              <p class="mt-2 text-sm text-gray-600 dark:text-gray-400 line-clamp-2">${e.description}</p>
              <div class="mt-3 flex items-center justify-between">
                <div class="text-xs text-gray-600"><i class="fa-solid fa-users mr-1"></i>${e.attendees}/${e.max} attending ${booked ? '<span class="ml-1 text-red-500">Full</span>' : ''}</div>
                <button class="px-3 py-1.5 rounded-lg text-sm font-medium ${e.attending ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200' : 'bg-primary text-white'} tap-active" data-toggle-ev="${e.id}">
                  ${e.attending ? 'Attending' : booked ? 'Full' : 'Join'}
                </button>
              </div>
            </div>
          </div>`;
      }).join('');

      $$('[data-toggle-ev]').forEach(b => b.onclick = () => toggleEvent(b.getAttribute('data-toggle-ev')));
      $$('[data-open-event]').forEach(b => b.onclick = () => openEventDetail(b.getAttribute('data-open-event')));
    }

    function renderProfile() {
      // Update profile header
      const pfAvatar = $('#pfAvatar');
      const pfName = $('#pfName');
      const pfUsername = $('#pfUsername');
      const pfBio = $('#pfBio');

      if (pfAvatar) pfAvatar.src = State.currentUser.avatar;
      if (pfName) pfName.textContent = State.currentUser.name;
      if (pfUsername) pfUsername.textContent = '@' + (State.currentUser.username || 'user');
      if (pfBio) pfBio.textContent = State.currentUser.bio || State.currentUser.faculty || 'Fashion enthusiast';

      // Update stats
      const userPosts = State.posts.filter(p => p.user.id === State.currentUser.id);
      const likedPosts = State.posts.filter(p => State.likes.has(p.id));

      const pfCountPosts = $('#pfCountPosts');
      const pfCountFollowers = $('#pfCountFollowers');
      const pfCountFollowing = $('#pfCountFollowing');
      const pfCountLikes = $('#pfCountLikes');

      if (pfCountPosts) pfCountPosts.textContent = userPosts.length;
      if (pfCountFollowers) pfCountFollowers.textContent = State.currentUser.followers || 0;
      if (pfCountFollowing) pfCountFollowing.textContent = State.currentUser.following || 0;
      if (pfCountLikes) pfCountLikes.textContent = likedPosts.length;

      // Update dark mode toggle
      const darkModeToggle = $('#darkModeToggle');
      if (darkModeToggle) {
        darkModeToggle.checked = State.theme === 'dark';
      }

      // Update current theme name
      const currentThemeName = $('#currentThemeName');
      if (currentThemeName) {
        const themeNames = {
          'default': 'Raved Classic',
          'rose': 'Rose Garden',
          'emerald': 'Emerald Dream',
          'purple': 'Purple Haze',
          'blue': 'Ocean Blue',
          'orange': 'Sunset Orange'
        };
        currentThemeName.textContent = themeNames[State.currentTheme] || 'Raved Classic';
      }

      // Bind profile tab events
      bindProfileEvents();

      // Render the default tab (posts)
      switchProfileTab('posts');
    }

    // FACULTY FUNCTIONS
    const FacultyData = {
      all: { title: 'All Faculties', members: '12.5k', posts: '8.2k', events: '156' },
      arts: { title: 'Arts & Humanities', members: '2.4k', posts: '1.2k', events: '24' },
      business: { title: 'Business', members: '3.1k', posts: '2.1k', events: '32' },
      engineering: { title: 'Engineering', members: '2.8k', posts: '1.8k', events: '28' },
      science: { title: 'Science', members: '2.2k', posts: '1.5k', events: '22' },
      medicine: { title: 'Medicine', members: '2.0k', posts: '1.6k', events: '50' }
    };

    function renderFaculties(faculty = 'all') {
      const data = FacultyData[faculty];
      if (!data) {
        console.warn('Faculty data not found for:', faculty);
        return;
      }

      const facultyMembers = $('#facultyMembers');
      const facultyPosts = $('#facultyPosts');
      const facultyEvents = $('#facultyEvents');
      const facultyFeedTitle = $('#facultyFeedTitle');

      if (facultyMembers) facultyMembers.textContent = data.members;
      if (facultyPosts) facultyPosts.textContent = data.posts;
      if (facultyEvents) facultyEvents.textContent = data.events;
      if (facultyFeedTitle) facultyFeedTitle.innerHTML = `<i class="fa-solid fa-fire text-accent mr-2"></i>Trending in ${data.title}`;

      // Filter posts by faculty if not 'all'
      let facultyPostsData = State.posts;
      if (faculty !== 'all') {
        facultyPostsData = State.posts.filter(p => p.user.faculty && p.user.faculty.toLowerCase().includes(faculty));
      }

      const feed = $('#facultyFeed');
      if (feed) {
        feed.innerHTML = facultyPostsData.map(p => postCardHTML(p)).join('');
        bindPostInteractions(feed);
      }
    }

    function renderInbox() {
      const wrap = $('#chatList');
      if (!wrap) return;
      if (!State.chats || State.chats.length === 0) {
        wrap.innerHTML = `
          <div class="p-6 text-center text-gray-500 dark:text-gray-400">
            <i class="fa-solid fa-comments text-2xl mb-2 opacity-50"></i>
            <div class="text-sm">No conversations yet</div>
          </div>`;
        return;
      }
      wrap.innerHTML = State.chats.map(c => `
        <button class="w-full px-4 py-3 flex items-center gap-3 tap-active" data-open-chat="${c.id}">
          <div class="relative">
            <img src="${c.user.avatar}" class="w-11 h-11 rounded-full object-cover" />
            <span class="absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-white dark:border-dark-card ${c.status === 'online' ? 'bg-green-500' : 'bg-gray-400'}"></span>
          </div>
          <div class="flex-1 text-left">
            <div class="flex items-center justify-between">
              <div class="font-semibold text-sm">${c.user.name}</div>
              <div class="text-[10px] text-gray-500">${(c.messages.at(-1)?.time) || ''}</div>
            </div>
            <div class="text-xs text-gray-600 dark:text-gray-400 line-clamp-1">${(c.messages.at(-1)?.text) || ''}</div>
          </div>
          ${c.unread ? `<span class="ml-2 text-[10px] bg-primary text-white rounded-full px-1.5">${c.unread}</span>` : ''}
        </button>
      `).join('');
      $$('[data-open-chat]').forEach(b => b.onclick = () => openChat(b.getAttribute('data-open-chat')));
    }

    // CONNECTIONS FUNCTIONS
    function renderConnections(filter = 'all') {
      const list = $('#connectionsList');
      let connections = State.connections.filter(conn => conn.user && conn.user.avatar); // Filter out invalid connections

      if (!list) return;
      if (!connections || connections.length === 0) {
        list.innerHTML = `
          <div class="p-6 text-center text-gray-500 dark:text-gray-400">
            <i class="fa-solid fa-users text-2xl mb-2 opacity-50"></i>
            <div class="text-sm">No connections to show</div>
          </div>`;
        return;
      }

      if (filter !== 'all') {
        if (filter === 'following') {
          connections = connections.filter(c => c.type === 'following' || c.type === 'mutual');
        } else if (filter === 'followers') {
          connections = connections.filter(c => c.type === 'follower' || c.type === 'mutual');
        } else if (filter === 'requests') {
          connections = connections.filter(c => c.type === 'pending');
        } else if (filter === 'suggested') {
          connections = connections.filter(c => c.type === 'suggested');
        }
      }

      list.innerHTML = connections.map(conn => `
        <div class="p-4 hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
          <div class="flex items-center gap-3">
            <div class="relative">
              <img src="${conn.user.avatar}" class="w-12 h-12 rounded-full object-cover" />
              ${conn.type === 'mutual' ? '<div class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center"><i class="fa-solid fa-check text-white text-xs"></i></div>' : ''}
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <div class="font-semibold text-sm">${conn.user.name}</div>
                <div class="text-xs text-gray-500">${getConnectionStatus(conn)}</div>
              </div>
              <div class="text-xs text-gray-600 dark:text-gray-400">${conn.user.faculty}</div>
              <div class="text-xs text-gray-500 mt-1">
                ${conn.mutualFriends} mutual friends
                ${conn.reason ? ` ‚Ä¢ ${conn.reason}` : ''}
              </div>
            </div>
            <div class="flex flex-col gap-2">
              ${getConnectionActions(conn)}
            </div>
          </div>
        </div>
      `).join('');

      // Bind connection actions
      $$('[data-connection-action]').forEach(btn => {
        btn.onclick = () => handleConnectionAction(btn.dataset.connectionAction, btn.dataset.connectionId);
      });
    }

    function getConnectionStatus(conn) {
      switch(conn.type) {
        case 'following': return 'Following';
        case 'follower': return 'Follows you';
        case 'mutual': return 'Friends';
        case 'pending': return 'Pending';
        case 'suggested': return 'Suggested';
        default: return '';
      }
    }

    function getConnectionActions(conn) {
      switch(conn.type) {
        case 'following':
          return `<button class="px-3 py-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-lg text-xs font-medium" data-connection-action="unfollow" data-connection-id="${conn.id}">Unfollow</button>`;
        case 'follower':
          return `<button class="px-3 py-1 bg-primary text-white rounded-lg text-xs font-medium" data-connection-action="follow" data-connection-id="${conn.id}">Follow Back</button>`;
        case 'mutual':
          return `
            <button class="px-3 py-1 bg-blue-100 dark:bg-blue-900/20 text-blue-600 rounded-lg text-xs font-medium" data-connection-action="message" data-connection-id="${conn.id}">Message</button>
            <button class="px-3 py-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-lg text-xs font-medium" data-connection-action="unfollow" data-connection-id="${conn.id}">Unfollow</button>
          `;
        case 'pending':
          return `
            <button class="px-3 py-1 bg-green-100 dark:bg-green-900/20 text-green-600 rounded-lg text-xs font-medium" data-connection-action="accept" data-connection-id="${conn.id}">Accept</button>
            <button class="px-3 py-1 bg-red-100 dark:bg-red-900/20 text-red-600 rounded-lg text-xs font-medium" data-connection-action="decline" data-connection-id="${conn.id}">Decline</button>
          `;
        case 'suggested':
          return `<button class="px-3 py-1 bg-primary text-white rounded-lg text-xs font-medium" data-connection-action="connect" data-connection-id="${conn.id}">Connect</button>`;
        default:
          return '';
      }
    }

    function handleConnectionAction(action, connectionId) {
      const conn = State.connections.find(c => c.id === connectionId);
      if (!conn) return;

      switch(action) {
        case 'follow':
        case 'connect':
          conn.type = 'following';
          UI.toast(`Now following ${conn.user.name}`);
          break;
        case 'unfollow':
          conn.type = conn.type === 'mutual' ? 'follower' : 'suggested';
          UI.toast(`Unfollowed ${conn.user.name}`);
          break;
        case 'accept':
          conn.type = 'mutual';
          UI.toast(`${conn.user.name} is now your friend`);
          break;
        case 'decline':
          State.connections = State.connections.filter(c => c.id !== connectionId);
          UI.toast('Request declined');
          break;
        case 'message':
          // Open chat with this user
          UI.closeSheet('sheetConnections');
          openMessages();
          break;
      }

      persist();
      const currentFilter = $('.connection-filter.bg-primary')?.dataset.filter || 'all';
      renderConnections(currentFilter);
    }

    // SIMILAR ITEMS FUNCTIONS
    function showSimilarItems(itemId) {
      const item = State.storeItems.find(i => i.id === itemId);
      if (!item) return;

      // Add to recently viewed
      addToRecentlyViewed(item);

      // Store current item for similar items display
      State.temp.currentSimilarItem = item;

      // Render similar items
      renderSimilarItems(item, 'all');

      // Open similar items sheet
      UI.openSheet('sheetSimilarItems');
    }

    function viewItemDetails(itemId) {
      const item = State.storeItems.find(i => i.id === itemId);
      if (!item) return;

      // Add to recently viewed
      addToRecentlyViewed(item);

      // Show item details (you can expand this to show a detailed view)
      UI.toast(`Viewing ${item.name}`, 'info');

      // For now, show similar items
      showSimilarItems(itemId);
    }

    function addToRecentlyViewed(item) {
      // Remove if already exists
      State.recentlyViewed = State.recentlyViewed.filter(i => i.id !== item.id);

      // Add to beginning
      State.recentlyViewed.unshift(item);

      // Keep only last 10 items
      if (State.recentlyViewed.length > 10) {
        State.recentlyViewed = State.recentlyViewed.slice(0, 10);
      }

      persist();
    }

    function renderSimilarItems(currentItem, filter = 'all') {
      // Update current item preview
      const preview = $('#currentItemPreview');
      const discount = currentItem.originalPrice && currentItem.originalPrice > currentItem.price;
      const discountPercent = discount ? Math.round((1 - currentItem.price / currentItem.originalPrice) * 100) : 0;

      preview.innerHTML = `
        <div class="flex items-center gap-4">
          <div class="relative">
            <img src="${currentItem.image}" class="w-20 h-20 object-cover rounded-xl" />
            ${discount ? `<div class="absolute -top-1 -right-1 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full">-${discountPercent}%</div>` : ''}
          </div>
          <div class="flex-1">
            <h4 class="font-bold text-lg">${currentItem.name}</h4>
            <div class="flex items-center gap-2 mt-1">
              <img src="${currentItem.seller.avatar}" class="w-5 h-5 rounded-full" />
              <span class="text-sm text-gray-600 dark:text-gray-400">${currentItem.seller.name}</span>
            </div>
            <div class="flex items-center gap-2 mt-2">
              <span class="text-xl font-bold text-primary">$${currentItem.price}</span>
              ${discount ? `<span class="text-sm text-gray-400 line-through">$${currentItem.originalPrice}</span>` : ''}
            </div>
          </div>
          <button class="px-4 py-2 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-colors" onclick="addToCart('${currentItem.id}')">
            <i class="fa-solid fa-cart-plus mr-2"></i>Add to Cart
          </button>
        </div>
      `;

      // Get similar items based on filter
      let similarItems = getSimilarItems(currentItem, filter);

      // Render similar items grid
      const grid = $('#similarItemsGrid');
      grid.innerHTML = similarItems.map(item => storeCardHTML(item)).join('');

      // Render recently viewed
      renderRecentlyViewed();

      // Render recommended items
      renderRecommendedItems(currentItem);
    }

    function getSimilarItems(currentItem, filter) {
      let items = State.storeItems.filter(item => item.id !== currentItem.id);

      switch(filter) {
        case 'category':
          items = items.filter(item => item.category === currentItem.category);
          break;
        case 'price':
          const priceRange = currentItem.price * 0.3; // 30% price range
          items = items.filter(item =>
            Math.abs(item.price - currentItem.price) <= priceRange
          );
          break;
        case 'seller':
          items = items.filter(item => item.seller.id === currentItem.seller.id);
          break;
        case 'trending':
          // Sort by some trending criteria (for demo, just shuffle)
          items = items.sort(() => Math.random() - 0.5);
          break;
        case 'all':
        default:
          // Mix of category and price similarity
          const categoryItems = items.filter(item => item.category === currentItem.category);
          const priceItems = items.filter(item =>
            Math.abs(item.price - currentItem.price) <= currentItem.price * 0.5
          );
          items = [...new Set([...categoryItems, ...priceItems])];
          break;
      }

      // Limit to 6 items and shuffle
      return items.sort(() => Math.random() - 0.5).slice(0, 6);
    }

    function renderRecentlyViewed() {
      const grid = $('#recentlyViewedGrid');
      const recentItems = State.recentlyViewed.slice(0, 4); // Show last 4

      if (recentItems.length === 0) {
        grid.innerHTML = '<div class="col-span-2 text-center text-gray-500 py-4">No recently viewed items</div>';
        return;
      }

      grid.innerHTML = recentItems.map(item => storeCardHTML(item)).join('');
    }

    function renderRecommendedItems(currentItem) {
      const grid = $('#recommendedGrid');

      // Get recommended items (mix of category and random)
      const categoryItems = State.storeItems.filter(item =>
        item.category === currentItem.category && item.id !== currentItem.id
      );
      const randomItems = State.storeItems.filter(item => item.id !== currentItem.id);

      const recommended = [...categoryItems, ...randomItems]
        .sort(() => Math.random() - 0.5)
        .slice(0, 4);

      grid.innerHTML = recommended.map(item => storeCardHTML(item)).join('');
    }

    function goBackFromSimilar() {
      UI.closeSheet('sheetSimilarItems');
      UI.openSheet('sheetStore');
    }

    function addToCart(itemId) {
      const item = State.storeItems.find(i => i.id === itemId);
      if (!item) return;

      // Check if item already in cart
      const existingItem = State.cart.find(c => c.id === itemId);
      if (existingItem) {
        existingItem.quantity += 1;
        UI.toast(`Added another ${item.name} to cart`);
      } else {
        State.cart.push({
          id: itemId,
          name: item.name,
          price: item.price,
          image: item.image,
          seller: item.seller,
          quantity: 1
        });
        UI.toast(`${item.name} added to cart`);
      }

      persist();
      updateCartBadge();
    }

    // STORY CREATION FUNCTIONS
    function openCreateStory() {
      UI.openSheet('sheetCreateStory');
      resetStoryCreator();
    }

    function resetStoryCreator() {
      $('#storyImage').classList.add('hidden');
      $('#storyVideo').classList.add('hidden');
      $('#storyPlaceholder').classList.remove('hidden');
      $('#storyText').textContent = '';
      $('#btnPublishStory').disabled = true;
      State.temp.currentStory = {
        type: null,
        content: null,
        text: '',
        template: null
      };
    }

    function selectStoryMedia(type) {
      const story = State.temp.currentStory;
      story.type = type;

      switch(type) {
        case 'camera':
          // Simulate camera capture
          story.content = Images[Math.floor(Math.random() * Images.length)];
          showStoryPreview(story.content, 'image');
          break;
        case 'gallery':
          // Simulate gallery selection
          story.content = Images[Math.floor(Math.random() * Images.length)];
          showStoryPreview(story.content, 'image');
          break;
        case 'video':
          // Simulate video selection
          story.content = 'https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4';
          showStoryPreview(story.content, 'video');
          break;
        case 'text':
          // Text-only story
          story.content = null;
          showTextStoryCreator();
          break;
      }

      $('#btnPublishStory').disabled = false;
    }

    function showStoryPreview(content, mediaType) {
      $('#storyPlaceholder').classList.add('hidden');

      if (mediaType === 'image') {
        $('#storyImage').src = content;
        $('#storyImage').classList.remove('hidden');
        $('#storyVideo').classList.add('hidden');
      } else if (mediaType === 'video') {
        $('#storyVideo').src = content;
        $('#storyVideo').classList.remove('hidden');
        $('#storyImage').classList.add('hidden');
      }
    }

    function showTextStoryCreator() {
      $('#storyPlaceholder').classList.add('hidden');
      const text = prompt('Enter your story text:');
      if (text) {
        $('#storyText').textContent = text;
        State.temp.currentStory.text = text;
      }
    }

    function useStoryTemplate(template) {
      const story = State.temp.currentStory;
      story.template = template;

      const templates = {
        ootd: {
          text: "Today's OOTD ‚ú®",
          background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)'
        },
        mood: {
          text: "Current mood üí´",
          background: 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'
        },
        study: {
          text: "Study vibes üìö",
          background: 'linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)'
        },
        event: {
          text: "At this amazing event! üéâ",
          background: 'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)'
        }
      };

      const template_data = templates[template];
      if (template_data) {
        $('#storyPreview').style.background = template_data.background;
        $('#storyText').textContent = template_data.text;
        $('#storyPlaceholder').classList.add('hidden');
        story.text = template_data.text;
        story.type = 'template';
        story.content = template_data.background;
        $('#btnPublishStory').disabled = false;
      }
    }

    function publishStory() {
      const story = State.temp.currentStory;
      if (!story.type) {
        UI.toast('Please add content to your story', 'error');
        return;
      }

      const newStory = {
        id: 'story_' + Date.now(),
        user: State.currentUser,
        type: story.type,
        content: story.content,
        text: story.text || '',
        template: story.template,
        timestamp: Date.now(),
        views: 0,
        allowReplies: $('#storyAllowReplies').checked,
        addToHighlights: $('#storyAddHighlights').checked
      };

      State.stories.unshift(newStory);
      persist();
      renderStories();

      UI.closeSheet('sheetCreateStory');
      UI.toast('Story published! üéâ');
    }

    // AVATAR CHANGE FUNCTIONS
    const PresetAvatars = [
      'https://i.imgur.com/jL1aT9i.jpg',
      'https://i.imgur.com/8qhbqxM.jpg',
      'https://i.imgur.com/9L2OxQK.jpg',
      'https://i.imgur.com/kL3mN4o.jpg',
      'https://i.imgur.com/pQ7rS8t.jpg',
      'https://i.imgur.com/vW9xY2z.jpg',
      'https://i.imgur.com/aB5cD6e.jpg',
      'https://i.imgur.com/fG8hI9j.jpg',
      'https://i.imgur.com/kL4mN7p.jpg',
      'https://i.imgur.com/qR6sT9u.jpg',
      'https://i.imgur.com/wX0yZ3v.jpg',
      'https://i.imgur.com/bC7dE8f.jpg'
    ];

    function openChangeAvatar() {
      // Set current avatar in preview
      $('#currentAvatarPreview').src = State.currentUser.avatar;
      $('#newAvatarPreview').src = State.currentUser.avatar;

      // Reset state
      State.temp.newAvatar = {
        src: State.currentUser.avatar,
        style: 'original',
        border: 'none'
      };

      // Render preset avatars
      renderPresetAvatars();

      // Open sheet
      UI.openSheet('sheetChangeAvatar');
    }

    function renderPresetAvatars() {
      const container = $('#presetAvatars');
      container.innerHTML = PresetAvatars.map(avatar => `
        <button class="preset-avatar w-16 h-16 rounded-full overflow-hidden border-2 border-gray-200 dark:border-slate-700 hover:border-primary transition-colors" onclick="selectPresetAvatar('${avatar}')">
          <img src="${avatar}" class="w-full h-full object-cover" />
        </button>
      `).join('');
    }

    function selectAvatarSource(source) {
      switch(source) {
        case 'camera':
          // Simulate camera capture
          const randomAvatar = PresetAvatars[Math.floor(Math.random() * PresetAvatars.length)];
          updateAvatarPreview(randomAvatar);
          UI.toast('Photo captured! üì∏');
          break;
        case 'gallery':
          // Simulate gallery selection
          const galleryAvatar = PresetAvatars[Math.floor(Math.random() * PresetAvatars.length)];
          updateAvatarPreview(galleryAvatar);
          UI.toast('Photo selected from gallery üñºÔ∏è');
          break;
      }
    }

    function selectPresetAvatar(avatarSrc) {
      updateAvatarPreview(avatarSrc);

      // Update preset avatar selection visual feedback
      $$('.preset-avatar').forEach(btn => {
        btn.classList.remove('border-primary');
        btn.classList.add('border-gray-200', 'dark:border-slate-700');
      });

      event.target.closest('.preset-avatar').classList.remove('border-gray-200', 'dark:border-slate-700');
      event.target.closest('.preset-avatar').classList.add('border-primary');
    }

    function updateAvatarPreview(avatarSrc) {
      State.temp.newAvatar.src = avatarSrc;
      $('#newAvatarPreview').src = avatarSrc;
      applyAvatarStyle();
      $('#btnSaveAvatar').disabled = false;
    }

    function applyAvatarStyle() {
      const preview = $('#newAvatarPreview');
      const borderPreview = $('#avatarBorderPreview');
      const { style, border } = State.temp.newAvatar;

      // Reset classes
      preview.className = 'w-24 h-24 object-cover transition-all duration-300';
      borderPreview.className = 'absolute inset-0 pointer-events-none';

      // Apply style
      switch(style) {
        case 'circle':
          preview.classList.add('rounded-full');
          borderPreview.classList.add('rounded-full');
          break;
        case 'square':
          preview.classList.add('rounded-none');
          borderPreview.classList.add('rounded-none');
          break;
        case 'rounded':
          preview.classList.add('rounded-2xl');
          borderPreview.classList.add('rounded-2xl');
          break;
        default: // original
          preview.classList.add('rounded-full');
          borderPreview.classList.add('rounded-full');
          break;
      }

      // Apply border
      switch(border) {
        case 'simple':
          borderPreview.style.border = '3px solid #6366f1';
          borderPreview.style.boxShadow = 'none';
          borderPreview.style.background = 'none';
          break;
        case 'gradient':
          borderPreview.style.border = '3px solid #6366f1';
          borderPreview.style.boxShadow = '0 0 0 2px #8b5cf6, 0 0 0 4px #ec4899';
          break;
        case 'glow':
          borderPreview.style.border = '2px solid #6366f1';
          borderPreview.style.boxShadow = '0 0 20px rgba(99, 102, 241, 0.5)';
          borderPreview.style.background = 'none';
          break;
        default: // none
          borderPreview.style.border = 'none';
          borderPreview.style.boxShadow = 'none';
          borderPreview.style.background = 'none';
          break;
      }
    }

    function saveAvatar() {
      if (!State.temp.newAvatar || !State.temp.newAvatar.src) {
        UI.toast('Please select an avatar first', 'error');
        return;
      }

      // Update user avatar
      State.currentUser.avatar = State.temp.newAvatar.src;

      // Update avatar throughout the app
      $('#pfAvatar').src = State.currentUser.avatar;

      // Update in stories if user has stories
      State.stories.forEach(story => {
        if (story.user.id === State.currentUser.id) {
          story.user.avatar = State.currentUser.avatar;
        }
      });

      // Update in posts if user has posts
      State.posts.forEach(post => {
        if (post.user.id === State.currentUser.id) {
          post.user.avatar = State.currentUser.avatar;
        }
      });

      persist();
      renderStories(); // Re-render stories with new avatar
      renderFeed(); // Re-render feed with new avatar

      UI.closeSheet('sheetChangeAvatar');
      UI.toast('Avatar updated successfully! ‚ú®');
    }

    function openStory(userId) {
      const userStories = State.stories.filter(s => s.user.id === userId);
      if (userStories.length === 0) {
        UI.toast('No stories available', 'info');
        return;
      }

      // For now, just show a toast. You can implement a full story viewer later
      const user = userId === State.currentUser.id ? 'your' : userStories[0].user.name + "'s";
      UI.toast(`Viewing ${user} story`, 'info');

      // Increment view count
      userStories.forEach(story => story.views++);
      persist();
    }

    function renderNotifications() {
      const wrap = $('#notifList');
      wrap.innerHTML = State.notifications.map(n => `
        <div class="p-3 bg-white dark:bg-slate-900 rounded-xl flex items-center gap-3">
          <div class="w-8 h-8 rounded-full bg-primary/10 dark:bg-dark-primary/20 text-primary dark:text-dark-primary flex items-center justify-center">
            <i class="fa-solid fa-bell"></i>
          </div>
          <div class="text-sm flex-1">${n.text}</div>
          <div class="text-[10px] text-gray-500">${n.time}</div>
        </div>
      `).join('');
      $('#notifDot').classList.toggle('hidden', State.notifications.length === 0);
    }

    function renderAll() {
      // Stories, featured, teasers, feed
      renderStories();
      renderFeatured();
      renderStoreTeaser();
      renderTopPosts();
      renderFeed();
      renderEvents('all');
      renderProfile();
      renderInbox();
      renderNotifications();
      updateCartBadge();
      buildSearchIndex();
      updateSubscriptionStatus();
      updateRankings();
      initializeDarkMode();
      initializeTheme();
      bindSearchEvents();

      // Reset posts to show new media types (remove this line in production)
      resetPosts();
    }

    // INTERACTIONS
    function switchTab(tab) {
      State.currentTab = tab;
      persist();
      UI.setTitle(tab);
      ['home', 'faculties', 'create', 'events', 'profile'].forEach(t => $('#page-' + t).classList.toggle('hidden', t !== tab));
      $$('.tab-link').forEach(b => {
        const active = b.dataset.tab === tab;
        b.classList.toggle('text-primary', active);
        b.classList.toggle('text-gray-500', !active);
      });
      if (tab === 'faculties') renderFaculties('all');
      if (tab === 'events') renderEvents('all');
      if (tab === 'profile') renderProfile();
      if (tab === 'home') renderAll();
    }

    // FLOATING BUTTONS
    function openStore() {
      if (!State.storeItems || State.storeItems.length === 0) seedIfNeeded();
      renderStore('all');
      UI.openSheet('sheetStore');
    }

    function openConnections() {
      if (!State.connections || State.connections.length === 0) seedIfNeeded();
      renderConnections('all');
      UI.openSheet('sheetConnections');
    }

    function openMessages() {
      if (!State.chats || State.chats.length === 0) seedIfNeeded();
      renderChats();
      UI.openSheet('sheetInbox');
    }

    // STORE FUNCTIONS
    function storeCardHTML(item) {
      const discount = item.originalPrice && item.originalPrice > item.price;
      const discountPercent = discount ? Math.round((1 - item.price / item.originalPrice) * 100) : 0;

      return `
        <div class="bg-white dark:bg-dark-card rounded-2xl overflow-hidden shadow-sm">
          <div class="relative">
            <img src="${item.image}" class="w-full h-40 object-cover cursor-pointer" onclick="viewItemDetails('${item.id}')" />
            ${discount ? `<div class="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full">-${discountPercent}%</div>` : ''}
            <button class="absolute top-2 right-2 w-8 h-8 rounded-full bg-white/80 backdrop-blur flex items-center justify-center hover:bg-white transition-colors" data-add-cart="${item.id}">
              <i class="fa-solid fa-cart-plus text-primary"></i>
            </button>
          </div>
          <div class="p-3">
            <h4 class="font-semibold text-sm line-clamp-2 cursor-pointer hover:text-primary transition-colors" onclick="viewItemDetails('${item.id}')">${item.name}</h4>
            <div class="flex items-center gap-1 mt-1">
              <img src="${item.seller.avatar}" class="w-4 h-4 rounded-full" />
              <span class="text-xs text-gray-500">${item.seller.name}</span>
            </div>
            <div class="flex items-center justify-between mt-2">
              <div class="flex items-center gap-2">
                <span class="text-lg font-bold text-primary dark:text-dark-primary">$${item.price}</span>
                ${discount ? `<span class="text-sm text-gray-400 line-through">$${item.originalPrice}</span>` : ''}
              </div>
              <div class="flex gap-1">
                <button class="px-2 py-1 bg-gray-100 dark:bg-slate-800 text-gray-600 dark:text-gray-400 rounded-lg text-xs font-medium hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors" onclick="showSimilarItems('${item.id}')">
                  <i class="fa-solid fa-layer-group mr-1"></i>Similar
                </button>
                <button class="px-3 py-1 bg-primary text-white rounded-lg text-xs font-medium hover:bg-primary/90 transition-colors" onclick="viewItemDetails('${item.id}')">View</button>
              </div>
            </div>
          </div>
        </div>`;
    }

    function renderStore(filter = 'all') {
      const grid = $('#storeGrid');
      let items = State.storeItems;
      if (filter !== 'all') {
        items = State.storeItems.filter(item => item.category === filter || item.tags.includes(filter));
      }
      grid.innerHTML = items.map(item => storeCardHTML(item)).join('');
      bindStoreCards(grid);
    }

    function bindStoreCards(container) {
      // Bind add to cart buttons
      container.querySelectorAll('[data-add-cart]').forEach(btn => {
        btn.onclick = (e) => {
          e.stopPropagation();
          addToCart(btn.dataset.addCart);
        };
      });
    }

    // CHAT FUNCTIONS
    function renderChats() {
      const list = $('#chatList');
      list.innerHTML = State.chats.map(chat => `
        <button class="w-full p-4 text-left hover:bg-gray-50 dark:hover:bg-slate-800 transition" data-open-chat="${chat.id}">
          <div class="flex items-center gap-3">
            <div class="relative">
              <img src="${chat.user.avatar}" class="w-12 h-12 rounded-full object-cover" />
              <div class="absolute bottom-0 right-0 w-3 h-3 rounded-full ${chat.status === 'online' ? 'bg-green-500' : 'bg-gray-400'} border-2 border-white dark:border-dark-card"></div>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <div class="font-semibold text-sm">${chat.user.name}</div>
                <div class="text-xs text-gray-500">${chat.messages.at(-1)?.time || ''}</div>
              </div>
              <div class="text-xs text-gray-600 dark:text-gray-400 line-clamp-1">${chat.messages.at(-1)?.text || ''}</div>
            </div>
            ${chat.unread ? `<span class="ml-2 text-[10px] bg-primary text-white rounded-full px-1.5">${chat.unread}</span>` : ''}
          </div>
        </button>
      `).join('');
      $$('[data-open-chat]').forEach(b => b.onclick = () => openChat(b.getAttribute('data-open-chat')));
    }

    function openChat(chatId) {
      const chat = State.chats.find(c => c.id === chatId);
      if (!chat) return;

      State.temp.activeChatId = chatId;
      $('#chatAvatar').src = chat.user.avatar;
      $('#chatName').textContent = chat.user.name;
      $('#chatStatus').textContent = chat.status === 'online' ? 'Online' : 'Offline';

      // Render messages
      const msgs = $('#chatMsgs');
      msgs.innerHTML = chat.messages.map(msg => `
        <div class="flex ${msg.me ? 'justify-end' : 'justify-start'}">
          <div class="max-w-xs px-3 py-2 rounded-2xl ${msg.me ? 'bg-primary text-white' : 'bg-gray-100 dark:bg-slate-800'}">
            <div class="text-sm">${msg.text}</div>
            <div class="text-xs opacity-70 mt-1">${msg.time}</div>
          </div>
        </div>
      `).join('');

      // Mark as read
      chat.unread = 0;
      persist();

      UI.closeSheet('sheetInbox');
      UI.openSheet('sheetChat');
    }

    function toggleLike(id, btnEl) {
      const p = State.posts.find(x => x.id === id);
      if (!p) return;
      const liked = State.likes.has(id);
      if (liked) {
        State.likes.delete(id);
        p.likes = Math.max(0, p.likes - 1);
      } else {
        State.likes.add(id);
        p.likes += 1;
        // Add score for premium users when they get likes on their posts
        if (p.user.id === State.currentUser.id) {
          updateUserScore('like');
        }
      }
      persist();
      // update button
      const i = btnEl.querySelector('i');
      const span = btnEl.querySelector('span');
      i.className = (liked ? 'fa-regular' : 'fa-solid') + ' fa-heart';
      btnEl.classList.toggle('text-red-500', !liked);
      btnEl.classList.toggle('text-gray-600', liked);
      span.textContent = p.likes;
      UI.toast(liked ? 'Like removed' : 'Post liked ‚ù§Ô∏è', 'success');
    }

    function toggleSave(id, btnEl) {
      const saved = State.bookmarks.has(id);
      if (saved) State.bookmarks.delete(id);
      else State.bookmarks.add(id);
      persist();
      const i = btnEl.querySelector('i');
      i.className = (saved ? 'fa-regular' : 'fa-solid') + ' fa-bookmark';
      btnEl.classList.toggle('text-yellow-500', !saved);
      btnEl.classList.toggle('text-gray-600', saved);
      UI.toast(saved ? 'Bookmark removed' : 'Saved üìå', 'success');
    }

    function openComments(postId) {
      State.temp.activePostId = postId;
      const list = $('#commentsBody');
      const arr = State.comments[postId] || [];
      list.innerHTML = arr.map(c => `
        <div class="flex items-start gap-2">
          <img src="${c.user.avatar}" class="w-8 h-8 rounded-full object-cover" />
          <div class="bg-gray-100 dark:bg-slate-800 rounded-2xl px-3 py-2">
            <div class="text-xs"><span class="font-semibold">${c.user.name}</span> <span class="text-gray-400">‚Ä¢ ${c.time}</span></div>
            <div class="text-sm">${c.text}</div>
          </div>
        </div>`).join('') || '<div class="text-sm text-gray-500">No comments yet. Be the first!</div>';
      $('#commentInput').value = '';
      UI.openSheet('sheetComments');
    }

    function addComment() {
      const postId = State.temp.activePostId;
      if (!postId) return;
      const text = $('#commentInput').value.trim();
      if (!text) return;
      const arr = State.comments[postId] ||= [];
      arr.push({ user: State.currentUser, text, time: 'now' });
      $('#commentInput').value = '';
      // Update UI
      openComments(postId);
      const p = State.posts.find(x => x.id === postId);
      if (p) { p.comments += 1; renderFeed(); }
      persist();
    }

    async function sharePost(postId) {
      const url = location.origin + location.pathname + '#post/' + postId;
      try {
        if (navigator.share) {
          await navigator.share({ title: 'Raved Post', text: 'Check out this fashion post on Raved!', url });
        } else if (navigator.clipboard) {
          await navigator.clipboard.writeText(url);
          UI.toast('Link copied to clipboard');
        } else {
          UI.toast('Share not supported', 'error');
        }
      } catch { UI.toast('Share cancelled', 'error'); }
    }

    function morePostActions(postId) {
      const p = State.posts.find(x => x.id === postId);
      if (!p) return;
      const isFollowing = State.follows.has(p.user.id);
      // reuse search sheet to display action sheet quickly
      const S = $('#searchResults');
      $('#searchInput').value = '';
      S.innerHTML = `
        <div class="space-y-2">
          <button class="w-full p-3 rounded-xl bg-white dark:bg-slate-900 text-left tap-active" id="actFollow">
            <i class="fa-${isFollowing ? 'solid' : 'regular'} fa-user-plus mr-2"></i>${isFollowing ? 'Unfollow' : 'Follow'} ${p.user.name}
          </button>
          <button class="w-full p-3 rounded-xl bg-white dark:bg-slate-900 text-left tap-active" id="actCopy">
            <i class="fa-solid fa-link mr-2"></i>Copy link
          </button>
          <button class="w-full p-3 rounded-xl bg-white dark:bg-slate-900 text-left tap-active text-red-500" id="actReport">
            <i class="fa-solid fa-flag mr-2"></i>Report
          </button>
        </div>`;
      UI.openSheet('sheetSearch');
      $('#actFollow').onclick = () => {
        if (isFollowing) State.follows.delete(p.user.id); else State.follows.add(p.user.id);
        persist(); UI.toast(isFollowing ? 'Unfollowed' : 'Followed');
        UI.closeSheet('sheetSearch');
      };
      $('#actCopy').onclick = () => { sharePost(postId); UI.closeSheet('sheetSearch'); };
      $('#actReport').onclick = () => { UI.toast('Report submitted. Thanks!', 'success'); UI.closeSheet('sheetSearch'); };
    }

    function filterByTag(tag) {
      const feed = $('#feed');
      const filtered = State.posts.filter(p => p.tags.includes(tag));
      feed.innerHTML = filtered.map(p => postCardHTML(p)).join('') || '<div class="text-sm text-gray-500">No posts found for ' + tag + '</div>';
      bindPostInteractions(feed);
    }

    function openPostDetail(postId) {
      const p = State.posts.find(x => x.id === postId);
      if (!p) return;
      State.temp.activePostId = postId;
      $('#postDetail').innerHTML = `
        <div class="p-3 flex items-center gap-3">
          <img src="${p.user.avatar}" class="w-9 h-9 rounded-full object-cover" />
          <div class="flex-1">
            <div class="flex items-center gap-2">
              <div class="font-semibold text-sm">${p.user.name}</div>
              <span class="text-[10px] px-2 py-0.5 rounded-full bg-primary/10 dark:bg-dark-primary/20 text-primary dark:text-dark-primary">${p.user.faculty}</span>
            </div>
            <div class="text-[11px] text-gray-500">${p.time} ago</div>
          </div>
          <button class="text-gray-400" onclick="(function(){UI.closeSheet('sheetPost')})()"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <img src="${p.image}" class="w-full object-cover" style="max-height: 52vh" />
        <div class="p-3">
          ${postActionsHTML(p)}
          <p class="mt-2 text-sm"><span class="font-semibold">${p.user.name}</span> ${p.caption}</p>
          <div class="mt-2 flex flex-wrap gap-2">${p.tags.map(t => `<button class="text-xs text-primary dark:text-dark-primary" data-tag="${t}">${t}</button>`).join('')}</div>
          <div class="mt-3 border-t border-gray-100 dark:border-slate-800 pt-3">
            <div class="text-xs font-semibold mb-2">Comments</div>
            ${(State.comments[postId] || []).map(c => `
              <div class="flex items-start gap-2 mb-2">
                <img src="${c.user.avatar}" class="w-7 h-7 rounded-full" />
                <div class="bg-gray-100 dark:bg-slate-800 rounded-2xl px-3 py-2">
                  <div class="text-xs"><span class="font-semibold">${c.user.name}</span> <span class="text-gray-400">‚Ä¢ ${c.time}</span></div>
                  <div class="text-sm">${c.text}</div>
                </div>
              </div>`).join('') || '<div class="text-xs text-gray-500">No comments yet</div>'}
            <div class="mt-2">
              <button class="text-xs text-primary dark:text-dark-primary" onclick="(function(){UI.closeSheet('sheetPost'); openComments('${postId}')})()">Add a comment</button>
            </div>
          </div>
        </div>`;
      UI.openSheet('sheetPost');
      bindPostInteractions($('#postDetail'));
    }

    // STORE
    function openItemDetail(itemId) {
      const i = State.storeItems.find(x => x.id === itemId);
      if (!i) return;
      State.temp.activeItemId = itemId;
      const sizes = ['XS','S','M','L','XL'];
      const colors = ['Black','Blue','Green','White'];
      const discount = i.originalPrice && i.originalPrice > i.price;
      $('#itemDetail').innerHTML = `
        <img src="${i.image}" class="w-full h-56 object-cover" />
        <div class="p-4">
          <div class="flex items-center justify-between">
            <div class="font-bold text-lg">${i.name}</div>
            <button class="text-gray-400" onclick="(function(){UI.closeSheet('sheetItem')})()"><i class="fa-solid fa-xmark"></i></button>
          </div>
          <div class="text-xs text-gray-500 mt-1 flex items-center gap-1"><img src="${i.seller.avatar}" class="w-4 h-4 rounded-full" />${i.seller.name}</div>
          <div class="mt-2 flex items-center gap-2">
            <div class="text-2xl font-extrabold text-primary dark:text-dark-primary">$${i.price}</div>
            ${discount ? `<div class="text-gray-400 line-through">$${i.originalPrice}</div>` : ''}
          </div>
          <div class="mt-3">
            <div class="text-xs font-semibold mb-1">Size</div>
            <div id="optSize" class="flex flex-wrap gap-2">
              ${sizes.map(s => `<button class="px-3 py-1 rounded-lg border border-gray-200 dark:border-slate-700" data-size="${s}">${s}</button>`).join('')}
            </div>
          </div>
          <div class="mt-3">
            <div class="text-xs font-semibold mb-1">Color</div>
            <div id="optColor" class="flex flex-wrap gap-2">
              ${colors.map(c => `<button class="px-3 py-1 rounded-lg border border-gray-200 dark:border-slate-700" data-color="${c}">${c}</button>`).join('')}
            </div>
          </div>
          <div class="mt-4 grid grid-cols-2 gap-3">
            <button class="bg-primary text-white rounded-xl py-3 font-semibold tap-active" id="btnAddCartDetail"><i class="fa-solid fa-cart-plus mr-2"></i>Add to Cart</button>
            <button class="bg-accent text-white rounded-xl py-3 font-semibold tap-active" id="btnBuyNow"><i class="fa-solid fa-bolt mr-2"></i>Buy Now</button>
          </div>
        </div>`;
      UI.openSheet('sheetItem');

      // Selectors
      let selSize = 'M', selColor = 'Black';
      $('#optSize').addEventListener('click', (e) => {
        const b = e.target.closest('[data-size]'); if (!b) return;
        selSize = b.dataset.size;
        $$('#optSize [data-size]').forEach(x => x.classList.remove('border-primary', 'text-primary', 'dark:text-dark-primary'));
        b.classList.add('border-primary', 'text-primary', 'dark:text-dark-primary');
      });
      $('#optColor').addEventListener('click', (e) => {
        const b = e.target.closest('[data-color]'); if (!b) return;
        selColor = b.dataset.color;
        $$('#optColor [data-color]').forEach(x => x.classList.remove('border-primary', 'text-primary', 'dark:text-dark-primary'));
        b.classList.add('border-primary', 'text-primary', 'dark:text-dark-primary');
      });

      $('#btnAddCartDetail').onclick = () => addToCart(itemId, selSize, selColor, true);
      $('#btnBuyNow').onclick = () => { addToCart(itemId, selSize, selColor, true); UI.closeSheet('sheetItem'); openCart(); };
    }

    function addToCart(itemId, size = 'M', color = 'Black', toast = false) {
      const item = State.storeItems.find(x => x.id === itemId);
      if (!item) return;
      const key = itemId + '|' + size + '|' + color;
      const existing = State.cart.find(x => x.key === key);
      if (existing) existing.qty += 1;
      else State.cart.push({ key, itemId, name: item.name, price: item.price, image: item.image, size, color, qty: 1 });
      persist();
      updateCartBadge();
      if (toast) UI.toast(item.name + ' added to cart üõí');
    }

    function updateCartBadge() {
      const qty = State.cart.reduce((s, c) => s + c.qty, 0);
      const badge = $('#cartBadge');
      const badgeQA = $('#cartBadgeQA');
      const storeBadge = $('#storeCartBadge');

      if (qty > 0) {
        if (badge) {
          badge.textContent = qty;
          badge.classList.remove('hidden');
        }
        if (badgeQA) {
          badgeQA.textContent = qty;
          badgeQA.classList.remove('hidden');
        }
        if (storeBadge) {
          storeBadge.textContent = qty;
          storeBadge.classList.remove('hidden');
        }
      } else {
        if (badge) badge.classList.add('hidden');
        if (badgeQA) badgeQA.classList.add('hidden');
        if (storeBadge) storeBadge.classList.add('hidden');
      }
    }

    function openCart() {
      const list = $('#cartList');
      if (State.cart.length === 0) {
        list.innerHTML = `<div class="text-center text-sm text-gray-500 py-8">
          <i class="fa-solid fa-cart-shopping text-3xl text-gray-300 dark:text-slate-700 mb-3"></i><div>Your cart is empty</div>
          <button class="mt-3 px-4 py-2 rounded-lg bg-primary text-white tap-active" onclick="(function(){UI.closeSheet('sheetCart'); openStore()})()">Browse Store</button>
        </div>`;
        $('#cartTotal').textContent = '$0.00';
        UI.openSheet('sheetCart');
        return;
      }
      list.innerHTML = State.cart.map(c => `
        <div class="flex items-center gap-3 p-2 bg-gray-50 dark:bg-slate-900 rounded-xl">
          <img src="${c.image}" class="w-12 h-12 rounded object-cover" />
          <div class="flex-1">
            <div class="text-sm font-semibold">${c.name}</div>
            <div class="text-xs text-gray-500">${c.size} ‚Ä¢ ${c.color}</div>
            <div class="text-sm font-extrabold text-primary dark:text-dark-primary">$${c.price}</div>
          </div>
          <div class="flex items-center gap-2">
            <button class="w-7 h-7 rounded-full bg-gray-200 dark:bg-slate-700 tap-active" data-cart-dec="${c.key}"><i class="fa-solid fa-minus text-xs"></i></button>
            <div class="w-6 text-center text-sm">${c.qty}</div>
            <button class="w-7 h-7 rounded-full bg-gray-200 dark:bg-slate-700 tap-active" data-cart-inc="${c.key}"><i class="fa-solid fa-plus text-xs"></i></button>
          </div>
          <button class="text-red-500 tap-active" data-cart-rem="${c.key}"><i class="fa-solid fa-trash"></i></button>
        </div>`).join('');
      const total = State.cart.reduce((s, c) => s + c.price * c.qty, 0);
      $('#cartTotal').textContent = '$' + total.toFixed(2);

      // bind
      $$('[data-cart-dec]').forEach(b => b.onclick = () => updateCartQty(b.dataset.cartDec, -1));
      $$('[data-cart-inc]').forEach(b => b.onclick = () => updateCartQty(b.dataset.cartInc, +1));
      $$('[data-cart-rem]').forEach(b => b.onclick = () => removeCart(b.dataset.cartRem));

      UI.openSheet('sheetCart');
    }

    function updateCartQty(key, delta) {
      const c = State.cart.find(x => x.key === key);
      if (!c) return;
      c.qty += delta;
      if (c.qty <= 0) State.cart = State.cart.filter(x => x.key !== key);
      persist();
      updateCartBadge();
      openCart(); // refresh
    }
    function removeCart(key) {
      State.cart = State.cart.filter(x => x.key !== key);
      persist();
      updateCartBadge();
      openCart();
      UI.toast('Item removed');
    }

    // EVENTS
    function toggleEvent(evId) {
      const e = State.events.find(x => x.id === evId);
      if (!e) return;
      if (!e.attending && e.attendees >= e.max) { UI.toast('Event is full', 'error'); return; }
      e.attending = !e.attending;
      e.attendees += e.attending ? 1 : -1;
      persist();
      renderEvents($('.event-filter.bg-primary')?.dataset.filter || 'all');
      UI.toast(e.attending ? 'Joined event üéâ' : 'Left event');
    }

    function openEventDetail(evId) {
      const e = State.events.find(x => x.id === evId);
      if (!e) return;
      const tags = e.tags?.map(t => `<span class="text-[10px] px-2 py-0.5 rounded-full bg-gray-100 dark:bg-slate-800">${t}</span>`).join(' ') || '';
      $('#eventDetail').innerHTML = `
        <img src="${e.image}" class="w-full h-48 object-cover" />
        <div class="p-4">
          <div class="flex items-center justify-between">
            <div class="font-bold text-lg">${e.title}</div>
            <button class="text-gray-400" onclick="(function(){UI.closeSheet('sheetEvent')})()"><i class="fa-solid fa-xmark"></i></button>
          </div>
          <div class="text-xs text-gray-500 mt-1 flex items-center gap-2">
            <img src="${e.orgAvatar}" class="w-5 h-5 rounded-full" /> by ${e.organizer}
          </div>
          <div class="mt-2 text-sm text-gray-600 dark:text-gray-400"><i class="fa-solid fa-clock mr-1"></i>${e.date} ‚Ä¢ ${e.time}</div>
          <div class="mt-1 text-sm text-gray-600 dark:text-gray-400"><i class="fa-solid fa-location-dot mr-1"></i>${e.location}</div>
          <div class="mt-3 text-sm">${e.description}</div>
          <div class="mt-3 flex gap-2">${tags}</div>
          <div class="mt-4 flex items-center justify-between">
            <div class="text-xs text-gray-600"><i class="fa-solid fa-users mr-1"></i>${e.attendees}/${e.max} attending</div>
            <button class="px-3 py-2 rounded-xl text-sm font-semibold ${e.attending ? 'bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-200' : 'bg-primary text-white'} tap-active" onclick="(function(){toggleEvent('${e.id}')})()">
              ${e.attending ? 'Attending' : 'Join'}
            </button>
          </div>
        </div>`;
      UI.openSheet('sheetEvent');
    }

    // MESSAGES
    function openChat(chatId) {
      const c = State.chats.find(x => x.id === chatId);
      if (!c) return;
      State.temp.activeChatId = chatId;
      $('#chatAvatar').src = c.user.avatar;
      $('#chatName').textContent = c.user.name;
      $('#chatStatus').textContent = c.status === 'online' ? 'Online' : 'Away';
      const wrap = $('#chatMsgs');
      wrap.innerHTML = c.messages.map(m => `
        <div class="flex ${m.me ? 'justify-end' : 'justify-start'}">
          <div class="max-w-[78%] px-3 py-2 rounded-2xl ${m.me ? 'bg-primary text-white' : 'bg-gray-200 dark:bg-slate-800'}">
            <div class="text-sm">${m.text}</div>
            <div class="text-[10px] opacity-70 mt-1">${m.time}</div>
          </div>
        </div>`).join('');
      wrap.scrollTop = wrap.scrollHeight;
      c.unread = 0;
      persist();
      renderInbox();
      UI.openSheet('sheetChat');
    }

    function sendChat() {
      const id = State.temp.activeChatId;
      if (!id) return;
      const c = State.chats.find(x => x.id === id);
      if (!c) return;
      const input = $('#chatInput');
      const text = input.value.trim();
      if (!text) return;
      c.messages.push({ me: true, text, time: 'now' });
      input.value = '';
      persist();
      openChat(id);
      // Simulate reply
      setTimeout(() => {
        c.messages.push({ me: false, text: 'Sounds good! üòä', time: 'now' });
        persist();
        openChat(id);
      }, 900 + Math.random() * 1200);
    }

    // SEARCH
    function buildSearchIndex() {
      State.searchIndex = [
        ...State.posts.map(p => ({ type: 'post', id: p.id, text: `${p.user.name} ${p.caption} ${p.tags.join(' ')}` })),
        ...State.storeItems.map(i => ({ type: 'item', id: i.id, text: `${i.name} ${i.seller.name} ${i.category} ${(i.tags||[]).join(' ')}` })),
        ...Users.map(u => ({ type: 'user', id: u.id, text: `${u.name} ${u.faculty}` })),
      ];
    }
    function openSearch() {
      $('#searchInput').value = '';
      $('#searchResults').innerHTML = '';
      UI.openSheet('sheetSearch');
    }
    function doSearch(q) {
      const res = $('#searchResults');
      const term = q.trim().toLowerCase();
      if (!term) { res.innerHTML = ''; return; }
      const hits = State.searchIndex.filter(x => x.text.toLowerCase().includes(term)).slice(0, 30);
      if (hits.length === 0) { res.innerHTML = '<div class="text-sm text-gray-500 p-2">No results</div>'; return; }
      res.innerHTML = hits.map(h => {
        if (h.type === 'post') {
          const p = State.posts.find(x => x.id === h.id);
          const thumbnailSrc = p.type === 'video' ? p.thumbnail :
                             p.type === 'carousel' ? p.images[0] :
                             p.image;
          return `<button class="w-full p-2 rounded-xl bg-white dark:bg-slate-900 flex items-center gap-3 tap-active" data-open-post="${p.id}">
            <img src="${thumbnailSrc}" class="w-12 h-12 rounded object-cover"/>
            <div class="text-left">
              <div class="text-sm font-semibold line-clamp-1">${p.user.name}</div>
              <div class="text-xs text-gray-500 line-clamp-1">${p.caption}</div>
              ${p.type === 'video' ? '<div class="text-xs text-blue-500">üìπ Video</div>' : ''}
              ${p.type === 'carousel' ? `<div class="text-xs text-purple-500">üñºÔ∏è ${p.images.length} photos</div>` : ''}
            </div>
          </button>`;
        } else if (h.type === 'item') {
          const i = State.storeItems.find(x => x.id === h.id);
          return `<button class="w-full p-2 rounded-xl bg-white dark:bg-slate-900 flex items-center gap-3 tap-active" data-open-item="${i.id}">
            <img src="${i.image}" class="w-12 h-12 rounded object-cover"/>
            <div class="text-left"><div class="text-sm font-semibold line-clamp-1">${i.name}</div><div class="text-xs text-gray-500">$${i.price}</div></div>
          </button>`;
        } else {
          const u = Users.find(x => x.id === h.id);
          return `<button class="w-full p-2 rounded-xl bg-white dark:bg-slate-900 flex items-center gap-3 tap-active" data-view-user="${u.id}">
            <img src="${u.avatar}" class="w-10 h-10 rounded-full object-cover"/>
            <div class="text-left"><div class="text-sm font-semibold">${u.name}</div><div class="text-xs text-gray-500">${u.faculty}</div></div>
          </button>`;
        }
      }).join('');
      bindPostInteractions(res);
      $$('[data-open-item]', res).forEach(b => b.onclick = () => openItemDetail(b.getAttribute('data-open-item')));
      $$('[data-view-user]', res).forEach(b => b.onclick = () => { UI.closeSheet('sheetSearch'); viewProfile(b.getAttribute('data-view-user')); });
    }

    // PROFILE VIEW OTHER USER (simple)
    function viewProfile(userId) {
      const u = Users.find(x => x.id === userId);
      if (!u) return;
      $('#pfAvatar').src = u.avatar;
      $('#pfName').textContent = u.name;
      $('#pfBio').textContent = `${u.faculty} Student`;
      $('#pfCountPosts').textContent = State.posts.filter(p => p.user.id === u.id).length;
      $('#pfCountFollowers').textContent = 100 + Math.floor(Math.random()*500);
      $('#pfCountFollowing').textContent = 50 + Math.floor(Math.random()*250);
      const posts = State.posts.filter(p => p.user.id === u.id);
      $('#pfGrid').innerHTML = posts.map(p => `
        <button class="relative rounded-lg overflow-hidden tap-active" data-open-post="${p.id}">
          <img src="${p.image}" class="w-full h-28 object-cover" />
        </button>`).join('') || '<div class="text-sm text-gray-500">No posts yet</div>';
      bindPostInteractions($('#pfGrid'));
      switchTab('profile');
      UI.toast(`Viewing ${u.name}`);
    }

    // CREATE POST
    function bindCreatePost() {
      const cap = $('#cpCaption'), count = $('#cpCount');
      cap.addEventListener('input', () => {
        count.textContent = cap.value.length;
        count.classList.toggle('text-red-500', cap.value.length > 500);
      });
      const file = $('#cpFile'), preview = $('#cpPreview'), bar = $('#cpPreviewBar'), info = $('#cpFileInfo');
      $('#cpUploadBtn').onclick = () => file.click();
      $('#cpBtnPhoto').onclick = () => file.click();
      $('#cpBtnVideo').onclick = () => file.click();
      $('#cpBtnLoc').onclick = () => $('#cpLocation').focus();
      file.addEventListener('change', () => {
        preview.innerHTML = '';
        const files = [...file.files];
        if (files.length === 0) { preview.classList.add('hidden'); bar.classList.add('hidden'); return; }
        files.forEach(f => {
          const url = URL.createObjectURL(f);
          const el = document.createElement('div');
          el.className = 'relative';
          el.innerHTML = `<img src="${url}" class="w-full h-24 object-cover rounded-lg"/>
            <button class="absolute top-1 right-1 w-6 h-6 rounded-full bg-red-500 text-white flex items-center justify-center"><i class="fa-solid fa-xmark text-xs"></i></button>`;
          el.querySelector('button').onclick = () => { el.remove(); if (preview.children.length===0) { preview.classList.add('hidden'); bar.classList.add('hidden'); info.textContent='0 files'; } };
          preview.appendChild(el);
        });
        preview.classList.remove('hidden'); bar.classList.remove('hidden');
        info.textContent = files.length + ' file' + (files.length>1?'s':'');
      });
      $('#cpClear').onclick = () => { preview.innerHTML=''; preview.classList.add('hidden'); bar.classList.add('hidden'); info.textContent='0 files'; file.value=''; };

      // Tags
      $('#cpTags').addEventListener('keydown', (e) => {
        if (e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          const t = e.target.value.trim();
          if (!t) return;
          const chip = document.createElement('button');
          chip.className = 'text-xs px-2 py-1 rounded-full bg-gray-100 dark:bg-slate-800';
          chip.textContent = t.startsWith('#') ? t : '#' + t;
          chip.onclick = () => chip.remove();
          $('#cpTagList').appendChild(chip);
          e.target.value = '';
        }
      });

      // Post
      $('#cpPost').onclick = () => {
        const caption = cap.value.trim();
        const tags = $$('#cpTagList button').map(b => b.textContent);
        const image = Images[Math.floor(Math.random() * Images.length)];
        const location = $('#cpLocation').value.trim();
        const brand = $('#cpBrand').value.trim();
        const occasion = $('#cpOccasion').value;
        const visibility = $('#cpVisibility').value;

        // Marketplace fields
        const isForSale = $('#cpForSale').checked;
        const price = isForSale ? parseFloat($('#cpPrice').value) : null;
        const condition = isForSale ? $('#cpCondition').value : null;
        const size = isForSale ? $('#cpSize').value : null;
        const category = isForSale ? $('#cpCategory').value : null;
        const itemDescription = isForSale ? $('#cpItemDescription').value.trim() : null;

        if (!caption && $('#cpPreview').children.length === 0) {
          UI.toast('Add a caption or media', 'error'); return;
        }

        if (isForSale && (!price || price <= 0)) {
          UI.toast('Please set a valid price for sale items', 'error'); return;
        }

        const id = 'post_' + Date.now();
        const p = {
          id,
          user: State.currentUser,
          image,
          caption,
          tags: tags.length ? tags : ['#CampusStyle'],
          time: 'now',
          likes: 0,
          comments: 0,
          location: location,
          brand: brand,
          occasion: occasion,
          visibility: visibility,
          // Marketplace fields
          isForSale: isForSale,
          price: price,
          condition: condition,
          size: size,
          category: category,
          itemName: isForSale ? (caption.split(' ').slice(0, 3).join(' ') || 'Fashion Item') : null,
          itemDescription: itemDescription
        };

        State.posts.unshift(p);
        State.comments[id] = [];

        // If item is for sale, also add to store
        if (isForSale) {
          const storeItem = {
            id: 'item_from_post_' + Date.now(),
            name: p.itemName,
            description: itemDescription || caption,
            brand: brand,
            category: category || 'clothing',
            size: size,
            condition: condition,
            price: price,
            image: image,
            seller: {
              id: State.currentUser.id,
              name: State.currentUser.name,
              avatar: State.currentUser.avatar,
              faculty: State.currentUser.faculty
            },
            tags: [category || 'clothing'],
            originalPrice: price * 1.2,
            dateAdded: new Date().toISOString(),
            fromPost: id
          };
          State.storeItems.unshift(storeItem);
        }

        persist();

        // Reset form
        cap.value = ''; $('#cpCount').textContent = '0';
        $('#cpPreview').innerHTML = ''; $('#cpPreview').classList.add('hidden'); $('#cpPreviewBar').classList.add('hidden'); $('#cpFile').value='';
        $('#cpTagList').innerHTML = ''; $('#cpLocation').value = ''; $('#cpBrand').value = ''; $('#cpOccasion').value = '';
        $('#cpForSale').checked = false; $('#cpSaleDetails').classList.add('hidden');
        $('#cpPrice').value = ''; $('#cpCondition').value = 'new'; $('#cpSize').value = ''; $('#cpCategory').value = 'clothing'; $('#cpItemDescription').value = '';

        UI.toast(isForSale ? 'Posted and added to store! üõçÔ∏è' : 'Posted! üéâ');
        switchTab('home');
        renderFeed();
      };
    }

    // SEARCH / TAG binds
    function bindSearch() {
      $('#btnOpenSearch').onclick = openSearch;
      $('#searchClear').onclick = () => { $('#searchInput').value = ''; $('#searchResults').innerHTML=''; };
      $('#searchInput').addEventListener('input', (e)=> doSearch(e.target.value));
    }

    // ENHANCED CHECKOUT SYSTEM
    $('#btnCheckout').onclick = () => {
      if (State.cart.length === 0) {
        UI.toast('Cart is empty', 'error');
        return;
      }
      openCheckout();
    };

    function openCheckout() {
      // Populate order summary
      updateCheckoutSummary();

      // Generate order reference
      const orderRef = 'ORDER-' + Date.now().toString().slice(-6);
      $('#transferReference').textContent = orderRef;

      // Reset form
      resetCheckoutForm();

      UI.openSheet('sheetCheckout');
    }

    function updateCheckoutSummary() {
      const checkoutItems = $('#checkoutItems');
      const subtotal = State.cart.reduce((sum, item) => sum + (item.price * item.qty), 0);

      // Render checkout items
      checkoutItems.innerHTML = State.cart.map(item => `
        <div class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-slate-800 rounded-xl">
          <img src="${item.image}" class="w-12 h-12 rounded-lg object-cover" />
          <div class="flex-1">
            <div class="font-semibold text-sm">${item.name}</div>
            <div class="text-xs text-gray-500">Size: ${item.size || 'N/A'} ‚Ä¢ ${item.color || 'Default'}</div>
            <div class="text-xs text-gray-500">Seller: ${item.seller?.name || 'Student Seller'}</div>
          </div>
          <div class="text-right">
            <div class="font-semibold">‚Çµ${item.price.toFixed(2)}</div>
            <div class="text-xs text-gray-500">Qty: ${item.qty}</div>
          </div>
        </div>
      `).join('');

      // Update totals
      $('#checkoutSubtotal').textContent = `‚Çµ${subtotal.toFixed(2)}`;
      $('#checkoutTotal').textContent = `‚Çµ${subtotal.toFixed(2)}`;
    }

    function resetCheckoutForm() {
      // Reset delivery method
      $('input[name="deliveryMethod"][value="campus"]').checked = true;
      $('#deliveryAddress').classList.add('hidden');

      // Reset payment method
      $$('input[name="paymentMethod"]').forEach(input => input.checked = false);
      $('#paymentDetails').classList.add('hidden');
      hideAllPaymentDetails();

      // Reset form fields
      $('#buyerPhone').value = '';
      $('#addressInput').value = '';

      // Disable place order button
      $('#btnPlaceOrder').disabled = true;
    }

    function hideAllPaymentDetails() {
      ['#momoDetails', '#cardDetails', '#bankDetails', '#cashDetails'].forEach(id => {
        $(id).classList.add('hidden');
      });
    }

    // Delivery method change handler
    $$('input[name="deliveryMethod"]').forEach(input => {
      input.onchange = () => {
        const deliveryAddress = $('#deliveryAddress');
        if (input.value === 'hostel') {
          deliveryAddress.classList.remove('hidden');
        } else {
          deliveryAddress.classList.add('hidden');
        }
        updateOrderTotal();
        validateCheckoutForm();
      };
    });

    // Payment method change handler
    $$('input[name="paymentMethod"]').forEach(input => {
      input.onchange = () => {
        const paymentDetails = $('#paymentDetails');
        hideAllPaymentDetails();

        if (input.checked) {
          paymentDetails.classList.remove('hidden');

          // Show relevant payment details
          switch(input.value) {
            case 'momo':
              $('#momoDetails').classList.remove('hidden');
              break;
            case 'card':
              $('#cardDetails').classList.remove('hidden');
              break;
            case 'bank':
              $('#bankDetails').classList.remove('hidden');
              break;
            case 'cash':
              $('#cashDetails').classList.remove('hidden');
              break;
          }

          // Update payment method selection styling
          $$('.payment-method-option').forEach(option => {
            option.classList.remove('border-primary', 'bg-primary/5');
            option.classList.add('border-gray-200', 'dark:border-slate-700');
          });

          input.closest('.payment-method-option').classList.remove('border-gray-200', 'dark:border-slate-700');
          input.closest('.payment-method-option').classList.add('border-primary', 'bg-primary/5');
        } else {
          paymentDetails.classList.add('hidden');
        }

        validateCheckoutForm();
      };
    });

    function updateOrderTotal() {
      const subtotal = State.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const deliveryMethod = $('input[name="deliveryMethod"]:checked').value;
      const deliveryFee = deliveryMethod === 'hostel' ? 5.00 : 0.00;
      const total = subtotal + deliveryFee;

      $('#checkoutTotal').textContent = `$${total.toFixed(2)}`;
    }

    function validateCheckoutForm() {
      const phone = $('#buyerPhone').value.trim();
      const paymentMethod = $('input[name="paymentMethod"]:checked');
      const deliveryMethod = $('input[name="deliveryMethod"]:checked').value;
      const address = $('#addressInput').value.trim();

      let isValid = true;

      // Check required fields
      if (!phone) isValid = false;
      if (!paymentMethod) isValid = false;
      if (deliveryMethod === 'hostel' && !address) isValid = false;

      // Check payment method specific fields
      if (paymentMethod) {
        switch(paymentMethod.value) {
          case 'momo':
            if (!$('#momoPhone').value.trim()) isValid = false;
            break;
          case 'card':
            if (!$('#cardName').value.trim() || !$('#cardNumber').value.trim() ||
                !$('#cardExpiry').value.trim() || !$('#cardCvv').value.trim()) {
              isValid = false;
            }
            break;
        }
      }

      $('#btnPlaceOrder').disabled = !isValid;
    }

    // Form field validation
    ['#buyerPhone', '#addressInput', '#momoPhone', '#cardName', '#cardNumber', '#cardExpiry', '#cardCvv'].forEach(id => {
      const element = $(id);
      if (element) {
        element.oninput = validateCheckoutForm;
      }
    });

    // Place order handler
    $('#btnPlaceOrder').onclick = () => {
      const paymentMethod = $('input[name="paymentMethod"]:checked').value;
      const deliveryMethod = $('input[name="deliveryMethod"]:checked').value;

      // Simulate payment processing
      UI.toast('Processing your order...', 'info');

      setTimeout(() => {
        // Create order
        const order = {
          id: 'order_' + Date.now(),
          items: [...State.cart],
          total: parseFloat($('#checkoutTotal').textContent.replace('$', '')),
          paymentMethod: paymentMethod,
          deliveryMethod: deliveryMethod,
          buyerPhone: $('#buyerPhone').value,
          address: deliveryMethod === 'hostel' ? $('#addressInput').value : null,
          status: 'confirmed',
          orderDate: new Date().toISOString()
        };

        // Add to orders (if we had an orders system)
        if (!State.orders) State.orders = [];
        State.orders.unshift(order);

        // Clear cart
        State.cart = [];
        persist();
        updateCartBadge();

        // Close sheets
        UI.closeSheet('sheetCheckout');
        UI.closeSheet('sheetCart');

        // Success message
        const paymentMethodNames = {
          'momo': 'Mobile Money',
          'card': 'Card',
          'bank': 'Bank Transfer',
          'cash': 'Cash on Delivery'
        };

        UI.toast(`Order placed successfully! Payment via ${paymentMethodNames[paymentMethod]} üéâ`, 'success');

        // Update seller scores for premium users
        order.items.forEach(item => {
          if (item.seller.id !== State.currentUser.id) {
            // Award points to seller for sale (if they're premium)
            updateUserScore('sale');
          }
        });

      }, 2000);
    };

    // STORIES
    function openStory(userId) {
      const u = Users.find(x => x.id === userId);
      if (!u) return;
      const pics = Images.slice(0, 4);
      let idx = 0;
      const render = () => {
        $('#storyBody').innerHTML = `
          <div class="relative">
            <img src="${pics[idx]}" class="w-full h-[70vh] object-cover" />
            <div class="absolute top-3 left-3 right-3 flex gap-1">
              ${pics.map((_,i)=>`<div class="h-1 flex-1 rounded bg-white/40 ${i<=idx?'!bg-white':''}"></div>`).join('')}
            </div>
            <div class="absolute top-4 left-4 flex items-center gap-2 text-white drop-shadow">
              <img src="${u.avatar}" class="w-7 h-7 rounded-full"/><div class="text-sm font-semibold">${u.name}</div>
            </div>
            <button class="absolute top-3 right-3 w-9 h-9 rounded-full bg-black/40 text-white" onclick="(function(){UI.closeSheet('sheetStory'); clearTimeout(State.temp.storyTimer)})()"><i class="fa-solid fa-xmark"></i></button>
          </div>`;
      };
      render();
      const advance = () => {
        clearTimeout(State.temp.storyTimer);
        if (++idx >= pics.length) { UI.closeSheet('sheetStory'); return; }
        render();
        State.temp.storyTimer = setTimeout(advance, 2500);
      };
      State.temp.storyTimer = setTimeout(advance, 2500);
      UI.openSheet('sheetStory');
    }

    // NOTIFICATIONS
    $('#btnOpenNotifications').onclick = () => { renderNotifications(); UI.openSheet('sheetNotif'); };

    // QUICK ACTIONS / MORE
    $('#btnOpenMore').onclick = () => UI.openSheet('sheetMore');
    $('#qaMessages').onclick = () => { UI.closeSheet('sheetMore'); openMessages(); };
    $('#qaConnections').onclick = () => { UI.closeSheet('sheetMore'); openConnections(); };
    $('#qaCart').onclick = () => { UI.closeSheet('sheetMore'); openCart(); };
    $('#qaBookmarks').onclick = () => { UI.closeSheet('sheetMore'); openSearch(); $('#searchInput').value='#'; doSearch('#'); };
    $('#qaFaculty').onclick = () => { UI.closeSheet('sheetMore'); switchTab('faculties'); };
    $('#qaRankings').onclick = () => { UI.closeSheet('sheetMore'); openRankings(); };
    $('#qaSellerDashboard').onclick = () => { UI.closeSheet('sheetMore'); openSellerDashboard(); };
    $('#qaLogout').onclick = () => signOut();

    // SELLER DASHBOARD FUNCTIONS
    function openSellerDashboard() {
      if (!State.subscription.isPremium) {
        UI.toast('Seller dashboard is only available for premium members', 'info');
        openSubscription();
        return;
      }

      updateSellerStats();
      renderSellerItems();
      UI.openSheet('sheetSellerDashboard');
    }

    function updateSellerStats() {
      const myItems = State.storeItems.filter(item => item.seller.id === State.currentUser.id);
      const totalSales = myItems.reduce((sum, item) => sum + (item.sales || 0) * item.price, 0);

      $('#totalItems').textContent = myItems.length;
      $('#totalSales').textContent = `‚Çµ${totalSales.toFixed(2)}`;
    }

    function renderSellerItems() {
      const myItems = State.storeItems.filter(item => item.seller.id === State.currentUser.id);
      const container = $('#sellerItemsList');

      if (myItems.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8">
            <i class="fa-solid fa-box-open text-4xl text-gray-400 mb-3"></i>
            <div class="text-gray-500">No items in your store yet</div>
            <button onclick="openCreateStoreItem()" class="mt-3 px-4 py-2 bg-primary text-white rounded-xl hover:bg-primary-dark transition-colors">
              Add Your First Item
            </button>
          </div>
        `;
        return;
      }

      container.innerHTML = myItems.map(item => `
        <div class="bg-white dark:bg-slate-900 rounded-xl p-4 border border-gray-200 dark:border-slate-700">
          <div class="flex items-center gap-3">
            <img src="${item.image}" class="w-16 h-16 rounded-lg object-cover" />
            <div class="flex-1">
              <div class="font-semibold">${item.name}</div>
              <div class="text-sm text-gray-500">‚Çµ${item.price} ‚Ä¢ ${item.condition}</div>
              <div class="text-xs text-gray-400">${item.sales || 0} sales</div>
            </div>
            <div class="flex flex-col gap-2">
              <button onclick="viewItemInStore('${item.id}')" class="px-3 py-1 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-lg text-sm hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors">
                <i class="fa-solid fa-external-link mr-1"></i>View
              </button>
              <button onclick="editStoreItem('${item.id}')" class="px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 rounded-lg text-sm hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors">
                <i class="fa-solid fa-edit mr-1"></i>Edit
              </button>
              <button onclick="toggleItemDiscount('${item.id}')" class="px-3 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-600 rounded-lg text-sm hover:bg-orange-200 dark:hover:bg-orange-900/50 transition-colors">
                <i class="fa-solid fa-tag mr-1"></i>Discount
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    function editStoreItem(itemId) {
      const item = State.storeItems.find(i => i.id === itemId);
      if (!item) return;

      UI.toast('Item editing feature coming soon!', 'info');
    }

    function toggleItemDiscount(itemId) {
      const item = State.storeItems.find(i => i.id === itemId);
      if (!item) return;

      UI.toast('Discount feature coming soon!', 'info');
    }

    function openCreateStoreItem() {
      UI.closeSheet('sheetSellerDashboard');
      openSellItem();
    }

    function refreshSellerItems() {
      renderSellerItems();
      UI.toast('Items refreshed', 'success');
    }

    function viewItemInStore(itemId) {
      UI.closeSheet('sheetSellerDashboard');
      openProductDetail(itemId);
    }

    function openBulkActions() {
      UI.closeSheet('sheetSellerDashboard');
      openStore();
      UI.toast('Manage your items in the store! üè∑Ô∏è', 'info');
    }

    // SEARCH FUNCTIONALITY
    function bindSearchEvents() {
      const searchInput = $('#searchInput');
      const btnClearSearch = $('#btnClearSearch');

      if (searchInput) {
        searchInput.oninput = e => doSearch(e.target.value);
        searchInput.onkeydown = e => {
          if (e.key === 'Enter') {
            e.preventDefault();
            doSearch(e.target.value);
          }
        };
      }

      if (btnClearSearch) {
        btnClearSearch.onclick = () => {
          if (searchInput) {
            searchInput.value = '';
            doSearch('');
          }
        };
      }
    }

    // STORY CREATION
    $('#btnPublishStory').onclick = publishStory;

    // AVATAR CHANGE
    $('#btnSaveAvatar').onclick = saveAvatar;

    // SUBSCRIPTION
    $('#btnSubscribe').onclick = subscribe;

    // CREATE POST ENHANCEMENTS
    // Popular tags functionality
    $$('.popular-tag').forEach(btn => {
      btn.onclick = () => {
        const tag = btn.dataset.tag;
        const tagsInput = $('#cpTags');
        const currentTags = tagsInput.value;

        if (!currentTags.includes('#' + tag)) {
          tagsInput.value = currentTags ? currentTags + ' #' + tag : '#' + tag;
          updateTagList();
        }
      };
    });

    // Location suggestions (simulated Google-like API)
    const LocationSuggestions = [
      { name: 'Campus Library', type: 'University', distance: '0.1 km' },
      { name: 'Student Union Building', type: 'University', distance: '0.2 km' },
      { name: 'Downtown Shopping Mall', type: 'Shopping', distance: '1.5 km' },
      { name: 'Central Park', type: 'Park', distance: '2.0 km' },
      { name: 'Fashion District', type: 'Shopping', distance: '3.2 km' },
      { name: 'University Bookstore', type: 'University', distance: '0.3 km' },
      { name: 'Coffee House on Main', type: 'Cafe', distance: '0.8 km' },
      { name: 'Vintage Thrift Store', type: 'Shopping', distance: '1.2 km' },
      { name: 'Art Gallery Downtown', type: 'Culture', distance: '2.5 km' },
      { name: 'Campus Gym', type: 'University', distance: '0.4 km' }
    ];

    function showLocationSuggestions(query = '') {
      const suggestions = $('#cpLocationSuggestions');
      const filtered = LocationSuggestions.filter(loc =>
        loc.name.toLowerCase().includes(query.toLowerCase()) ||
        loc.type.toLowerCase().includes(query.toLowerCase())
      ).slice(0, 5);

      if (filtered.length > 0) {
        suggestions.innerHTML = filtered.map(loc => `
          <div class="p-3 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer border-b border-gray-100 dark:border-slate-700 last:border-b-0" onclick="selectLocation('${loc.name}')">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-medium text-sm">${loc.name}</div>
                <div class="text-xs text-gray-500">${loc.type} ‚Ä¢ ${loc.distance}</div>
              </div>
              <i class="fa-solid fa-location-dot text-primary"></i>
            </div>
          </div>
        `).join('');
        suggestions.classList.remove('hidden');
      } else {
        suggestions.classList.add('hidden');
      }
    }

    function selectLocation(locationName) {
      $('#cpLocation').value = locationName;
      $('#cpLocationSuggestions').classList.add('hidden');
    }

    // Location input handlers
    $('#cpLocation').oninput = (e) => {
      const query = e.target.value;
      if (query.length > 0) {
        showLocationSuggestions(query);
      } else {
        $('#cpLocationSuggestions').classList.add('hidden');
      }
    };

    $('#cpLocationToggle').onclick = () => {
      // Simulate getting current location
      const currentLocations = ['Campus Library', 'Student Union Building', 'University Bookstore'];
      const randomLocation = currentLocations[Math.floor(Math.random() * currentLocations.length)];
      $('#cpLocation').value = randomLocation;
      $('#cpLocationSuggestions').classList.add('hidden');
      UI.toast('üìç Current location detected', 'success');
    };

    $('#cpLocationSearch').onclick = () => {
      const query = $('#cpLocation').value;
      if (query) {
        showLocationSuggestions(query);
      }
    };

    // Character count for caption
    $('#cpCaption').oninput = (e) => {
      const count = e.target.value.length;
      $('#cpCount').textContent = count;

      // Enable/disable post button based on content
      const hasContent = count > 0 || $('#cpFile').files.length > 0;
      $('#cpPost').disabled = !hasContent;
    };

    function updateTagList() {
      const tagsInput = $('#cpTags').value;
      const tags = tagsInput.match(/#\w+/g) || [];
      const tagList = $('#cpTagList');

      tagList.innerHTML = tags.map(tag => `
        <span class="inline-flex items-center gap-1 px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-medium">
          ${tag}
          <button onclick="removeTag('${tag}')" class="hover:text-red-500 transition-colors">
            <i class="fa-solid fa-xmark text-xs"></i>
          </button>
        </span>
      `).join('');
    }

    function removeTag(tagToRemove) {
      const tagsInput = $('#cpTags');
      tagsInput.value = tagsInput.value.replace(tagToRemove, '').replace(/\s+/g, ' ').trim();
      updateTagList();
    }

    // Tags input handler
    $('#cpTags').oninput = updateTagList;

    // MARKETPLACE FUNCTIONALITY
    // For Sale toggle
    $('#cpForSale').onchange = (e) => {
      const saleDetails = $('#cpSaleDetails');
      if (e.target.checked) {
        saleDetails.classList.remove('hidden');
      } else {
        saleDetails.classList.add('hidden');
      }
    };

    // Add to Store functionality is now handled by openSellItem() function

    // Store item upload
    $('#storeUploadBtn').onclick = () => $('#storeFile').click();
    $('#storeFile').onchange = (e) => {
      const files = Array.from(e.target.files);
      if (files.length > 0) {
        const preview = $('#storePreview');
        preview.innerHTML = files.map((file, index) => `
          <div class="relative">
            <img src="${URL.createObjectURL(file)}" class="w-full h-24 object-cover rounded-xl" />
            <button onclick="removeStoreImage(${index})" class="absolute top-1 right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs hover:bg-red-600 transition-colors">
              <i class="fa-solid fa-xmark"></i>
            </button>
          </div>
        `).join('');
        preview.classList.remove('hidden');
        $('#btnSaveStoreItem').disabled = false;
      }
    };

    function removeStoreImage(index) {
      // In a real app, you'd remove the file from the files array
      UI.toast('Image removed');
    }

    // Save store item
    $('#btnSaveStoreItem').onclick = () => {
      const name = $('#storeItemName').value.trim();
      const description = $('#storeItemDescription').value.trim();
      const brand = $('#storeItemBrand').value.trim();
      const category = $('#storeItemCategory').value;
      const size = $('#storeItemSize').value;
      const condition = $('#storeItemCondition').value;
      const price = parseFloat($('#storeItemPrice').value);

      if (!name || !price) {
        UI.toast('Please fill in item name and price', 'error');
        return;
      }

      const newItem = {
        id: 'item_' + Date.now(),
        name: name,
        description: description,
        brand: brand,
        category: category,
        size: size,
        condition: condition,
        price: price,
        image: Images[Math.floor(Math.random() * Images.length)], // Random image for demo
        seller: {
          id: State.currentUser.id,
          name: State.currentUser.name,
          avatar: State.currentUser.avatar,
          faculty: State.currentUser.faculty
        },
        tags: [category],
        originalPrice: price * 1.2, // 20% markup for demo
        dateAdded: new Date().toISOString()
      };

      State.storeItems.unshift(newItem);
      persist();
      renderStore();

      UI.closeSheet('sheetAddToStore');
      UI.toast('Item added to store successfully! üõçÔ∏è');

      // Clear form
      $('#storeItemName').value = '';
      $('#storeItemDescription').value = '';
      $('#storeItemBrand').value = '';
      $('#storeItemPrice').value = '';
      $('#storePreview').classList.add('hidden');
      $('#btnSaveStoreItem').disabled = true;
    };

    // Add to cart from post
    function addToCartFromPost(postId) {
      const post = State.posts.find(p => p.id === postId);
      if (!post || !post.isForSale) {
        UI.toast('Item not available for sale', 'error');
        return;
      }

      // Check if item already in cart
      const existingItem = State.cart.find(c => c.postId === postId);
      if (existingItem) {
        existingItem.quantity += 1;
        UI.toast(`Added another ${post.itemName || 'item'} to cart`);
      } else {
        State.cart.push({
          id: 'cart_' + Date.now(),
          postId: postId,
          name: post.itemName || 'Fashion Item',
          price: post.price,
          image: post.image,
          seller: post.user,
          quantity: 1,
          size: post.size,
          condition: post.condition,
          brand: post.brand
        });
        UI.toast(`${post.itemName || 'Item'} added to cart! üõí`);
      }

      persist();
      updateCartBadge();
    }

    // SUBSCRIPTION & PAYMENT SYSTEM
    function openSubscription() {
      updateSubscriptionStatus();
      UI.openSheet('sheetSubscription');
    }

    function openRankings() {
      if (!State.subscription.isPremium) {
        UI.toast('Subscribe to Premium to view rankings', 'info');
        openSubscription();
        return;
      }
      updateRankings();
      UI.openSheet('sheetRankings');
    }

    function updateSubscriptionStatus() {
      const sub = State.subscription;
      const now = Date.now();
      const daysSinceStart = Math.floor((now - sub.trialStartDate) / (1000 * 60 * 60 * 24));
      sub.trialDaysLeft = Math.max(0, 7 - daysSinceStart);

      // Update UI elements
      const trialStatus = $('#trialStatus');
      const subscriptionCard = $('#subscriptionStatusCard');
      const premiumBadge = $('#premiumBadge');
      const rankingsSection = $('#rankingsSection');
      const rankingsCTA = $('#rankingsCTA');
      const premiumThemesSection = $('#premiumThemesSection');
      const premiumActionsSection = $('#premiumActionsSection');
      const freeUserActionsSection = $('#freeUserActionsSection');

      if (sub.isPremium) {
        // Premium user
        if (trialStatus) trialStatus.textContent = 'Premium Active';
        if (subscriptionCard) {
          subscriptionCard.className = 'mt-4 p-3 rounded-xl border-2 border-primary bg-primary/10';
          subscriptionCard.innerHTML = `
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold text-primary">Premium Member</div>
                <div class="text-xs text-primary/70">All features unlocked</div>
              </div>
              <div class="px-3 py-1.5 bg-primary text-white rounded-lg text-xs font-medium">
                <i class="fa-solid fa-crown mr-1"></i>Active
              </div>
            </div>
          `;
        }
        if (premiumBadge) premiumBadge.classList.remove('hidden');
        if (rankingsSection) rankingsSection.classList.remove('hidden');
        if (rankingsCTA) rankingsCTA.classList.add('hidden');
        if (premiumThemesSection) premiumThemesSection.classList.remove('hidden');
        if (premiumActionsSection) premiumActionsSection.classList.remove('hidden');
        if (freeUserActionsSection) freeUserActionsSection.classList.add('hidden');
      } else if (sub.trialDaysLeft > 0) {
        // Trial period
        if (trialStatus) trialStatus.textContent = `${sub.trialDaysLeft} days remaining`;
        if (rankingsSection) rankingsSection.classList.add('hidden');
        if (rankingsCTA) rankingsCTA.classList.remove('hidden');
        if (premiumThemesSection) premiumThemesSection.classList.add('hidden');
        if (premiumActionsSection) premiumActionsSection.classList.add('hidden');
        if (freeUserActionsSection) freeUserActionsSection.classList.remove('hidden');
        if (premiumThemesSection) premiumThemesSection.classList.add('hidden');
      } else {
        // Trial expired
        if (trialStatus) trialStatus.textContent = 'Trial expired';
        if (subscriptionCard) {
          subscriptionCard.className = 'mt-4 p-3 rounded-xl border-2 border-red-300 bg-red-50 dark:bg-red-900/20';
        }
        if (rankingsSection) rankingsSection.classList.add('hidden');
        if (rankingsCTA) rankingsCTA.classList.remove('hidden');
        if (premiumThemesSection) premiumThemesSection.classList.add('hidden');
        if (premiumActionsSection) premiumActionsSection.classList.add('hidden');
        if (freeUserActionsSection) freeUserActionsSection.classList.remove('hidden');
      }
    }

    function selectPaymentMethod(method) {
      // Remove active state from all payment methods
      $$('.payment-method').forEach(btn => {
        btn.classList.remove('border-primary', 'bg-primary/5');
        btn.classList.add('border-gray-200', 'dark:border-slate-700');
      });

      // Add active state to selected method
      event.target.closest('.payment-method').classList.remove('border-gray-200', 'dark:border-slate-700');
      event.target.closest('.payment-method').classList.add('border-primary', 'bg-primary/5');

      State.temp.selectedPaymentMethod = method;
    }

    function subscribe() {
      const paymentMethod = State.temp.selectedPaymentMethod;
      if (!paymentMethod) {
        UI.toast('Please select a payment method', 'error');
        return;
      }

      // Simulate payment process
      UI.toast('Processing payment...', 'info');

      setTimeout(() => {
        // Activate premium subscription
        State.subscription.isPremium = true;
        State.subscription.subscriptionEndDate = Date.now() + (7 * 24 * 60 * 60 * 1000); // 1 week
        State.subscription.paymentMethod = paymentMethod;

        persist();
        updateSubscriptionStatus();

        UI.closeSheet('sheetSubscription');
        UI.toast('Welcome to Raved Premium! üéâ', 'success');

        // Show rankings if not visible
        const rankingsSection = $('#rankingsSection');
        if (rankingsSection) rankingsSection.classList.remove('hidden');
      }, 2000);
    }

    // RANKING SYSTEM
    function updateUserScore(action, points = 0) {
      if (!State.subscription.isPremium) return; // Only premium users get points

      const stats = State.userStats;

      switch(action) {
        case 'like':
          stats.totalLikes++;
          points = 10;
          break;
        case 'comment':
          stats.totalComments++;
          points = 15;
          break;
        case 'share':
          stats.totalShares++;
          points = 20;
          break;
        case 'sale':
          stats.totalSales++;
          points = 50;
          break;
        case 'feature':
          points = 100;
          break;
      }

      stats.weeklyScore += points;
      stats.monthlyScore += points;
      stats.allTimeScore += points;

      persist();
    }

    function updateRankings() {
      // Generate demo rankings data
      const demoUsers = [
        { id: 'u1', name: 'Alex Johnson', avatar: Users[0].avatar, score: State.userStats.weeklyScore || 3120 },
        { id: 'u2', name: 'Sarah Miller', avatar: Users[1].avatar, score: 2340 },
        { id: 'u3', name: 'Mike Rodriguez', avatar: Users[2].avatar, score: 1890 },
        { id: 'u4', name: 'Emma Davis', avatar: Users[3].avatar, score: 1650 },
        { id: 'u5', name: 'James Wilson', avatar: Users[4].avatar, score: 1420 }
      ].sort((a, b) => b.score - a.score);

      State.rankings = demoUsers;

      // Update rankings teaser on home page
      const rankingsTeaser = $('#rankingsTeaser');
      if (rankingsTeaser) {
        rankingsTeaser.innerHTML = demoUsers.slice(0, 3).map((user, index) => `
          <div class="flex items-center gap-2 p-2 rounded-lg bg-gray-50 dark:bg-slate-800">
            <div class="w-6 h-6 rounded-full ${index === 0 ? 'bg-yellow-500' : index === 1 ? 'bg-gray-400' : 'bg-orange-500'} flex items-center justify-center text-white font-bold text-xs">
              ${index + 1}
            </div>
            <img src="${user.avatar}" class="w-8 h-8 rounded-full object-cover" />
            <div class="flex-1">
              <div class="font-semibold text-xs">${user.name}</div>
              <div class="text-xs text-gray-500">${user.score} pts</div>
            </div>
          </div>
        `).join('');
      }
    }

    // PREMIUM THEMES SYSTEM
    function openThemeSelector() {
      if (!State.subscription.isPremium) {
        UI.toast('Premium themes are only available for premium members', 'info');
        openSubscription();
        return;
      }

      // Update current theme selection
      updateThemeSelector();
      // Ensure theme options are bound
      bindThemeOptions();
      UI.openSheet('sheetThemes');
    }

    function updateThemeSelector() {
      const currentTheme = State.currentUser.theme || 'default';

      // Remove selection from all theme options
      $$('.theme-option').forEach(option => {
        option.classList.remove('border-primary', 'bg-primary/5');
        option.classList.add('border-gray-200', 'dark:border-slate-700');
      });

      // Highlight current theme
      const currentOption = $(`.theme-option[data-theme="${currentTheme}"]`);
      if (currentOption) {
        currentOption.classList.remove('border-gray-200', 'dark:border-slate-700');
        currentOption.classList.add('border-primary', 'bg-primary/5');
      }

      // Enable apply button if a theme is selected
      $('#btnApplyTheme').disabled = false;
    }

    function selectTheme(themeName) {
      State.temp.selectedTheme = themeName;

      // Update visual selection
      $$('.theme-option').forEach(option => {
        option.classList.remove('border-primary', 'bg-primary/5');
        option.classList.add('border-gray-200', 'dark:border-slate-700');
      });

      const selectedOption = $(`.theme-option[data-theme="${themeName}"]`);
      if (selectedOption) {
        selectedOption.classList.remove('border-gray-200', 'dark:border-slate-700');
        selectedOption.classList.add('border-primary', 'bg-primary/5');
      }

      $('#btnApplyTheme').disabled = false;
    }

    function applyTheme() {
      const selectedTheme = State.temp.selectedTheme;
      if (!selectedTheme) {
        UI.toast('Please select a theme first', 'error');
        return;
      }

      // Apply theme to document
      document.documentElement.setAttribute('data-theme', selectedTheme);

      // Save theme preference
      State.currentUser.theme = selectedTheme;
      persist();

      // Update theme preview in profile
      updateThemePreview();

      // Close theme selector
      UI.closeSheet('sheetThemes');

      // Show success message
      const themeNames = {
        'default': 'Raved Classic',
        'rose': 'Rose Garden',
        'emerald': 'Emerald Forest',
        'ocean': 'Ocean Breeze',
        'sunset': 'Sunset Glow',
        'galaxy': 'Galaxy Night'
      };

      UI.toast(`Theme changed to ${themeNames[selectedTheme]}! üé®`, 'success');
    }

    function updateThemePreview() {
      const currentTheme = State.currentUser.theme || 'default';
      const preview = $('#currentThemePreview');

      if (preview) {
        // Remove all theme classes
        preview.className = 'theme-preview p-2 rounded-lg border-2 border-primary';

        // Add current theme gradient classes individually
        const themeGradients = {
          'default': ['bg-gradient-to-br', 'from-primary', 'to-purple-600'],
          'rose': ['bg-gradient-to-br', 'from-pink-500', 'to-rose-600'],
          'emerald': ['bg-gradient-to-br', 'from-emerald-500', 'to-teal-600'],
          'ocean': ['bg-gradient-to-br', 'from-blue-500', 'to-cyan-600'],
          'sunset': ['bg-gradient-to-br', 'from-orange-500', 'to-red-600'],
          'galaxy': ['bg-gradient-to-br', 'from-indigo-600', 'to-purple-700']
        };

        const gradientClasses = themeGradients[currentTheme] || themeGradients['default'];
        gradientClasses.forEach(className => {
          preview.classList.add(className);
        });
      }
    }

    function initializeTheme() {
      const savedTheme = State.currentUser.theme || 'default';
      if (savedTheme !== 'default') {
        document.documentElement.setAttribute('data-theme', savedTheme);
      }
      updateThemePreview();
    }

    // Theme option click handlers
    function bindThemeOptions() {
      $$('.theme-option').forEach(option => {
        option.onclick = () => {
          const theme = option.getAttribute('data-theme');
          selectTheme(theme);
        };
      });

      // Apply theme button
      const btnApplyTheme = $('#btnApplyTheme');
      if (btnApplyTheme) {
        btnApplyTheme.onclick = applyTheme;
      }
    }

    // Call bind theme options
    bindThemeOptions();

    // Avatar style filters
    $$('.avatar-style').forEach(b => b.addEventListener('click', () => {
      $$('.avatar-style').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      b.classList.add('bg-primary','text-white');

      State.temp.newAvatar.style = b.dataset.style;
      applyAvatarStyle();
    }));

    // Avatar border filters
    $$('.border-style').forEach(b => b.addEventListener('click', () => {
      $$('.border-style').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      b.classList.add('bg-primary','text-white');

      State.temp.newAvatar.border = b.dataset.border;
      applyAvatarStyle();
    }));

    // TABS
    $$('.tab-link').forEach(b => b.addEventListener('click', () => switchTab(b.dataset.tab)));

    // FACULTY FILTERS
    $$('.faculty-filter').forEach(b => b.addEventListener('click', () => {
      $$('.faculty-filter').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      b.classList.add('bg-primary','text-white');
      renderFaculties(b.dataset.faculty);
    }));

    // CONNECTION FILTERS
    $$('.connection-filter').forEach(b => b.addEventListener('click', () => {
      $$('.connection-filter').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      b.classList.add('bg-primary','text-white');
      renderConnections(b.dataset.filter);
    }));

    // SIMILAR ITEMS FILTERS
    $$('.similar-filter').forEach(b => b.addEventListener('click', () => {
      $$('.similar-filter').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      b.classList.add('bg-primary','text-white');

      const currentItem = State.temp.currentSimilarItem;
      if (currentItem) {
        renderSimilarItems(currentItem, b.dataset.filter);
      }
    }));

    // STORE FILTERS
    $$('.store-filter').forEach(b => b.addEventListener('click', () => {
      $$('.store-filter').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800');
      b.classList.add('bg-primary','text-white');
      renderStore(b.dataset.filter);
    }));

    // EVENTS FILTERS
    $$('.event-filter').forEach(b => b.addEventListener('click', () => {
      $$('.event-filter').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      b.classList.add('bg-primary','text-white');

      const currentAudience = $('.audience-filter.bg-primary')?.dataset.audience || 'all';
      renderEvents(b.dataset.filter, currentAudience);
    }));

    // AUDIENCE FILTERS
    $$('.audience-filter').forEach(b => b.addEventListener('click', () => {
      $$('.audience-filter').forEach(x => {
        x.classList.remove('bg-primary','text-white');
        x.classList.add('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      });
      b.classList.remove('bg-gray-100','dark:bg-slate-800','text-gray-700','dark:text-gray-300');
      b.classList.add('bg-primary','text-white');

      const currentFilter = $('.event-filter.bg-primary')?.dataset.filter || 'all';
      renderEvents(currentFilter, b.dataset.audience);
    }));

    // FEED LOAD MORE
    $('#btnLoadMoreFeed').onclick = () => {
      const add = [];
      for (let i = 0; i < 3; i++) {
        const u = Users[Math.floor(Math.random() * Users.length)];
        add.push({
          id: 'post_' + Date.now() + '_' + i,
          user: u,
          image: Images[Math.floor(Math.random() * Images.length)],
          caption: captions[Math.floor(Math.random() * captions.length)],
          tags: ['#CampusStyle','#OOTD','#StudentLife'].slice(0,2),
          time: 'now',
          likes: Math.floor(Math.random() * 200) + 5,
          comments: Math.floor(Math.random() * 20),
        });
      }
      State.posts.push(...add);
      persist();
      renderFeed();
      UI.toast('New posts loaded');
    };

    // FACULTY LOAD MORE
    $('#btnLoadMoreFaculty').onclick = () => {
      const add = [];
      for (let i = 0; i < 3; i++) {
        const u = Users[Math.floor(Math.random() * Users.length)];
        add.push({
          id: 'post_' + Date.now() + '_faculty_' + i,
          user: u,
          image: Images[Math.floor(Math.random() * Images.length)],
          caption: captions[Math.floor(Math.random() * captions.length)],
          tags: ['#CampusStyle','#OOTD','#StudentLife'].slice(0,2),
          time: 'now',
          likes: Math.floor(Math.random() * 200) + 5,
          comments: Math.floor(Math.random() * 20),
        });
      }
      State.posts.push(...add);
      persist();
      const currentFaculty = $('.faculty-filter.bg-primary')?.dataset.faculty || 'all';
      renderFaculties(currentFaculty);
      UI.toast('New faculty posts loaded');
    };

    // CART - handled by enhanced checkout system above

    // INBOX / CHAT
    $('#chatSend').onclick = sendChat;
    $('#chatInput').addEventListener('keydown', (e) => { if (e.key === 'Enter') sendChat(); });

    // OPENERS
    $('#btnViewAllStore').onclick = () => openStore();

    // COMMENTS
    $('#commentSend').onclick = addComment;

    // CLOSE SHEETS by button
    $$('[data-close]').forEach(b => b.addEventListener('click', () => UI.closeSheet(b.getAttribute('data-close'))));
    // Overlay close
    UI.overlay.addEventListener('click', UI.closeAllSheets);

    // DARK MODE TOGGLE
    function toggleDarkMode() {
      State.theme = State.theme === 'dark' ? 'light' : 'dark';
      applyDarkMode();
      persist();
    }

    function applyDarkMode() {
      if (State.theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    }

    function initializeDarkMode() {
      applyDarkMode();
    }

    $('#btnTheme').onclick = toggleDarkMode;

    // MULTI-STEP REGISTRATION SYSTEM
    let currentRegistrationStep = 1;
    const totalRegistrationSteps = 6;

    // AUTH Binds
    $('#openRegister').onclick = () => {
      resetRegistrationForm();
      showRegistrationStep(1);
      UI.openSheet('sheetRegister');
    };
    $('#openReset').onclick = () => UI.openSheet('sheetReset');

    // Multi-step navigation functions
    function showRegistrationStep(step) {
      currentRegistrationStep = step;

      // Hide all steps
      for (let i = 1; i <= totalRegistrationSteps; i++) {
        $(`#registerStep${i}`).classList.add('hidden');
      }

      // Show current step
      $(`#registerStep${step}`).classList.remove('hidden');

      // Update progress
      updateRegistrationProgress();

      // Update header
      updateRegistrationHeader(step);

      // Update back button visibility
      $('#btnRegisterBack').classList.toggle('hidden', step === 1);
    }

    function updateRegistrationProgress() {
      const progress = (currentRegistrationStep / totalRegistrationSteps) * 100;
      $('#currentStep').textContent = currentRegistrationStep;
      $('#totalSteps').textContent = totalRegistrationSteps;
      $('#progressPercent').textContent = Math.round(progress) + '%';
      $('#progressBar').style.width = progress + '%';
    }

    function updateRegistrationHeader(step) {
      const titles = {
        1: { title: 'Welcome to Raved', subtitle: 'Join the fashion community' },
        2: { title: 'Personal Information', subtitle: 'Tell us about yourself' },
        3: { title: 'Contact Information', subtitle: 'How can we reach you?' },
        4: { title: 'Verify Your Account', subtitle: 'Confirm your details' },
        5: { title: 'Academic Information', subtitle: 'Connect with your campus' },
        6: { title: 'Secure Your Account', subtitle: 'Create your password' }
      };

      $('#registerTitle').textContent = titles[step].title;
      $('#registerSubtitle').textContent = titles[step].subtitle;
    }

    function nextRegistrationStep() {
      if (currentRegistrationStep < totalRegistrationSteps) {
        showRegistrationStep(currentRegistrationStep + 1);
      }
    }

    function previousRegistrationStep() {
      if (currentRegistrationStep > 1) {
        showRegistrationStep(currentRegistrationStep - 1);
      }
    }

    // Registration form validation and handlers
    function resetRegistrationForm() {
      // Clear all fields
      $('#rgFirst').value = '';
      $('#rgLast').value = '';
      $('#rgUsername').value = '';
      $('#rgPhone').value = '';
      $('#rgEmail').value = '';
      $('#rgEmailCode').value = '';
      $('#rgPhoneCode').value = '';
      $('#rgUniversity').value = '';
      $('#rgStudent').value = '';
      $('#rgFaculty').value = '';
      $('#rgPass').value = '';
      $('#rgPass2').value = '';
      $('#rgTerms').checked = false;

      // Reset validation states
      $('#usernameStatus').classList.add('hidden');
      $('#emailStatus').classList.add('hidden');
      $('#phoneStatus').classList.add('hidden');
      $('#passwordMatch').classList.add('hidden');
      $('#emailVerifiedBadge').classList.add('hidden');
      $('#phoneVerifiedBadge').classList.add('hidden');

      // Reset password strength
      updatePasswordStrength('');

      // Reset step navigation
      currentRegistrationStep = 1;

      // Reset temp verification data
      State.temp.emailVerificationCode = null;
      State.temp.phoneVerificationCode = null;
      State.temp.emailVerified = false;
      State.temp.phoneVerified = false;
    }

    function validateUsername(username) {
      const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
      const status = $('#usernameStatus');
      const help = $('#usernameHelp');

      if (!username) {
        if (status) status.classList.add('hidden');
        if (help) {
          help.textContent = 'Choose a unique username (3-20 characters, letters, numbers, underscore)';
          help.className = 'text-xs text-gray-500 mt-1';
        }
        return false;
      }

      if (!usernameRegex.test(username)) {
        if (status) {
          status.innerHTML = '<i class="fa-solid fa-xmark text-red-500"></i>';
          status.classList.remove('hidden');
        }
        if (help) {
          help.textContent = 'Username must be 3-20 characters (letters, numbers, underscore only)';
          help.className = 'text-xs text-red-500 mt-1';
        }
        return false;
      }

      // Check if username exists (simulate check)
      const existingUsernames = ['admin', 'test', 'user', 'raved']; // Demo existing usernames
      if (existingUsernames.includes(username.toLowerCase())) {
        if (status) {
          status.innerHTML = '<i class="fa-solid fa-xmark text-red-500"></i>';
          status.classList.remove('hidden');
        }
        if (help) {
          help.textContent = 'Username is already taken';
          help.className = 'text-xs text-red-500 mt-1';
        }
        return false;
      }

      // Username is available
      if (status) {
        status.innerHTML = '<i class="fa-solid fa-check text-green-500"></i>';
        status.classList.remove('hidden');
      }
      if (help) {
        help.textContent = 'Username is available';
        help.className = 'text-xs text-green-500 mt-1';
      }
      return true;
    }

    function updatePasswordStrength(password) {
      const strengthBars = $$('.strength-bar');
      const strengthText = $('#passwordStrengthText');

      let strength = 0;
      let strengthLabel = 'Very Weak';
      let strengthColor = 'bg-red-500';

      if (password.length >= 8) strength++;
      if (/[a-z]/.test(password)) strength++;
      if (/[A-Z]/.test(password)) strength++;
      if (/[0-9]/.test(password)) strength++;
      if (/[^a-zA-Z0-9]/.test(password)) strength++;

      // Reset all bars (if they exist)
      strengthBars.forEach(bar => {
        bar.className = 'strength-bar h-1 bg-gray-200 dark:bg-slate-700 rounded flex-1';
      });

      // Update strength display (if element exists)
      if (strengthText) {
        if (strength === 0) {
          strengthLabel = 'Password strength';
          strengthText.className = 'text-gray-500';
        } else if (strength === 1) {
          strengthLabel = 'Very Weak';
          strengthColor = 'bg-red-500';
          strengthText.className = 'text-red-500';
        } else if (strength === 2) {
          strengthLabel = 'Weak';
          strengthColor = 'bg-orange-500';
          strengthText.className = 'text-orange-500';
        } else if (strength === 3) {
          strengthLabel = 'Fair';
          strengthColor = 'bg-yellow-500';
          strengthText.className = 'text-yellow-500';
        } else if (strength === 4) {
          strengthLabel = 'Good';
          strengthColor = 'bg-blue-500';
          strengthText.className = 'text-blue-500';
        } else if (strength === 5) {
          strengthLabel = 'Strong';
          strengthColor = 'bg-green-500';
          strengthText.className = 'text-green-500';
        }

        // Fill strength bars
        for (let i = 0; i < Math.min(strength, 4); i++) {
          if (strengthBars[i]) {
            strengthBars[i].className = `strength-bar h-1 ${strengthColor} rounded flex-1`;
          }
        }

        strengthText.textContent = strengthLabel;
      }

      return strength >= 3; // Require at least "Fair" strength
    }

    function validatePasswordMatch() {
      const pass1Input = $('#rgPass');
      const pass2Input = $('#rgPass2');
      const matchDiv = $('#passwordMatch');

      if (!pass1Input || !pass2Input) return false;

      const pass1 = pass1Input.value;
      const pass2 = pass2Input.value;

      if (!pass2) {
        if (matchDiv) matchDiv.classList.add('hidden');
        return false;
      }

      if (matchDiv) matchDiv.classList.remove('hidden');

      if (pass1 === pass2) {
        if (matchDiv) {
          matchDiv.innerHTML = '<i class="fa-solid fa-check text-green-500 mr-1"></i>Passwords match';
          matchDiv.className = 'mt-1 text-xs text-green-500';
        }
        return true;
      } else {
        if (matchDiv) {
          matchDiv.innerHTML = '<i class="fa-solid fa-xmark text-red-500 mr-1"></i>Passwords do not match';
          matchDiv.className = 'mt-1 text-xs text-red-500';
        }
        return false;
      }
    }

    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      const status = $('#emailStatus');
      const help = $('#emailHelp');

      if (!email) {
        if (status) status.classList.add('hidden');
        if (help) {
          help.textContent = "We'll send a verification code to this email";
          help.className = 'text-xs text-gray-500 mt-1';
        }
        return false;
      }

      if (!emailRegex.test(email)) {
        if (status) {
          status.innerHTML = '<i class="fa-solid fa-xmark text-red-500"></i>';
          status.classList.remove('hidden');
        }
        if (help) {
          help.textContent = 'Please enter a valid email address';
          help.className = 'text-xs text-red-500 mt-1';
        }
        return false;
      }

      // Email format is valid
      if (status) {
        status.innerHTML = '<i class="fa-solid fa-check text-green-500"></i>';
        status.classList.remove('hidden');
      }
      if (help) {
        help.textContent = 'Valid email address';
        help.className = 'text-xs text-green-500 mt-1';
      }

      // Show email verification section (if it exists)
      const emailVerificationDiv = $('#emailVerificationDiv');
      const verificationSection = $('#verificationSection');
      if (emailVerificationDiv) emailVerificationDiv.classList.remove('hidden');
      if (verificationSection) verificationSection.classList.remove('hidden');

      return true;
    }

    function validatePhone(phone) {
      const phoneRegex = /^0[0-9]{9}$/; // Ghana phone number format
      const status = $('#phoneStatus');
      const help = $('#phoneHelp');

      if (!phone) {
        if (status) status.classList.add('hidden');
        if (help) {
          help.textContent = "We'll send a verification SMS to this number";
          help.className = 'text-xs text-gray-500 mt-1';
        }
        return false;
      }

      if (!phoneRegex.test(phone)) {
        if (status) {
          status.innerHTML = '<i class="fa-solid fa-xmark text-red-500"></i>';
          status.classList.remove('hidden');
        }
        if (help) {
          help.textContent = 'Please enter a valid Ghana phone number (0XXXXXXXXX)';
          help.className = 'text-xs text-red-500 mt-1';
        }
        return false;
      }

      // Phone format is valid
      if (status) {
        status.innerHTML = '<i class="fa-solid fa-check text-green-500"></i>';
        status.classList.remove('hidden');
      }
      if (help) {
        help.textContent = 'Valid phone number';
        help.className = 'text-xs text-green-500 mt-1';
      }

      // Show phone verification section (if it exists)
      const phoneVerificationDiv = $('#phoneVerificationDiv');
      const verificationSection = $('#verificationSection');
      if (phoneVerificationDiv) phoneVerificationDiv.classList.remove('hidden');
      if (verificationSection) verificationSection.classList.remove('hidden');

      return true;
    }

    function validateRegistrationForm() {
      const first = $('#rgFirst').value.trim();
      const last = $('#rgLast').value.trim();
      const username = $('#rgUsername').value.trim();
      const email = $('#rgEmail').value.trim();
      const phone = $('#rgPhone').value.trim();
      const password = $('#rgPass').value;
      const confirmPassword = $('#rgPass2').value;
      const terms = $('#rgTerms').checked;

      // Verification codes (if verification sections are visible)
      const emailVerificationDiv = $('#emailVerificationDiv');
      const phoneVerificationDiv = $('#phoneVerificationDiv');
      const emailCodeRequired = emailVerificationDiv && !emailVerificationDiv.classList.contains('hidden');
      const phoneCodeRequired = phoneVerificationDiv && !phoneVerificationDiv.classList.contains('hidden');
      const emailCodeInput = $('#rgEmailCode');
      const phoneCodeInput = $('#rgPhoneCode');
      const emailCode = emailCodeInput ? emailCodeInput.value.trim() : '';
      const phoneCode = phoneCodeInput ? phoneCodeInput.value.trim() : '';

      const isUsernameValid = validateUsername(username);
      const isEmailValid = validateEmail(email);
      const isPhoneValid = validatePhone(phone);
      const isPasswordStrong = updatePasswordStrength(password);
      const isPasswordMatch = validatePasswordMatch();

      // Check verification codes if required
      const isEmailVerified = !emailCodeRequired || (emailCode.length === 6);
      const isPhoneVerified = !phoneCodeRequired || (phoneCode.length === 6);

      const isValid = first && last && username && email && phone &&
                     password && confirmPassword && terms &&
                     isUsernameValid && isEmailValid && isPhoneValid &&
                     isPasswordStrong && isPasswordMatch &&
                     isEmailVerified && isPhoneVerified;

      $('#btnRegister').disabled = !isValid;
      return isValid;
    }

    // Verification code functions
    function sendEmailVerificationCode() {
      const email = $('#rgEmail').value.trim();
      if (!validateEmail(email)) {
        UI.toast('Please enter a valid email address first', 'error');
        return;
      }

      // Simulate sending email code
      const code = Math.floor(100000 + Math.random() * 900000).toString();
      State.temp.emailVerificationCode = code;

      UI.toast('Verification code sent to your email!', 'success');
      console.log('Email verification code:', code); // For demo purposes

      // Update button state
      $('#btnSendEmailCode').textContent = 'Resend';
      $('#emailCodeHelp').innerHTML = `Enter the 6-digit code sent to ${email} <span class="text-primary">(Demo: ${code})</span>`;
    }

    function sendPhoneVerificationCode() {
      const phone = $('#rgPhone').value.trim();
      if (!validatePhone(phone)) {
        UI.toast('Please enter a valid phone number first', 'error');
        return;
      }

      // Simulate sending SMS code
      const code = Math.floor(100000 + Math.random() * 900000).toString();
      State.temp.phoneVerificationCode = code;

      UI.toast('Verification SMS sent to your phone!', 'success');
      console.log('Phone verification code:', code); // For demo purposes

      // Update button state
      $('#btnSendPhoneCode').textContent = 'Resend';
      $('#phoneCodeHelp').innerHTML = `Enter the 6-digit code sent to ${phone} <span class="text-primary">(Demo: ${code})</span>`;
    }

    function validateVerificationCode(type) {
      const code = type === 'email' ? $('#rgEmailCode').value.trim() : $('#rgPhoneCode').value.trim();
      const expectedCode = type === 'email' ? State.temp.emailVerificationCode : State.temp.phoneVerificationCode;
      const helpElement = type === 'email' ? $('#emailCodeHelp') : $('#phoneCodeHelp');

      if (code.length === 6) {
        if (code === expectedCode) {
          helpElement.innerHTML = `<i class="fa-solid fa-check text-green-500 mr-1"></i>Code verified successfully!`;
          helpElement.className = 'text-xs text-green-500 mt-1';
          return true;
        } else {
          helpElement.innerHTML = `<i class="fa-solid fa-xmark text-red-500 mr-1"></i>Invalid verification code`;
          helpElement.className = 'text-xs text-red-500 mt-1';
          return false;
        }
      }
      return false;
    }

    // Form field event listeners for step-specific validation
    $('#rgFirst').oninput = () => validateStep2();
    $('#rgLast').oninput = () => validateStep2();
    $('#rgUsername').oninput = () => validateStep2();

    $('#rgEmail').oninput = () => validateStep3();
    $('#rgPhone').oninput = () => validateStep3();

    $('#rgEmailCode').oninput = () => validateStep4();
    $('#rgPhoneCode').oninput = () => validateStep4();

    $('#rgPass').oninput = () => validateStep6();
    $('#rgPass2').oninput = () => validateStep6();
    $('#rgTerms').onchange = () => validateStep6();

    // Step-specific validation functions
    function validateStep2() {
      const first = $('#rgFirst').value.trim();
      const last = $('#rgLast').value.trim();
      const username = $('#rgUsername').value.trim();
      const isUsernameValid = validateUsername(username);

      const isValid = first && last && username && isUsernameValid;
      $('#btnPersonalNext').disabled = !isValid;
      return isValid;
    }

    function validateStep3() {
      const email = $('#rgEmail').value.trim();
      const phone = $('#rgPhone').value.trim();
      const isEmailValid = validateEmail(email);
      const isPhoneValid = validatePhone(phone);

      const isValid = email && phone && isEmailValid && isPhoneValid;
      $('#btnContactNext').disabled = !isValid;
      return isValid;
    }

    function validateStep4() {
      const emailCode = $('#rgEmailCode').value.trim();
      const phoneCode = $('#rgPhoneCode').value.trim();

      // Update display fields
      $('#emailDisplay').textContent = $('#rgEmail').value;
      $('#phoneDisplay').textContent = $('#rgPhone').value;

      const isEmailVerified = validateVerificationCode('email');
      const isPhoneVerified = validateVerificationCode('phone');

      // Show verified badges
      if (isEmailVerified) {
        $('#emailVerifiedBadge').classList.remove('hidden');
        State.temp.emailVerified = true;
      }
      if (isPhoneVerified) {
        $('#phoneVerifiedBadge').classList.remove('hidden');
        State.temp.phoneVerified = true;
      }

      const isValid = emailCode.length === 6 && phoneCode.length === 6 && isEmailVerified && isPhoneVerified;
      $('#btnVerificationNext').disabled = !isValid;
      return isValid;
    }

    function validateStep6() {
      const password = $('#rgPass').value;
      const confirmPassword = $('#rgPass2').value;
      const terms = $('#rgTerms').checked;

      const isPasswordStrong = updatePasswordStrength(password);
      const isPasswordMatch = validatePasswordMatch();

      const isValid = password && confirmPassword && terms && isPasswordStrong && isPasswordMatch;
      $('#btnRegister').disabled = !isValid;
      return isValid;
    }

    // Step navigation button handlers
    $('#btnStartRegistration').onclick = () => nextRegistrationStep();
    $('#btnRegisterBack').onclick = () => previousRegistrationStep();

    // Step 2 handlers
    $('#btnPersonalBack').onclick = () => previousRegistrationStep();
    $('#btnPersonalNext').onclick = () => {
      if (validateStep2()) nextRegistrationStep();
    };

    // Step 3 handlers
    $('#btnContactBack').onclick = () => previousRegistrationStep();
    $('#btnContactNext').onclick = () => {
      if (validateStep3()) nextRegistrationStep();
    };

    // Step 4 handlers
    $('#btnVerificationBack').onclick = () => previousRegistrationStep();
    $('#btnVerificationNext').onclick = () => {
      if (validateStep4()) nextRegistrationStep();
    };

    // Step 5 handlers
    $('#btnAcademicBack').onclick = () => previousRegistrationStep();
    $('#btnAcademicNext').onclick = () => nextRegistrationStep(); // Academic info is optional

    // Step 6 handlers
    $('#btnSecurityBack').onclick = () => previousRegistrationStep();

    // Verification code buttons
    $('#btnSendEmailCode').onclick = sendEmailVerificationCode;
    $('#btnSendPhoneCode').onclick = sendPhoneVerificationCode;

    // Password visibility toggles
    $('#togglePassword1').onclick = () => {
      const passField = $('#rgPass');
      const icon = $('#togglePassword1 i');
      if (passField.type === 'password') {
        passField.type = 'text';
        icon.className = 'fa-solid fa-eye-slash';
      } else {
        passField.type = 'password';
        icon.className = 'fa-solid fa-eye';
      }
    };

    $('#togglePassword2').onclick = () => {
      const passField = $('#rgPass2');
      const icon = $('#togglePassword2 i');
      if (passField.type === 'password') {
        passField.type = 'text';
        icon.className = 'fa-solid fa-eye-slash';
      } else {
        passField.type = 'password';
        icon.className = 'fa-solid fa-eye';
      }
    };

    // Login password toggle
    $('#toggleLoginPassword').onclick = () => {
      const passField = $('#loginPassword');
      const icon = $('#toggleLoginPassword i');
      if (passField.type === 'password') {
        passField.type = 'text';
        icon.className = 'fa-solid fa-eye-slash';
      } else {
        passField.type = 'password';
        icon.className = 'fa-solid fa-eye';
      }
    };

    $('#btnRegister').onclick = () => {
      if (!validateStep6()) {
        UI.toast('Please complete all required fields correctly', 'error');
        return;
      }

      // Show loading state
      $('#btnRegister').innerHTML = '<i class="fa-solid fa-spinner fa-spin mr-2"></i>Creating Account...';
      $('#btnRegister').disabled = true;

      // Simulate account creation delay
      setTimeout(() => {
        const first = $('#rgFirst').value.trim();
        const last = $('#rgLast').value.trim();
        const username = $('#rgUsername').value.trim();
        const email = $('#rgEmail').value.trim();
        const phone = $('#rgPhone').value.trim();
        const university = $('#rgUniversity').value.trim();
        const student = $('#rgStudent').value.trim();
        const faculty = $('#rgFaculty').value;

        // Update user profile with all new fields
        State.currentUser.name = first + ' ' + last;
        State.currentUser.username = username;
        State.currentUser.email = email;
        State.currentUser.phone = phone;
        State.currentUser.university = university || 'Not specified';
        State.currentUser.studentId = student || null;
        State.currentUser.faculty = faculty || 'Not specified';
        State.currentUser.id = 'user_' + Date.now(); // Generate unique ID
        State.currentUser.emailVerified = State.temp.emailVerified || true;
        State.currentUser.phoneVerified = State.temp.phoneVerified || true;
        State.currentUser.joinDate = new Date().toISOString();
        State.loggedIn = true;

        persist();
        UI.closeSheet('sheetRegister');
        showApp();

        // Show success message with confetti effect
        UI.toast(`üéâ Welcome to Raved, @${username}! Your account has been created successfully.`, 'success');

        // Reset button state
        $('#btnRegister').innerHTML = '<i class="fa-solid fa-user-plus mr-2"></i>Create Account';
        $('#btnRegister').disabled = false;
      }, 2000);
    };

    $('#btnReset').onclick = () => { UI.toast('Reset link sent ‚úâÔ∏è'); UI.closeSheet('sheetReset'); };

    // Login form submit handler
    $('#loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      console.log('Login form submitted'); // Debug log
      const identifier = $('#loginIdentifier').value.trim();
      const password = $('#loginPassword').value.trim();
      console.log('Identifier:', identifier, 'Password length:', password.length); // Debug log
      if (!identifier || !password) {
        console.log('Missing credentials'); // Debug log
        return UI.toast('Enter credentials', 'error');
      }
      console.log('Logging in...'); // Debug log
      State.loggedIn = true;
      persist();
      showApp();
      UI.toast('Login successful');
    });

    // Backup click handler for signin button
    $('#signinBtn').onclick = (e) => {
      console.log('Signin button clicked'); // Debug log
      // Let the form submit event handle it
    };

    // PROFILE EDIT
    $('#btnEditProfile').onclick = () => {
      $('#searchInput').value = '';
      $('#searchResults').innerHTML = `
        <div class="space-y-2">
          <div class="bg-white dark:bg-slate-900 rounded-xl p-3 space-y-2">
            <input id="edName" class="w-full rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" value="${State.currentUser.name}">
            <input id="edBio" class="w-full rounded-lg border border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 px-3 py-2" value="${State.currentUser.bio||''}" placeholder="Bio">
          </div>
          <button id="edSave" class="w-full bg-primary text-white rounded-xl py-3 font-semibold">Save</button>
        </div>`;
      UI.openSheet('sheetSearch');
      $('#edSave').onclick = () => {
        State.currentUser.name = $('#edName').value.trim() || State.currentUser.name;
        State.currentUser.bio = $('#edBio').value.trim();
        persist();
        UI.closeSheet('sheetSearch');
        renderProfile();
        UI.toast('Profile updated');
      };
    };
    $('#pfChangeAvatar').onclick = () => UI.toast('Avatar change coming soon', 'info');
    $('#pfRefresh').onclick = () => { renderProfile(); UI.toast('Refreshed'); };

    // CREATE EVENT
    $('#btnNewEvent').onclick = () => UI.openSheet('sheetCreateEvent');
    $('#btnSaveEvent').onclick = () => {
      const title = $('#evTitle').value.trim();
      const date = $('#evDate').value;
      const time = $('#evTime').value;
      const cat = $('#evCat').value;
      const audience = $('#evAudience').value;
      const loc = $('#evLoc').value.trim();
      const desc = $('#evDesc').value.trim();
      const capacity = parseInt($('#evCapacity').value) || 50;
      const fee = parseFloat($('#evFee').value) || 0;
      const requireReg = $('#evRequireReg').checked;
      const allowWaitlist = $('#evAllowWaitlist').checked;
      const sendReminders = $('#evSendReminders').checked;

      if (!title || !date || !time || !cat || !loc) {
        return UI.toast('Please complete all required fields', 'error');
      }

      const ev = {
        id: 'ev_' + Date.now(),
        title,
        organizer: State.currentUser.name,
        orgAvatar: State.currentUser.avatar,
        date,
        time,
        location: loc,
        category: cat,
        audience: audience,
        description: desc,
        image: Images[Math.floor(Math.random() * Images.length)],
        attendees: 1,
        max: capacity,
        fee: fee,
        attending: true,
        tags: [],
        ownerId: State.currentUser.id,
        settings: {
          requireRegistration: requireReg,
          allowWaitlist: allowWaitlist,
          sendReminders: sendReminders
        }
      };

      State.events.unshift(ev);
      persist();
      UI.closeSheet('sheetCreateEvent');

      // Refresh events with current filters
      const currentFilter = $('.event-filter.bg-primary')?.dataset.filter || 'all';
      const currentAudience = $('.audience-filter.bg-primary')?.dataset.audience || 'all';
      renderEvents(currentFilter, currentAudience);

      UI.toast('Event created successfully! üéâ');

      // Clear form
      $('#evTitle').value = '';
      $('#evDate').value = '';
      $('#evTime').value = '';
      $('#evLoc').value = '';
      $('#evDesc').value = '';
      $('#evCapacity').value = '50';
      $('#evFee').value = '0';
    };

    // CART entry points
    $('#btnCheckout').onclick = () => { if (State.cart.length) UI.openSheet('sheetCheckout'); else UI.toast('Cart is empty', 'error'); };

    // MESSAGES entry
    $('#qaMessages').onclick = () => { UI.closeSheet('sheetMore'); UI.openSheet('sheetInbox'); };

    // PROFILE FUNCTIONS
    function openProfileSettings() {
      UI.openSheet('sheetProfileSettings');
    }

    function switchProfileTab(tabName) {
      // Update tab buttons
      $$('.profile-tab').forEach(btn => {
        const isActive = btn.getAttribute('data-tab') === tabName;
        if (isActive) {
          btn.className = 'profile-tab flex-1 py-3 px-4 text-sm font-medium text-primary border-b-2 border-primary';
        } else {
          btn.className = 'profile-tab flex-1 py-3 px-4 text-sm font-medium text-gray-500 hover:text-gray-700 dark:hover:text-gray-300';
        }
      });

      // Update tab content
      $$('.profile-tab-content').forEach(content => {
        content.classList.add('hidden');
      });

      const activeContent = $(`#profile-${tabName}`);
      if (activeContent) {
        activeContent.classList.remove('hidden');
      }

      // Render content based on tab
      switch(tabName) {
        case 'posts':
          renderUserPosts();
          break;
        case 'comments':
          renderUserComments();
          break;
        case 'liked':
          renderUserLikedPosts();
          break;
        case 'saved':
          renderUserSavedPosts();
          break;
      }
    }

    function renderUserPosts() {
      const userPosts = State.posts.filter(p => p.user.id === State.currentUser.id);
      const grid = $('#pfGrid');
      const emptyState = $('#pfEmptyPosts');

      if (userPosts.length === 0) {
        if (grid) grid.innerHTML = '';
        if (emptyState) emptyState.classList.remove('hidden');
      } else {
        if (emptyState) emptyState.classList.add('hidden');
        if (grid) {
          grid.innerHTML = userPosts.map(post => `
            <div class="aspect-square bg-gray-100 dark:bg-slate-800 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity" onclick="openPostDetail('${post.id}')">
              ${post.type === 'video' ? `
                <div class="relative w-full h-full">
                  <img src="${post.thumbnail}" class="w-full h-full object-cover" />
                  <div class="absolute inset-0 flex items-center justify-center">
                    <i class="fa-solid fa-play text-white text-2xl drop-shadow-lg"></i>
                  </div>
                </div>
              ` : post.type === 'carousel' ? `
                <div class="relative w-full h-full">
                  <img src="${post.images[0]}" class="w-full h-full object-cover" />
                  <div class="absolute top-2 right-2">
                    <i class="fa-solid fa-clone text-white text-sm drop-shadow-lg"></i>
                  </div>
                </div>
              ` : `
                <img src="${post.image}" class="w-full h-full object-cover" />
              `}
            </div>
          `).join('');
        }
      }

      // Update post count
      const countEl = $('#pfCountPosts');
      if (countEl) countEl.textContent = userPosts.length;
    }

    function renderUserComments() {
      const userComments = [];

      // Collect all comments by the user
      Object.keys(State.comments).forEach(postId => {
        const postComments = State.comments[postId] || [];
        postComments.forEach(comment => {
          if (comment.user.id === State.currentUser.id) {
            const post = State.posts.find(p => p.id === postId);
            if (post) {
              userComments.push({
                ...comment,
                postId: postId,
                post: post
              });
            }
          }
        });
      });

      const commentsList = $('#pfCommentsList');
      const emptyState = $('#pfEmptyComments');

      if (userComments.length === 0) {
        if (commentsList) commentsList.innerHTML = '';
        if (emptyState) emptyState.classList.remove('hidden');
      } else {
        if (emptyState) emptyState.classList.add('hidden');
        if (commentsList) {
          commentsList.innerHTML = userComments.map(comment => `
            <div class="bg-white dark:bg-slate-900 rounded-lg p-3 border border-gray-200 dark:border-slate-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors" onclick="openPostDetail('${comment.postId}')">
              <div class="flex gap-3">
                <img src="${comment.post.image || comment.post.images?.[0] || comment.post.thumbnail}" class="w-12 h-12 rounded-lg object-cover" />
                <div class="flex-1">
                  <div class="text-sm font-medium text-gray-900 dark:text-gray-100">${comment.text}</div>
                  <div class="text-xs text-gray-500 mt-1">On ${comment.post.user.name}'s post ‚Ä¢ ${comment.time}</div>
                </div>
              </div>
            </div>
          `).join('');
        }
      }
    }

    function renderUserLikedPosts() {
      const likedPosts = State.posts.filter(p => State.likes.has(p.id));
      const grid = $('#pfLikedGrid');
      const emptyState = $('#pfEmptyLiked');

      if (likedPosts.length === 0) {
        if (grid) grid.innerHTML = '';
        if (emptyState) emptyState.classList.remove('hidden');
      } else {
        if (emptyState) emptyState.classList.add('hidden');
        if (grid) {
          grid.innerHTML = likedPosts.map(post => `
            <div class="aspect-square bg-gray-100 dark:bg-slate-800 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity" onclick="openPostDetail('${post.id}')">
              ${post.type === 'video' ? `
                <div class="relative w-full h-full">
                  <img src="${post.thumbnail}" class="w-full h-full object-cover" />
                  <div class="absolute inset-0 flex items-center justify-center">
                    <i class="fa-solid fa-play text-white text-2xl drop-shadow-lg"></i>
                  </div>
                </div>
              ` : post.type === 'carousel' ? `
                <div class="relative w-full h-full">
                  <img src="${post.images[0]}" class="w-full h-full object-cover" />
                  <div class="absolute top-2 right-2">
                    <i class="fa-solid fa-clone text-white text-sm drop-shadow-lg"></i>
                  </div>
                </div>
              ` : `
                <img src="${post.image}" class="w-full h-full object-cover" />
              `}
            </div>
          `).join('');
        }
      }

      // Update likes count
      const countEl = $('#pfCountLikes');
      if (countEl) countEl.textContent = likedPosts.length;
    }

    function renderUserSavedPosts() {
      const savedPosts = State.posts.filter(p => State.bookmarks.has(p.id));
      const grid = $('#pfSavedGrid');
      const emptyState = $('#pfEmptySaved');

      if (savedPosts.length === 0) {
        if (grid) grid.innerHTML = '';
        if (emptyState) emptyState.classList.remove('hidden');
      } else {
        if (emptyState) emptyState.classList.add('hidden');
        if (grid) {
          grid.innerHTML = savedPosts.map(post => `
            <div class="aspect-square bg-gray-100 dark:bg-slate-800 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition-opacity" onclick="openPostDetail('${post.id}')">
              ${post.type === 'video' ? `
                <div class="relative w-full h-full">
                  <img src="${post.thumbnail}" class="w-full h-full object-cover" />
                  <div class="absolute inset-0 flex items-center justify-center">
                    <i class="fa-solid fa-play text-white text-2xl drop-shadow-lg"></i>
                  </div>
                </div>
              ` : post.type === 'carousel' ? `
                <div class="relative w-full h-full">
                  <img src="${post.images[0]}" class="w-full h-full object-cover" />
                  <div class="absolute top-2 right-2">
                    <i class="fa-solid fa-clone text-white text-sm drop-shadow-lg"></i>
                  </div>
                </div>
              ` : `
                <img src="${post.image}" class="w-full h-full object-cover" />
              `}
            </div>
          `).join('');
        }
      }
    }

    // Settings functions
    function openEditProfile() {
      UI.closeSheet('sheetProfileSettings');

      // Populate edit form with current data
      const editProfileAvatar = $('#editProfileAvatar');
      const editProfileName = $('#editProfileName');
      const editProfileUsername = $('#editProfileUsername');
      const editProfileBio = $('#editProfileBio');
      const editProfileFaculty = $('#editProfileFaculty');
      const editProfileLocation = $('#editProfileLocation');
      const editProfileWebsite = $('#editProfileWebsite');

      if (editProfileAvatar) editProfileAvatar.src = State.currentUser.avatar;
      if (editProfileName) editProfileName.value = State.currentUser.name || '';
      if (editProfileUsername) editProfileUsername.value = State.currentUser.username || '';
      if (editProfileBio) editProfileBio.value = State.currentUser.bio || '';
      if (editProfileFaculty) editProfileFaculty.value = State.currentUser.faculty || '';
      if (editProfileLocation) editProfileLocation.value = State.currentUser.location || '';
      if (editProfileWebsite) editProfileWebsite.value = State.currentUser.website || '';

      // Bind bio character counter
      if (editProfileBio) {
        editProfileBio.oninput = () => {
          const charCount = $('#bioCharCount');
          if (charCount) charCount.textContent = editProfileBio.value.length;
        };
        // Trigger initial count
        editProfileBio.oninput();
      }

      UI.openSheet('sheetEditProfile');
    }

    function saveProfileChanges() {
      const name = $('#editProfileName')?.value.trim();
      const username = $('#editProfileUsername')?.value.trim();
      const bio = $('#editProfileBio')?.value.trim();
      const faculty = $('#editProfileFaculty')?.value;
      const location = $('#editProfileLocation')?.value.trim();
      const website = $('#editProfileWebsite')?.value.trim();

      // Validation
      if (!name) {
        UI.toast('Name is required', 'error');
        return;
      }

      if (username && username.length < 3) {
        UI.toast('Username must be at least 3 characters', 'error');
        return;
      }

      if (bio && bio.length > 150) {
        UI.toast('Bio must be 150 characters or less', 'error');
        return;
      }

      // Update user data
      State.currentUser.name = name;
      State.currentUser.username = username;
      State.currentUser.bio = bio;
      State.currentUser.faculty = faculty;
      State.currentUser.location = location;
      State.currentUser.website = website;

      // Save to storage
      persist();

      // Update UI
      renderProfile();

      // Close sheet and show success
      UI.closeSheet('sheetEditProfile');
      UI.toast('Profile updated successfully! ‚ú®', 'success');
    }

    function openPrivacySettings() {
      UI.closeSheet('sheetProfileSettings');

      // Load current privacy settings
      const privateAccountToggle = $('#privateAccountToggle');
      const activityStatusToggle = $('#activityStatusToggle');
      const readReceiptsToggle = $('#readReceiptsToggle');
      const allowDownloadsToggle = $('#allowDownloadsToggle');
      const storySharingToggle = $('#storySharingToggle');
      const analyticsToggle = $('#analyticsToggle');
      const personalizedAdsToggle = $('#personalizedAdsToggle');

      if (privateAccountToggle) privateAccountToggle.checked = State.currentUser.isPrivate || false;
      if (activityStatusToggle) activityStatusToggle.checked = State.currentUser.showActivity !== false;
      if (readReceiptsToggle) readReceiptsToggle.checked = State.currentUser.readReceipts !== false;
      if (allowDownloadsToggle) allowDownloadsToggle.checked = State.currentUser.allowDownloads || false;
      if (storySharingToggle) storySharingToggle.checked = State.currentUser.allowStorySharing !== false;
      if (analyticsToggle) analyticsToggle.checked = State.currentUser.analytics !== false;
      if (personalizedAdsToggle) personalizedAdsToggle.checked = State.currentUser.personalizedAds !== false;

      UI.openSheet('sheetPrivacySettings');
    }

    function togglePrivateAccount() {
      const isPrivate = $('#privateAccountToggle')?.checked || false;
      State.currentUser.isPrivate = isPrivate;
      persist();
      UI.toast(isPrivate ? 'Account is now private üîí' : 'Account is now public üåç', 'success');
    }

    function toggleActivityStatus() {
      const showActivity = $('#activityStatusToggle')?.checked || false;
      State.currentUser.showActivity = showActivity;
      persist();
      UI.toast(showActivity ? 'Activity status enabled' : 'Activity status disabled', 'success');
    }

    function toggleReadReceipts() {
      const readReceipts = $('#readReceiptsToggle')?.checked || false;
      State.currentUser.readReceipts = readReceipts;
      persist();
      UI.toast(readReceipts ? 'Read receipts enabled' : 'Read receipts disabled', 'success');
    }

    function toggleAllowDownloads() {
      const allowDownloads = $('#allowDownloadsToggle')?.checked || false;
      State.currentUser.allowDownloads = allowDownloads;
      persist();
      UI.toast(allowDownloads ? 'Downloads allowed' : 'Downloads disabled', 'success');
    }

    function toggleStorySharing() {
      const allowStorySharing = $('#storySharingToggle')?.checked || false;
      State.currentUser.allowStorySharing = allowStorySharing;
      persist();
      UI.toast(allowStorySharing ? 'Story sharing enabled' : 'Story sharing disabled', 'success');
    }

    function toggleAnalytics() {
      const analytics = $('#analyticsToggle')?.checked || false;
      State.currentUser.analytics = analytics;
      persist();
      UI.toast(analytics ? 'Analytics enabled' : 'Analytics disabled', 'success');
    }

    function togglePersonalizedAds() {
      const personalizedAds = $('#personalizedAdsToggle')?.checked || false;
      State.currentUser.personalizedAds = personalizedAds;
      persist();
      UI.toast(personalizedAds ? 'Personalized ads enabled' : 'Personalized ads disabled', 'success');
    }

    function openBlockedUsers() {
      UI.closeSheet('sheetPrivacySettings');
      UI.toast('Blocked users management coming soon!', 'info');
    }

    function openLanguageSettings() {
      UI.closeSheet('sheetProfileSettings');

      // Load current language settings
      const currentLang = State.currentUser.language || 'en';
      const langRadio = $(`input[name="appLanguage"][value="${currentLang}"]`);
      if (langRadio) langRadio.checked = true;

      const dateFormatSelect = $('#dateFormatSelect');
      const currencySelect = $('#currencySelect');

      if (dateFormatSelect) dateFormatSelect.value = State.currentUser.dateFormat || 'DD/MM/YYYY';
      if (currencySelect) currencySelect.value = State.currentUser.currency || 'GHS';

      UI.openSheet('sheetLanguageSettings');
    }

    function changeAppLanguage(lang) {
      State.currentUser.language = lang;
      persist();

      const languages = {
        'en': 'English',
        'tw': 'Twi',
        'ha': 'Hausa',
        'fr': 'Fran√ßais'
      };

      UI.toast(`Language changed to ${languages[lang]} üåç`, 'success');
    }

    function changeDateFormat() {
      const format = $('#dateFormatSelect')?.value;
      if (format) {
        State.currentUser.dateFormat = format;
        persist();
        UI.toast(`Date format changed to ${format}`, 'success');
      }
    }

    function changeCurrency() {
      const currency = $('#currencySelect')?.value;
      if (currency) {
        State.currentUser.currency = currency;
        persist();

        const currencies = {
          'GHS': 'Ghana Cedi (‚Çµ)',
          'USD': 'US Dollar ($)',
          'EUR': 'Euro (‚Ç¨)',
          'GBP': 'British Pound (¬£)'
        };

        UI.toast(`Currency changed to ${currencies[currency]}`, 'success');
      }
    }

    function openHelp() {
      UI.closeSheet('sheetProfileSettings');
      UI.openSheet('sheetHelp');
    }

    function openAbout() {
      UI.closeSheet('sheetProfileSettings');
      UI.openSheet('sheetAbout');
    }

    function openTerms() {
      UI.closeSheet('sheetProfileSettings');
      UI.toast('Terms & Privacy coming soon!', 'info');
    }

    function confirmDeleteAccount() {
      if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
        // Show confirmation dialog
        if (confirm('This will permanently delete all your posts, messages, and data. Type "DELETE" to confirm.')) {
          UI.toast('Account deletion initiated. You will receive an email confirmation.', 'info');
          // In a real app, this would trigger the deletion process
        }
      }
    }

    function shareProfile() {
      const profileUrl = `https://raved.app/@${State.currentUser.username || State.currentUser.id}`;

      if (navigator.share) {
        navigator.share({
          title: `${State.currentUser.name} on Raved`,
          text: `Check out ${State.currentUser.name}'s fashion profile on Raved!`,
          url: profileUrl
        }).then(() => {
          UI.toast('Profile shared! üì§', 'success');
        }).catch(() => {
          copyToClipboard(profileUrl);
        });
      } else {
        copyToClipboard(profileUrl);
      }
    }

    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          UI.toast('Profile link copied to clipboard! üìã', 'success');
        });
      } else {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        UI.toast('Profile link copied to clipboard! üìã', 'success');
      }
    }

    // Help & Support functions
    function openFAQ() {
      UI.closeSheet('sheetHelp');
      UI.toast('FAQ page coming soon!', 'info');
    }

    function openUserGuide() {
      UI.closeSheet('sheetHelp');
      UI.toast('User guide coming soon!', 'info');
    }

    function openVideoTutorials() {
      UI.closeSheet('sheetHelp');
      UI.toast('Video tutorials coming soon!', 'info');
    }

    function openLiveChat() {
      UI.closeSheet('sheetHelp');
      UI.toast('Live chat support coming soon! üí¨', 'info');
    }

    function sendEmail() {
      const subject = encodeURIComponent('Raved Support Request');
      const body = encodeURIComponent(`Hi Raved Support Team,

I need help with:

[Please describe your issue here]

User ID: ${State.currentUser.id}
App Version: 1.0.0 (Beta)

Thank you!`);

      window.open(`mailto:support@raved.app?subject=${subject}&body=${body}`);
      UI.toast('Email client opened! üìß', 'success');
    }

    function reportBug() {
      UI.closeSheet('sheetHelp');

      const subject = encodeURIComponent('Bug Report - Raved App');
      const body = encodeURIComponent(`Bug Report

Description:
[Please describe the bug]

Steps to reproduce:
1.
2.
3.

Expected behavior:
[What should happen]

Actual behavior:
[What actually happened]

Device info:
- User Agent: ${navigator.userAgent}
- Screen: ${screen.width}x${screen.height}
- User ID: ${State.currentUser.id}

Thank you for helping us improve Raved!`);

      window.open(`mailto:support@raved.app?subject=${subject}&body=${body}`);
      UI.toast('Bug report template opened! üêõ', 'success');
    }

    function openCommunityForum() {
      UI.closeSheet('sheetHelp');
      UI.toast('Community forum coming soon!', 'info');
    }

    function openDiscord() {
      UI.closeSheet('sheetHelp');
      window.open('https://discord.gg/raved', '_blank');
      UI.toast('Discord server opened! üéÆ', 'success');
    }

    // About functions
    function openTermsOfService() {
      UI.closeSheet('sheetAbout');
      UI.toast('Terms of Service coming soon!', 'info');
    }

    function openPrivacyPolicy() {
      UI.closeSheet('sheetAbout');
      UI.toast('Privacy Policy coming soon!', 'info');
    }

    function openCommunityGuidelines() {
      UI.closeSheet('sheetAbout');
      UI.toast('Community Guidelines coming soon!', 'info');
    }

    // Sign out function
    function signOut() {
      if (confirm('Are you sure you want to sign out?')) {
        // Clear user data
        localStorage.clear();

        // Reset state
        State.loggedIn = false;
        State.currentUser = null;

        // Show sign out message
        UI.toast('Signed out successfully! üëã', 'success');

        // Reload page to show login
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      }
    }

    // Bind profile tab events
    function bindProfileEvents() {
      $$('.profile-tab').forEach(btn => {
        btn.onclick = () => {
          const tab = btn.getAttribute('data-tab');
          switchProfileTab(tab);
        };
      });
    }

    // STORE SYSTEM FUNCTIONS
    function openStore() {
      if (!State.storeItems || State.storeItems.length === 0) seedIfNeeded();
      renderStore();
      bindStoreEvents();
      UI.openSheet('sheetStore');
    }

    function closeStore() {
      UI.closeSheet('sheetStore');
    }

    function renderStore(category = 'all') {
      // Update store stats
      const sellersCount = $('#storeSellersCount');
      const itemsCount = $('#storeItemsCount');

      if (sellersCount) sellersCount.textContent = `${State.storeItems.length * 3}+ sellers`;
      if (itemsCount) itemsCount.textContent = `${State.storeItems.length}+ items`;

      // Filter items by category
      let filteredItems = State.storeItems;
      if (category !== 'all') {
        filteredItems = State.storeItems.filter(item => item.category === category);
      }

      // Render items grid
      const grid = $('#storeItemsGrid');
      if (grid) {
        if (filteredItems.length === 0) {
          grid.innerHTML = `
            <div class="col-span-2 text-center py-8">
              <i class="fa-solid fa-bag-shopping text-3xl text-gray-300 dark:text-slate-600 mb-3"></i>
              <div class="text-gray-500 dark:text-gray-400 mb-3 text-sm">No items found</div>
              <button onclick="openSellItem()" class="px-3 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors text-sm">
                Be the first to sell
              </button>
            </div>
          `;
        } else {
          grid.innerHTML = filteredItems.map(item => storeItemCard(item)).join('');
        }
      }

      // Update category filter buttons
      $$('.store-category-filter').forEach(btn => {
        const btnCategory = btn.getAttribute('data-category');
        if (btnCategory === category) {
          btn.className = 'store-category-filter bg-primary text-white p-3 rounded-xl font-medium transition-all';
        } else {
          btn.className = 'store-category-filter bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 p-3 rounded-xl hover:bg-gray-200 dark:hover:bg-slate-700 transition-all';
        }
      });

      // Update cart badge
      updateCartBadge();
    }

    function storeItemCard(item) {
      const isInCart = State.cart.some(cartItem => cartItem.itemId === item.id);
      const isSaved = State.bookmarks.has(item.id);

      return `
        <div class="store-item-card bg-white dark:bg-slate-900 rounded-xl overflow-hidden border border-gray-200 dark:border-slate-700 hover:shadow-lg transition-all cursor-pointer" onclick="openProductDetail('${item.id}')">
          <!-- Item Image -->
          <div class="relative aspect-square">
            <img src="${item.image}" class="w-full h-full object-cover" />

            <!-- Condition Badge -->
            <div class="absolute top-2 left-2 px-2 py-1 bg-black/70 text-white text-xs rounded-full">
              ${item.condition || 'Good'}
            </div>

            <!-- Save Button -->
            <button onclick="event.stopPropagation(); toggleItemSave('${item.id}')" class="absolute top-2 right-2 w-8 h-8 rounded-full bg-black/70 text-white flex items-center justify-center hover:bg-black/80 transition-colors">
              <i class="fa-${isSaved ? 'solid' : 'regular'} fa-bookmark text-sm"></i>
            </button>

            <!-- Quick Add to Cart -->
            <button onclick="event.stopPropagation(); ${isInCart ? 'removeFromCartStore' : 'addToCartFromStore'}('${item.id}')" class="absolute bottom-2 right-2 w-8 h-8 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 transition-colors">
              <i class="fa-solid fa-${isInCart ? 'check' : 'plus'} text-sm"></i>
            </button>
          </div>

          <!-- Item Info -->
          <div class="p-3">
            <h3 class="font-semibold text-sm line-clamp-2 mb-1">${item.name}</h3>
            <div class="flex items-center justify-between mb-2">
              <span class="text-lg font-bold text-primary">‚Çµ${item.price}</span>
              <span class="text-xs text-gray-500">Size ${item.size || 'M'}</span>
            </div>

            <!-- Seller Info -->
            <div class="flex items-center gap-2">
              <img src="${item.seller?.avatar || 'https://i.imgur.com/jL1aT9i.jpg'}" class="w-5 h-5 rounded-full" />
              <span class="text-xs text-gray-600 dark:text-gray-400">${item.seller?.name || 'Student Seller'}</span>
              ${item.seller?.verified ? '<i class="fa-solid fa-badge-check text-blue-500 text-xs"></i>' : ''}
            </div>

            <!-- Item Stats -->
            <div class="flex items-center justify-between mt-2 text-xs text-gray-500">
              <div class="flex items-center gap-3">
                <span><i class="fa-solid fa-heart mr-1"></i>${item.likes || 0}</span>
                <span><i class="fa-solid fa-eye mr-1"></i>${item.views || 0}</span>
              </div>
              <span>${item.timeAgo || '2h ago'}</span>
            </div>
          </div>
        </div>
      `;
    }

    function bindStoreEvents() {
      // Category filters
      $$('.store-category-filter').forEach(btn => {
        btn.onclick = () => {
          const category = btn.getAttribute('data-category');
          renderStore(category);
        };
      });

      // Sort dropdown
      const sortSelect = $('#storeSortSelect');
      if (sortSelect) {
        sortSelect.onchange = () => sortStoreItems();
      }

      // Load more button
      const loadMoreBtn = $('#btnLoadMoreStore');
      if (loadMoreBtn) {
        loadMoreBtn.onclick = () => {
          UI.toast('Loading more items...', 'info');
          // In a real app, this would load more items from the server
        };
      }
    }

    function sortStoreItems() {
      const sortBy = $('#storeSortSelect')?.value || 'newest';

      switch(sortBy) {
        case 'price-low':
          State.storeItems.sort((a, b) => a.price - b.price);
          break;
        case 'price-high':
          State.storeItems.sort((a, b) => b.price - a.price);
          break;
        case 'popular':
          State.storeItems.sort((a, b) => (b.likes || 0) - (a.likes || 0));
          break;
        case 'newest':
        default:
          State.storeItems.sort((a, b) => new Date(b.createdAt || Date.now()) - new Date(a.createdAt || Date.now()));
          break;
      }

      renderStore();
      UI.toast(`Sorted by ${sortBy.replace('-', ' ')}`, 'success');
    }

    // PRODUCT DETAIL FUNCTIONS
    function openProductDetail(itemId) {
      const item = State.storeItems.find(i => i.id === itemId);
      if (!item) {
        UI.toast('Product not found', 'error');
        return;
      }

      renderProductDetail(item);
      UI.openSheet('sheetProductDetail');
    }

    function closeProductDetail() {
      UI.closeSheet('sheetProductDetail');
    }

    function renderProductDetail(item) {
      const content = $('#productDetailContent');
      if (!content) return;

      const isInCart = State.cart.some(cartItem => cartItem.itemId === item.id);
      const isSaved = State.bookmarks.has(item.id);

      // Update save icon
      const saveIcon = $('#productSaveIcon');
      if (saveIcon) {
        saveIcon.className = isSaved ? 'fa-solid fa-bookmark text-lg' : 'fa-regular fa-bookmark text-lg';
      }

      content.innerHTML = `
        <!-- Product Images -->
        <div class="relative">
          <div class="aspect-square bg-gray-100 dark:bg-slate-800">
            <img id="productMainImage" src="${item.image}" class="w-full h-full object-cover" />
          </div>

          <!-- Condition Badge -->
          <div class="absolute top-4 left-4 px-3 py-1 bg-black/70 text-white text-sm rounded-full">
            ${item.condition}
          </div>
        </div>

        <!-- Product Info -->
        <div class="p-4 space-y-4">
          <!-- Title and Price -->
          <div>
            <h1 class="text-2xl font-bold mb-2">${item.name}</h1>
            <div class="flex items-center justify-between mb-3">
              <span class="text-3xl font-bold text-primary">‚Çµ${item.price}</span>
              <div class="flex items-center gap-2">
                <span class="px-3 py-1 bg-gray-100 dark:bg-slate-800 text-gray-700 dark:text-gray-300 rounded-full text-sm">Size ${item.size}</span>
                <span class="px-3 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-full text-sm">${item.category}</span>
              </div>
            </div>
          </div>

          <!-- Seller Info -->
          <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
            <h3 class="font-semibold mb-3">Seller Information</h3>
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <img src="${item.seller.avatar}" class="w-12 h-12 rounded-full object-cover" />
                <div>
                  <div class="flex items-center gap-2">
                    <span class="font-medium">${item.seller.name}</span>
                    ${item.seller.verified ? '<i class="fa-solid fa-badge-check text-blue-500"></i>' : ''}
                  </div>
                  <div class="text-sm text-gray-500">${item.seller.faculty || 'Student'}</div>
                  <div class="flex items-center gap-3 text-xs text-gray-500 mt-1">
                    <span><i class="fa-solid fa-star text-yellow-500 mr-1"></i>${item.seller.rating || '4.8'}</span>
                    <span><i class="fa-solid fa-box mr-1"></i>${item.seller.itemsSold || '12'} sold</span>
                  </div>
                </div>
              </div>
              <div class="flex flex-col gap-2">
                <button onclick="viewSellerProfile('${item.seller.id}')" class="px-4 py-2 bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors">
                  View Profile
                </button>
                <button onclick="messageSellerAboutItem('${item.id}')" class="px-4 py-2 bg-primary text-white rounded-lg text-sm font-medium hover:bg-primary/90 transition-colors">
                  Message
                </button>
              </div>
            </div>
          </div>

          <!-- Description -->
          <div>
            <h3 class="font-semibold mb-2">Description</h3>
            <p class="text-gray-600 dark:text-gray-400 leading-relaxed">${item.description || 'No description provided.'}</p>
          </div>

          <!-- Item Details -->
          <div class="bg-gray-50 dark:bg-slate-800 rounded-xl p-4">
            <h3 class="font-semibold mb-3">Item Details</h3>
            <div class="grid grid-cols-2 gap-3 text-sm">
              <div class="flex justify-between">
                <span class="text-gray-500">Brand:</span>
                <span class="font-medium">${item.brand || 'Unbranded'}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500">Size:</span>
                <span class="font-medium">${item.size}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500">Condition:</span>
                <span class="font-medium">${item.condition}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500">Category:</span>
                <span class="font-medium">${item.category}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500">Color:</span>
                <span class="font-medium">${item.color || 'Mixed'}</span>
              </div>
              <div class="flex justify-between">
                <span class="text-gray-500">Material:</span>
                <span class="font-medium">${item.material || 'Cotton'}</span>
              </div>
            </div>
          </div>

          <!-- Stats -->
          <div class="flex items-center justify-between text-sm text-gray-500">
            <div class="flex items-center gap-4">
              <span><i class="fa-solid fa-heart mr-1"></i>${item.likes || 0} likes</span>
              <span><i class="fa-solid fa-eye mr-1"></i>${item.views || 0} views</span>
              <span><i class="fa-solid fa-bookmark mr-1"></i>${item.saves || 0} saved</span>
            </div>
            <span>Posted ${item.timeAgo || '2h ago'}</span>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-3 mt-6">
            <button onclick="toggleProductSave()" class="px-4 py-3 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors">
              <i id="productSaveButtonIcon" class="fa-${isSaved ? 'solid' : 'regular'} fa-bookmark mr-2"></i>
              ${isSaved ? 'Saved' : 'Save'}
            </button>
            <button onclick="${isInCart ? 'removeFromCartStore' : 'addToCartFromStore'}('${item.id}')" class="flex-1 px-4 py-3 bg-primary text-white rounded-xl font-medium hover:bg-primary/90 transition-colors">
              <i class="fa-solid fa-${isInCart ? 'check' : 'shopping-cart'} mr-2"></i>
              ${isInCart ? 'In Cart' : 'Add to Cart'}
            </button>
          </div>

          <!-- Similar Items -->
          <div class="mt-6">
            <h3 class="font-semibold mb-3">Similar Items</h3>
            <div class="grid grid-cols-2 gap-3" id="similarItemsGrid">
              <!-- Similar items will be injected here -->
            </div>
          </div>
        </div>
      `;

      // Render similar items
      renderSimilarItems(item);
    }

    function changeProductImage(imageSrc) {
      const mainImage = $('#productMainImage');
      if (mainImage) {
        mainImage.src = imageSrc;
      }

      // Update gallery selection
      $$('.product-gallery-thumb').forEach(thumb => {
        thumb.classList.remove('border-primary');
        thumb.classList.add('border-gray-200', 'dark:border-slate-700');
      });

      const selectedThumb = $(`[onclick="changeProductImage('${imageSrc}')"]`);
      if (selectedThumb) {
        selectedThumb.classList.add('border-primary');
        selectedThumb.classList.remove('border-gray-200', 'dark:border-slate-700');
      }
    }

    function renderSimilarItems(currentItem) {
      const similarItems = State.storeItems
        .filter(item => item.id !== currentItem.id && item.category === currentItem.category)
        .slice(0, 4);

      const grid = $('#similarItemsGrid');
      if (grid) {
        if (similarItems.length === 0) {
          grid.innerHTML = `
            <div class="col-span-2 text-center py-8">
              <i class="fa-solid fa-search text-2xl text-gray-300 dark:text-slate-600 mb-2"></i>
              <div class="text-sm text-gray-500">No similar items found</div>
            </div>
          `;
        } else {
          grid.innerHTML = similarItems.map(item => `
            <div class="bg-white dark:bg-slate-900 rounded-lg overflow-hidden border border-gray-200 dark:border-slate-700 cursor-pointer hover:shadow-lg transition-all" onclick="openProductDetail('${item.id}')">
              <div class="aspect-square">
                <img src="${item.image}" class="w-full h-full object-cover" />
              </div>
              <div class="p-2">
                <h4 class="font-medium text-sm line-clamp-1">${item.name}</h4>
                <div class="flex items-center justify-between mt-1">
                  <span class="text-primary font-bold">‚Çµ${item.price}</span>
                  <span class="text-xs text-gray-500">Size ${item.size}</span>
                </div>
              </div>
            </div>
          `).join('');
        }
      }
    }

    // Additional store functions
    function toggleItemSave(itemId) {
      if (State.bookmarks.has(itemId)) {
        State.bookmarks.delete(itemId);
        UI.toast('Item removed from saved', 'success');
      } else {
        State.bookmarks.add(itemId);
        UI.toast('Item saved! üíñ', 'success');
      }
      persist();

      // Update UI if on product detail page
      const productPage = $('#page-product-detail');
      if (productPage && !productPage.classList.contains('hidden')) {
        const item = State.storeItems.find(i => i.id === itemId);
        if (item) renderProductDetail(item);
      }
    }

    function toggleProductSave() {
      // Get current product ID from the page
      const productPage = $('#page-product-detail');
      if (productPage && !productPage.classList.contains('hidden')) {
        // Find the current product ID from the rendered content
        const addToCartBtn = $('[onclick*="addToCart"]');
        if (addToCartBtn) {
          const onclick = addToCartBtn.getAttribute('onclick');
          const match = onclick.match(/'([^']+)'/);
          if (match) {
            toggleItemSave(match[1]);
          }
        }
      }
    }

    function shareProduct() {
      const productUrl = `https://raved.app/store/item/123`; // In real app, use actual product ID

      if (navigator.share) {
        navigator.share({
          title: 'Check out this item on Raved',
          text: 'Found this amazing fashion item on Raved!',
          url: productUrl
        }).then(() => {
          UI.toast('Product shared! üì§', 'success');
        }).catch(() => {
          copyToClipboard(productUrl);
        });
      } else {
        copyToClipboard(productUrl);
      }
    }

    function viewSellerProfile(sellerId) {
      UI.toast('Seller profile coming soon!', 'info');
    }

    function messageSellerAboutItem(itemId) {
      UI.toast('Messaging seller...', 'info');
      // In real app, this would open a chat with the seller
    }

    function openStoreSearch() {
      UI.toast('Store search coming soon! üîç', 'info');
    }

    function openStoreFilters() {
      UI.toast('Advanced filters coming soon!', 'info');
    }

    function openSellItem() {
      // Set seller info
      $('#storeSellerAvatar').src = State.currentUser.avatar;
      $('#storeSellerName').textContent = State.currentUser.name;
      $('#storeSellerFaculty').textContent = State.currentUser.faculty;

      UI.openSheet('sheetAddToStore');
    }

    // Update existing functions to work with new store
    function addToCartFromStore(itemId, size = 'M', color = 'Black') {
      const item = State.storeItems.find(i => i.id === itemId);
      if (!item) {
        UI.toast('Item not found', 'error');
        return;
      }

      const key = itemId + '|' + size + '|' + color;
      const existing = State.cart.find(x => x.key === key);
      if (existing) {
        existing.qty += 1;
      } else {
        State.cart.push({
          key,
          itemId,
          name: item.name,
          price: item.price,
          image: item.image,
          size,
          color,
          qty: 1,
          seller: item.seller
        });
      }

      persist();
      updateCartBadge();
      UI.toast(`${item.name} added to cart! üõí`, 'success');

      // Update UI if on store or product page
      const storeSheet = $('#sheetStore');
      if (storeSheet && !storeSheet.classList.contains('collapsed')) {
        renderStore();
      }

      // Update product detail if open
      const productSheet = $('#sheetProductDetail');
      if (productSheet && !productSheet.classList.contains('collapsed')) {
        renderProductDetail(item);
      }
    }

    function removeFromCartStore(itemId, size = 'M', color = 'Black') {
      const key = itemId + '|' + size + '|' + color;
      const itemIndex = State.cart.findIndex(cartItem => cartItem.key === key);
      if (itemIndex > -1) {
        const item = State.cart[itemIndex];
        State.cart.splice(itemIndex, 1);
        persist();
        updateCartBadge();
        UI.toast(`${item.name} removed from cart`, 'success');

        // Update UI
        const storeSheet = $('#sheetStore');
        if (storeSheet && !storeSheet.classList.contains('collapsed')) {
          renderStore();
        }

        // Update product detail if open
        const productSheet = $('#sheetProductDetail');
        if (productSheet && !productSheet.classList.contains('collapsed')) {
          const storeItem = State.storeItems.find(i => i.id === itemId);
          if (storeItem) renderProductDetail(storeItem);
        }
      }
    }

    // INIT - Wait for DOM to be ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing app...'); // Debug log

      // Check if login form exists
      const loginForm = $('#loginForm');
      const signinBtn = $('#signinBtn');
      console.log('Login form found:', loginForm); // Debug log
      console.log('Signin button found:', signinBtn); // Debug log

      // Initialize app
      initializeDarkMode();
      initializeTheme();
      seedIfNeeded();
      persist();
      bindCreatePost();
      bindSearchEvents();

      // Bind close buttons
      bindCloseButtons();

      // Bind profile events
      bindProfileEvents();

      // Always show the app directly
      State.loggedIn = true;
      showApp();
    });

    // Fallback init if DOMContentLoaded already fired
    if (document.readyState === 'loading') {
      // DOMContentLoaded will fire
    } else {
      // DOM is already ready
      setTimeout(() => {
        console.log('DOM already ready, initializing app...'); // Debug log

        const loginForm = $('#loginForm');
        const signinBtn = $('#signinBtn');
        console.log('Login form found:', loginForm); // Debug log
        console.log('Signin button found:', signinBtn); // Debug log

        // Initialize app
        initializeDarkMode();
        initializeTheme();
        seedIfNeeded();
        persist();
        bindCreatePost();
        bindSearchEvents();

        // Bind close buttons
        bindCloseButtons();

        // Bind profile events
        bindProfileEvents();

        // Always show the app directly
        State.loggedIn = true;
        showApp();
      }, 100);
    }

    // Expose for inline handlers if any
    window.openCart = openCart;
  </script>
</body>
</html>